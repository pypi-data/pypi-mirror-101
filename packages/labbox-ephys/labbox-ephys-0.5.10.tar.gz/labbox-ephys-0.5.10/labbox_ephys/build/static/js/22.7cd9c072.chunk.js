(this["webpackJsonplabbox-ephys"]=this["webpackJsonplabbox-ephys"]||[]).push([[22],{118:function(e,t,n){"use strict";n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return s})),n.d(t,"f",(function(){return m})),n.d(t,"i",(function(){return p})),n.d(t,"e",(function(){return h})),n.d(t,"h",(function(){return O})),n.d(t,"g",(function(){return g})),n.d(t,"j",(function(){return v}));var r=n(17),i=n(0),c=n(23),a=(n(2),n(38),function(e,t){if(e.min<=t&&t<e.max)return e;var n=e.max-e.min,r=Math.max(0,Math.floor(t-n/2));return{min:r,max:r+n}}),o=function(e,t){if("SetRecordingSelection"===t.type)return Object(c.a)({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object(c.a)(Object(c.a)({},e),{},{selectedElectrodeIds:t.selectedElectrodeIds.filter((function(t){return!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)}))});if("SetVisibleElectrodeIds"===t.type)return Object(c.a)(Object(c.a)({},e),{},{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((function(e){return t.visibleElectrodeIds.includes(e)})):void 0});if("SetCurrentTimepoint"===t.type)return Object(c.a)(Object(c.a)({},e),{},{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?a(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object(c.a)(Object(c.a)({},e),{},{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){var n,r,i=e.currentTimepoint,o=e.timeRange;if(!o)return e;var l,s=null!==(n=t.direction)&&void 0!==n?n:"in",d=null!==(r=t.factor)&&void 0!==r?r:1.4,b="out"===s?1/d:d;if((o.max-o.min)/b>9e6)return e;l=void 0===i||i<o.min?o.min:i>o.max?o.max:i;var m=u(o,b,l);return Object(c.a)(Object(c.a)({},e),{},{timeRange:m})}if("SetAmpScaleFactor"===t.type)return Object(c.a)(Object(c.a)({},e),{},{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){var f,j,p=null!==(f=t.direction)&&void 0!==f?f:"up",h=null!==(j=t.multiplier)&&void 0!==j?j:1.4,O="down"===p?1/h:h;return Object(c.a)(Object(c.a)({},e),{},{ampScaleFactor:(e.ampScaleFactor||1)*O})}return"SetCurrentTimepointVelocity"===t.type?Object(c.a)(Object(c.a)({},e),{},{animation:Object(c.a)(Object(c.a)({},e.animation||{}),{},{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object(c.a)(Object(c.a)({},e),{},{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},u=function(e,t,n){var r=n+(e.min-n)/t,i=n+(e.max-n)/t;return{min:Math.floor(r),max:Math.floor(i)}},l=n(33),s=function(e,t){return((t||{}).mergeGroups||[]).filter((function(t){return t.includes(e)}))[0]||null},d=function(e,t,n){return n&&s(e,t)||e},b=function(e,t){var n=s(e,t);return!n||Math.min.apply(Math,Object(l.a)(n))===e},m=function(e,t){return"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:t.selectedUnitIds.filter((function(t){var n;return!e.visibleUnitIds||(null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((function(e){var n;return null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?function(e,t){var n=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(n)?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:(e.selectedUnitIds||[]).filter((function(e){return e!==n}))}):Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:[].concat(Object(l.a)(e.selectedUnitIds||[]),[n])}):Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:[n]})}(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?f(Object(c.a)(Object(c.a)({},e),{},{applyMerges:!e.applyMerges}),t.curation):o(e,t)},f=function(e,t){return e.applyMerges&&t?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((function(e){return b(e,t)})):void 0}):e},j=function(e){return e.filter((function(e){return!e.disabled&&!e.development}))},p=function(e){return j(e).filter((function(e){return"SortingView"===e.type})).map((function(e){return e}))},h=function(e){return j(e).filter((function(e){return"RecordingView"===e.type})).map((function(e){return e}))},O=function(e){return j(e).filter((function(e){return"SortingUnitView"===e.type})).map((function(e){return e}))},g=function(e){return j(e).filter((function(e){return"SortingUnitMetric"===e.type})).map((function(e){return e}))},v=function(){var e=Object(r.g)();return Object(i.useMemo)((function(){return e.filter((function(e){return"WorkspaceView"===e.type})).map((function(e){return e}))}),[e])}},141:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o}));var r=n(12),i=n(17),c=n(0),a=function(e,t){return Object(i.f)(e?"createjob_get_sorting_info":"",{sorting_object:e,recording_object:t},{useClientCache:!0}).result},o=function(e){var t=Object(c.useContext)(i.a),n=Object(c.useRef)({}),a=Object(c.useState)(0),o=Object(r.a)(a,2)[1],u={};return e.forEach((function(e){var r=e.sortingId;if(!n.current[r]){var i=t.createHitherJob("createjob_get_sorting_info",{recording_object:e.recordingObject,sorting_object:e.sortingObject},{useClientCache:!0});n.current[r]=i,i.wait().then((function(){o((function(e){return e+1}))})).catch((function(){o((function(e){return e+1}))}))}n.current[r].result&&(u[r]=n.current[r].result)})),u}},152:function(e,t,n){"use strict";t.a=function e(t){return function(e){return Array.isArray(e)}(t)?t.sort((function(e,t){return e.priority===t.priority?(e.label||"")<(t.label||"")?-1:(e.label||"")>(t.label||"")?1:0:(t.priority||0)-(e.priority||0)})):e(Object.values(t))}},157:function(e,t,n){},188:function(e,t,n){"use strict";var r=n(10),i=n(17),c=n(0),a=n.n(c),o=n(118),u=n(152),l=(n(157),n(24)),s=n(33),d=n(12),b=n(186),m=n(184),f=n(246),j=n(195),p=n(196),h=n(228),O=n(599),g=n(604),v=n(600),x=n(194),y=n(247),I=function(e){var t=e.columns,n=e.onColumnClick,i=e.primarySortColumnDirection,c=e.primarySortColumnName,a=e.onDeselectAll;return Object(r.jsx)(f.a,{children:Object(r.jsxs)(j.a,{children:[a?Object(r.jsx)(p.a,{children:Object(r.jsx)(S,{rowId:"",selected:!1,onClick:function(){a()},isDeselectAll:!0})},"_checkbox"):Object(r.jsx)(p.a,{},"_checkbox"),t.map((function(e){var t=(e.tooltip||e.label||"")+" (click to sort)";return Object(r.jsx)(p.a,{onClick:function(){return n(e)},title:t,style:{cursor:"pointer"},children:Object(r.jsxs)(h.a,{container:!0,justify:"flex-start",style:{flexFlow:"row"},children:[Object(r.jsx)(h.a,{item:!0,children:Object(r.jsx)("span",{style:{fontSize:16,color:"gray",paddingLeft:3,paddingRight:5,paddingTop:2},children:c===e.columnName&&("ascending"===i?Object(r.jsx)(m.a,{icon:b.b}):Object(r.jsx)(m.a,{icon:b.a}))})},"icon"),Object(r.jsx)(h.a,{item:!0,children:Object(r.jsxs)("span",{children:[Object(r.jsx)("span",{children:e.label},"label"),Object(r.jsx)("span",{children:e.calculating&&Object(r.jsx)(O.a,{})},"progress")]})},"text")]})},e.columnName)}))]})})},S=a.a.memo((function(e){var t=e.rowId,n=e.selected,i=e.onClick,c=e.isDeselectAll;return Object(r.jsx)(g.a,{checked:n,indeterminate:!!c,onClick:function(){return i(t)},style:{padding:1},title:c?"Deselect all":"Select ".concat(t)})})),N=function(e){var t=e.selectedRowIds,n=e.onSelectedRowIdsChanged,i=e.rows,a=e.columns,o=e.defaultSortColumnName,u=e.height,b=Object(c.useState)([]),m=Object(d.a)(b,2),f=m[0],h=m[1];Object(c.useEffect)((function(){0===f.length&&o&&h([o])}),[h,f,o]);var O,g=Object(c.useCallback)((function(e){var r=t.includes(e)?t.filter((function(t){return t!==e})):[].concat(Object(s.a)(t),[e]);n(r)}),[t,n]),N=Object(s.a)(i),_=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n-1]!==e[n];t.push({columnName:e[n],keyOrder:n,sortAscending:r})}return t}(f),w=Object(l.a)(_);try{var C=function(){var e=O.value,t=e.columnName,n=function(e){return a.filter((function(t){return t.columnName===e}))[0]}(t);N.sort((function(r,i){var c=r.data[t]||{},a=i.data[t]||{},o=c.sortValue,u=a.sortValue;return e.sortAscending?n.sort(o,u):n.sort(u,o)}))};for(w.s();!(O=w.n()).done;)C()}catch(F){w.e(F)}finally{w.f()}var U=(t||[]).reduce((function(e,t){return e[t]=!0,e}),{}),k=_.length>0?_[_.length-1]:void 0,E=k?k.columnName:void 0,R=k?k.sortAscending?"ascending":"descending":void 0;return Object(r.jsx)(v.a,{style:void 0!==u?{maxHeight:u}:{},children:Object(r.jsxs)(x.a,{stickyHeader:!0,className:"TableWidget",children:[Object(r.jsx)(I,{columns:a,primarySortColumnName:E,primarySortColumnDirection:R,onColumnClick:function(e){var t=e.columnName,n=Object(s.a)(f);n=f[f.length-1]===t?f[f.length-2]===t?n.slice(0,n.length-1):[].concat(Object(s.a)(n),[t]):[].concat(Object(s.a)(n.filter((function(e){return e!==t}))),[t]),h(n)},onDeselectAll:t.length>0?function(){n([])}:void 0}),Object(r.jsx)(y.a,{children:N.map((function(e){var t=U[e.rowId]||!1;return Object(r.jsxs)(j.a,{children:[Object(r.jsx)(p.a,{className:t?"selectedRow":"",children:Object(r.jsx)(S,{rowId:e.rowId,selected:t,onClick:function(){return g(e.rowId)}})},"_checkbox"),a.map((function(n){return Object(r.jsx)(p.a,{className:t?"selectedRow":"",children:Object(r.jsx)("div",{title:n.tooltip,children:n.dataElement(e.data[n.columnName].value)})},n.columnName)}))]},e.rowId)}))})]})})},_=function(e,t){return((t.curation||{}).labelsByUnit||{})[e]||[]};t.a=function(e){var t=e.sortingUnitMetrics,n=e.units,a=e.metrics,l=e.selection,s=e.selectionDispatch,d=e.sorting,b=e.height,m=(l||{}).selectedUnitIds||[],f=Object(u.a)(Object.values(t||{})).filter((function(e){return!e.disabled})),j=Object(c.useCallback)((function(e){s({type:"SetSelectedUnitIds",selectedUnitIds:e.map((function(e){return Number(e)}))})}),[s]),p=n.map((function(e){return{rowId:e+"",data:{}}})),h=function(e,t){return Number(e)-Number(t)},O=function(e){return Object(r.jsx)("span",{children:e+""})},g={color:"black",fontWeight:"bold",cursor:"pointer"},v={color:"gray",textDecoration:"underline",cursor:"pointer"},x=[];x.push({columnName:"_unit_id",label:"Unit ID",tooltip:"Unit ID",sort:h,dataElement:function(e){var t=e,n=t.unitId,i=t.mergeGroup;return Object(r.jsxs)("span",{children:[Object(r.jsx)("span",{style:g,children:n+""},"unitId"),i&&i.length>0&&Object(r.jsx)("span",{children:" (".concat(i.map((function(e){return e+""})).join(", "),")")},"mergeGroup")]})}}),p.forEach((function(e){var t=Number(e.rowId);e.data._unit_id={value:{unitId:t,mergeGroup:Object(o.c)(t,d.curation)},sortValue:t}})),x.push({columnName:"_labels",label:"Labels",tooltip:"Curation labels",sort:function(e,t){return e<t?-1:e>t?1:0},dataElement:function(e){var t=e;return Object(r.jsx)("span",{children:t.map((function(e){return Object(r.jsxs)("span",{children:[Object(r.jsx)("span",{style:v,children:e}),"\xa0"]},e)}))})}}),p.forEach((function(e){var t=Number(e.rowId),n=_(t,d);e.data._labels={value:n,sortValue:n.join(", ")}}));var y=Object(i.f)("createjob_fetch_unit_metrics",{unit_metrics_uri:d.unitMetricsUri||""},{useClientCache:!0}),I=y.result;y.job;(I||[]).forEach((function(e){var t="external-metric-"+e.name;x.push({columnName:t,label:e.label,tooltip:e.tooltip||"",sort:h,dataElement:O}),p.forEach((function(n){var r=Number(n.rowId),i=e.data[r+""];n.data[t]={value:void 0!==i?i:NaN,sortValue:void 0!==i?i:NaN}}))})),f.forEach((function(e){var t="plugin-metric-"+e.name,n=(a||{})[e.name]||null,r=n?n.data:null;x.push({columnName:t,label:e.columnLabel,tooltip:e.tooltip||"",sort:h,dataElement:e.component,calculating:n&&!r}),p.forEach((function(n){var i=Number(n.rowId),c=r&&i+""in r?r[i+""]:void 0,a=void 0!==c?e.getValue(c):void 0;n.data[t]={value:c,sortValue:void 0!==a?a:e.isNumeric?NaN:""}}))}));var S=m.map((function(e){return e+""}));return Object(r.jsx)(N,{rows:p,columns:x,selectedRowIds:S,onSelectedRowIdsChanged:j,defaultSortColumnName:"_unit_id",height:b})}},716:function(e,t,n){"use strict";n.r(t),n.d(t,"activate",(function(){return U}));var r=n(10),i=n(677),c=n.n(i),a=n(0),o={type:"SortingUnitMetric",name:"EventCount",label:"Num. events",columnLabel:"Num. events",tooltip:"Number of firing events",hitherFnName:"createjob_get_firing_data",metricFnParams:{},hitherOpts:{useClientCache:!0},component:function(e){return Object(r.jsx)("span",{children:void 0!==e?e.count:""})},isNumeric:!0,getValue:function(e){return e.count}},u={type:"SortingUnitMetric",name:"FiringRate",label:"Firing rate (Hz)",columnLabel:"Firing rate (Hz)",tooltip:"Average num. events per second",hitherFnName:"createjob_get_firing_data",hitherOpts:{useClientCache:!0},metricFnParams:{},component:function(e){return Object(r.jsx)("span",{children:void 0!==e?e.rate:""})},isNumeric:!0,getValue:function(e){return e.count}},l={type:"SortingUnitMetric",name:"IsiViolations",label:"ISI viol.",columnLabel:"ISI viol.",tooltip:"ISI violation rate",hitherFnName:"createjob_get_isi_violation_rates",metricFnParams:{isi_threshold_msec:2.5},hitherOpts:{useClientCache:!0},component:function(e){return Object(r.jsx)("span",{children:void 0!==e?e.toFixed(4):""})},isNumeric:!0,getValue:function(e){return e}},s={type:"SortingUnitMetric",name:"PeakChannels",label:"Peak chan.",columnLabel:"Peak chan.",tooltip:"ID of channel where the peak-to-peak amplitude is maximal",hitherFnName:"createjob_get_peak_channels",metricFnParams:{},hitherOpts:{useClientCache:!0},component:function(e){return Object(r.jsx)("span",{children:void 0!==e?e:""})},isNumeric:!0,getValue:function(e){return e}},d={type:"SortingUnitMetric",name:"UnitSnrs",label:"SNR",columnLabel:"SNR",tooltip:"Unit SNR (peak-to-peak amp of mean waveform / est. std. dev on peak chan)",hitherFnName:"createjob_get_unit_snrs",metricFnParams:{},hitherOpts:{useClientCache:!0},component:function(e){return Object(r.jsx)("span",{children:void 0!==e?e.toFixed(4):""})},isNumeric:!0,getValue:function(e){return e}},b=function(e){e.registerPlugin(o),e.registerPlugin(u),e.registerPlugin(l),e.registerPlugin(s),e.registerPlugin(d)},m=n(2),f=n.n(m),j=n(38),p=n(12),h=n(42),O=n(23),g=n(256),v=n(226),x=n(17),y=n(141),I=n(118),S=n(152),N=n(188),_={},w=function(e,t){if("clear"===t)return{};var n=t.metricName,r=t.status,i=t.data,c=t.error;return e[n]&&"completed"===e[n].status?(console.warn("Updating status of completed metric ".concat(n,"??")),e):Object(O.a)(Object(O.a)({},e),{},Object(h.a)({},n,{status:r,data:"completed"===r&&i||null,error:"error"===r&&c||null}))},C=function(e){var t=Object(a.useContext)(x.a),n=e.sorting,i=e.recording,c=e.selection,o=e.selectionDispatch,u=e.width,l=e.height,s=Object(a.useState)(!1),d=Object(p.a)(s,2),b=d[0],m=d[1],h=Object(a.useReducer)(w,_),O=Object(p.a)(h,2),C=O[0],U=O[1],k=Object(a.useState)(null),E=Object(p.a)(k,2),R=E[0],F=E[1];Object(a.useEffect)((function(){R!==i&&(U("clear"),F(i))}),[i,R,F,U]);var M=Object(a.useCallback)(function(){var e=Object(j.a)(f.a.mark((function e(r){var c,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((c=r.name)in C)){e.next=3;break}return e.abrupt("return",C[c]);case 3:return U({metricName:r.name,status:"executing"}),e.prev=4,e.next=7,t.createHitherJob(r.hitherFnName,{sorting_object:n.sortingObject,recording_object:i.recordingObject,configuration:r.metricFnParams},r.hitherOpts).wait();case 7:a=e.sent,U({metricName:r.name,status:"completed",data:a}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.error(e.t0),U({metricName:r.name,status:"error",error:e.t0.message});case 15:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t){return e.apply(this,arguments)}}(),[C,n.sortingObject,i.recordingObject,t]),V=Object(x.g)();Object(a.useEffect)((function(){Object(S.a)(Object(I.g)(V)).filter((function(e){return!e.disabled})).forEach(function(){var e=Object(j.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[V,C,M]);var P=Object(a.useMemo)((function(){return Object(I.g)(V)}),[V]),T=Object(y.a)(n.sortingObject,n.recordingObject);if(!T)return Object(r.jsx)("div",{children:"No sorting info"});var D=c.visibleUnitIds||T.unit_ids,A=!1;return!b&&D.length>30&&(D=D.slice(0,30),A=!0),Object(r.jsx)("div",{style:{width:u||300},children:Object(r.jsxs)(g.a,{style:{maxHeight:e.maxHeight,overflow:"auto"},children:[Object(r.jsx)(N.a,{sortingUnitMetrics:P,units:D,metrics:C,selection:c,selectionDispatch:o,sorting:n,height:l}),A&&Object(r.jsx)(v.a,{onClick:function(){m(!0)},children:"Show all units"})]})})};function U(e){b(e),e.registerPlugin({type:"SortingView",name:"UnitsTable",label:"Units Table",icon:Object(r.jsx)(c.a,{}),priority:200,component:C,props:{maxHeight:300},singleton:!0})}}}]);
//# sourceMappingURL=22.7cd9c072.chunk.js.map