(this["webpackJsonplabbox-ephys"]=this["webpackJsonplabbox-ephys"]||[]).push([[25],{118:function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return f})),n.d(t,"i",(function(){return p})),n.d(t,"e",(function(){return g})),n.d(t,"h",(function(){return m})),n.d(t,"g",(function(){return h})),n.d(t,"j",(function(){return v}));var r=n(17),i=n(0),c=n(23),o=(n(2),n(38),function(e,t){if(e.min<=t&&t<e.max)return e;var n=e.max-e.min,r=Math.max(0,Math.floor(t-n/2));return{min:r,max:r+n}}),s=function(e,t){if("SetRecordingSelection"===t.type)return Object(c.a)({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object(c.a)(Object(c.a)({},e),{},{selectedElectrodeIds:t.selectedElectrodeIds.filter((function(t){return!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)}))});if("SetVisibleElectrodeIds"===t.type)return Object(c.a)(Object(c.a)({},e),{},{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((function(e){return t.visibleElectrodeIds.includes(e)})):void 0});if("SetCurrentTimepoint"===t.type)return Object(c.a)(Object(c.a)({},e),{},{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?o(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object(c.a)(Object(c.a)({},e),{},{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){var n,r,i=e.currentTimepoint,s=e.timeRange;if(!s)return e;var u,l=null!==(n=t.direction)&&void 0!==n?n:"in",d=null!==(r=t.factor)&&void 0!==r?r:1.4,b="out"===l?1/d:d;if((s.max-s.min)/b>9e6)return e;u=void 0===i||i<s.min?s.min:i>s.max?s.max:i;var f=a(s,b,u);return Object(c.a)(Object(c.a)({},e),{},{timeRange:f})}if("SetAmpScaleFactor"===t.type)return Object(c.a)(Object(c.a)({},e),{},{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){var j,O,p=null!==(j=t.direction)&&void 0!==j?j:"up",g=null!==(O=t.multiplier)&&void 0!==O?O:1.4,m="down"===p?1/g:g;return Object(c.a)(Object(c.a)({},e),{},{ampScaleFactor:(e.ampScaleFactor||1)*m})}return"SetCurrentTimepointVelocity"===t.type?Object(c.a)(Object(c.a)({},e),{},{animation:Object(c.a)(Object(c.a)({},e.animation||{}),{},{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object(c.a)(Object(c.a)({},e),{},{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},a=function(e,t,n){var r=n+(e.min-n)/t,i=n+(e.max-n)/t;return{min:Math.floor(r),max:Math.floor(i)}},u=n(33),l=function(e,t){return((t||{}).mergeGroups||[]).filter((function(t){return t.includes(e)}))[0]||null},d=function(e,t,n){return n&&l(e,t)||e},b=function(e,t){var n=l(e,t);return!n||Math.min.apply(Math,Object(u.a)(n))===e},f=function(e,t){return"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:t.selectedUnitIds.filter((function(t){var n;return!e.visibleUnitIds||(null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((function(e){var n;return null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?function(e,t){var n=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(n)?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:(e.selectedUnitIds||[]).filter((function(e){return e!==n}))}):Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:[].concat(Object(u.a)(e.selectedUnitIds||[]),[n])}):Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:[n]})}(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?j(Object(c.a)(Object(c.a)({},e),{},{applyMerges:!e.applyMerges}),t.curation):s(e,t)},j=function(e,t){return e.applyMerges&&t?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((function(e){return b(e,t)})):void 0}):e},O=function(e){return e.filter((function(e){return!e.disabled&&!e.development}))},p=function(e){return O(e).filter((function(e){return"SortingView"===e.type})).map((function(e){return e}))},g=function(e){return O(e).filter((function(e){return"RecordingView"===e.type})).map((function(e){return e}))},m=function(e){return O(e).filter((function(e){return"SortingUnitView"===e.type})).map((function(e){return e}))},h=function(e){return O(e).filter((function(e){return"SortingUnitMetric"===e.type})).map((function(e){return e}))},v=function(){var e=Object(r.g)();return Object(i.useMemo)((function(){return e.filter((function(e){return"WorkspaceView"===e.type})).map((function(e){return e}))}),[e])}},715:function(e,t,n){"use strict";n.r(t),n.d(t,"activate",(function(){return G}));var r=n(10),i=n(12),c=n(678),o=n(17),s=n(0),a=n(118),u=function(e){if(!e)return{feedUri:void 0,workspaceName:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,workspaceName:void 0};var t=e.split("/"),n=t[2]||void 0,r=t[3]||void 0;return n&&r?{feedUri:"feed://".concat(n),workspaceName:r}:{feedUri:void 0,workspaceName:void 0}},l=n(42),d=n(33),b=n(23),f=function(e,t){if("SET_CURATION"===t.type)return t.curation;if("ADD_UNIT_LABEL"===t.type){var n=t.unitId+"",r=(e.labelsByUnit||{})[n]||[];return r.includes(t.label)?e:Object(b.a)(Object(b.a)({},e),{},{labelsByUnit:Object(b.a)(Object(b.a)({},e.labelsByUnit),{},Object(l.a)({},n,[].concat(Object(d.a)(r),[t.label]).sort()))})}if("REMOVE_UNIT_LABEL"===t.type){var i=t.unitId+"",c=(e.labelsByUnit||{})[i]||[];return c.includes(t.label)?Object(b.a)(Object(b.a)({},e),{},{labelsByUnit:Object(b.a)(Object(b.a)({},e.labelsByUnit),{},Object(l.a)({},i,c.filter((function(e){return e!==t.label}))))}):e}return"MERGE_UNITS"===t.type?Object(b.a)(Object(b.a)({},e),{},{mergeGroups:p([].concat(Object(d.a)(e.mergeGroups||[]),[t.unitIds]))}):"UNMERGE_UNITS"===t.type?Object(b.a)(Object(b.a)({},e),{},{mergeGroups:p((e.mergeGroups||[]).map((function(e){return e.filter((function(e){return!t.unitIds.includes(e)}))})))}):e},j=function(e,t){return e.filter((function(e){return t.includes(e)}))},O=function(e,t){return[].concat(Object(d.a)(e),Object(d.a)(t.filter((function(t){return!e.includes(t)})))).sort()},p=function(e){for(var t=e.map((function(e){return Object(d.a)(e)})),n=!0;n;){n=!1;for(var r=0;r<t.length;r++)for(var i=t[r],c=r+1;c<t.length;c++){var o=t[c];j(i,o).length>0&&(t[r]=O(i,o),t[c]=[],n=!0)}}return t.filter((function(e){return e.length>=2}))},g=function(e,t){switch(t.type){case"ADD_RECORDING":return Object(b.a)(Object(b.a)({},e),{},{recordings:[].concat(Object(d.a)(e.recordings.filter((function(e){return e.recordingId!==t.recording.recordingId}))),[t.recording])});case"DELETE_RECORDINGS":return Object(b.a)(Object(b.a)({},e),{},{recordings:e.recordings.filter((function(e){return!t.recordingIds.includes(e.recordingId)}))});case"ADD_SORTING":return Object(b.a)(Object(b.a)({},e),{},{sortings:[].concat(Object(d.a)(e.sortings.filter((function(e){return e.sortingId!==t.sorting.sortingId}))),[t.sorting])});case"DELETE_SORTINGS":return Object(b.a)(Object(b.a)({},e),{},{sortings:e.sortings.filter((function(e){return!t.sortingIds.includes(e.sortingId)}))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object(b.a)(Object(b.a)({},e),{},{sortings:e.sortings.filter((function(e){return!t.recordingIds.includes(e.recordingId)}))});case"ADD_UNIT_LABEL":case"REMOVE_UNIT_LABEL":case"MERGE_UNITS":case"UNMERGE_UNITS":return Object(b.a)(Object(b.a)({},e),{},{sortings:e.sortings.map((function(e){return e.sortingId===t.sortingId?Object(b.a)(Object(b.a)({},e),{},{curation:f(e.curation||{},t)}):e}))});case"SET_UNIT_METRICS_FOR_SORTING":return Object(b.a)(Object(b.a)({},e),{},{sortings:e.sortings.map((function(e){return e.sortingId===t.unitMetricsForSorting.sortingId?Object(b.a)(Object(b.a)({},e),{},{unitMetricsUri:t.unitMetricsForSorting.metricsUri}):e}))});default:return e}},m=n(705),h=n(609),v=function(){var e=Object(s.useState)([]),t=Object(i.a)(e,2),n=t[0],c=t[1],a=Object(s.useContext)(o.a);Object(s.useEffect)((function(){var e=setInterval((function(){var e=a.getHitherJobs();c(e)}),1e3);return function(){clearInterval(e)}}),[a]);var u={pendingJobs:n.filter((function(e){return"pending"===e.status})),runningJobs:n.filter((function(e){return"running"===e.status})),finishedJobs:n.filter((function(e){return"finished"===e.status})),erroredJobs:n.filter((function(e){return"error"===e.status}))},l=u.runningJobs,d=u.finishedJobs,b=u.erroredJobs,f=u.pendingJobs.length,j=l.length,O=d.length,p=b.length,g="Jobs: ".concat(f," pending | ").concat(j," running | ").concat(O," finished | ").concat(p," errored"),m=p>0?Object(r.jsxs)("span",{children:[":",Object(r.jsx)("span",{style:{color:"pink"},children:p})]}):Object(r.jsx)("span",{});return Object(r.jsxs)("span",{title:g,style:{fontFamily:"courier"},children:[f,":",j,":",O,m]})},I=n(190),y=n(700),x=n(703),w=n(704),U=function(e){var t=e.color,n=Object(s.useContext)(o.c),i=n.websocketStatus,c=n.onReconnectWebsocket,a=Object(s.useMemo)((function(){switch(i){case"waiting":return{icon:Object(r.jsx)(y.a,{style:{color:"blue"}}),title:"Loading..."};case"connected":return{icon:Object(r.jsx)(x.a,{style:{color:t}}),title:"Connected"};case"disconnected":return{icon:Object(r.jsx)(w.a,{style:{color:"red"}}),title:"Disconnected from server. Click to attempt reconnect."};default:throw Error("Unexpected.")}}),[i,t]),u=a.icon,l=a.title,d=Object(s.useCallback)((function(){"disconnected"===i&&c()}),[i,c]);return Object(r.jsx)(I.a,{title:l,onClick:d,children:u})},S=n(632),E=function(e){var t=e.onOpenSettings,n=e.color,i=Object(s.useMemo)((function(){return{icon:Object(r.jsx)(S.a,{}),title:"Open settings"}}),[]),c=i.icon,o=i.title,a=Object(s.useCallback)((function(){t()}),[t]);return Object(r.jsx)(I.a,{style:{color:n},title:o,onClick:a,children:c})},k=function(e){var t=e.onOpenSettings,n=e.workspaceRouteDispatch,i=e.logo,c=Object(s.useCallback)((function(){n({type:"gotoRecordingsPage"})}),[n]);return Object(r.jsx)(m.a,{position:"static",style:{height:50,color:"white"},children:Object(r.jsxs)(h.a,{children:[i&&Object(r.jsx)("img",{src:i,className:"App-logo",alt:"logo",height:30,style:{paddingBottom:5,cursor:"pointer"},onClick:c}),"\xa0\xa0\xa0",Object(r.jsx)("span",{style:{paddingBottom:0,color:"white",fontFamily:"sans-serif",fontWeight:"bold"},children:"Labbox Ephys"}),Object(r.jsx)("span",{style:{marginLeft:"auto"}}),Object(r.jsxs)("span",{style:{paddingBottom:0,color:"white"},children:[Object(r.jsx)(E,{onOpenSettings:t,color:"white"}),Object(r.jsx)(U,{color:"white"}),Object(r.jsx)(v,{})]})]})})},R=n(194),M=n(195),T=n(196),N=n(706),C=Object(N.a)((function(e){return{paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}})),_=function(e){var t=e.workspaceUri,n=e.version,i=C(),c=Object(s.useContext)(o.c).serverInfo,a=u(t).workspaceName;return Object(r.jsxs)("div",{className:i.paper,style:{zIndex:9999},children:[Object(r.jsxs)("h2",{children:["Labbox Ephys ",n]}),Object(r.jsxs)(R.a,{children:[Object(r.jsxs)(M.a,{children:[Object(r.jsx)(T.a,{children:"Workspace URI"}),Object(r.jsx)(T.a,{children:t||""})]}),Object(r.jsxs)(M.a,{children:[Object(r.jsx)(T.a,{children:"Workspace name"}),Object(r.jsx)(T.a,{children:a})]}),Object(r.jsxs)(M.a,{children:[Object(r.jsx)(T.a,{children:"Kachery node ID"}),Object(r.jsx)(T.a,{children:c?c.nodeId:""})]}),Object(r.jsxs)(M.a,{children:[Object(r.jsx)(T.a,{children:"Default feed ID"}),Object(r.jsx)(T.a,{children:c?c.defaultFeedId:""})]})]})]})};function D(){var e=window;return{width:e.innerWidth,height:e.innerHeight}}var L=function(e){var t=e.workspaceUri,n=e.workspaceRoute,l=e.workspaceRouteDispatch,d=e.version,b=function(){var e=Object(s.useState)(D()),t=Object(i.a)(e,2),n=t[0],r=t[1];return Object(s.useEffect)((function(){function e(){r(D())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),f=b.width,j=b.height-52-2,O=f-0-2,p=Object(a.j)().filter((function(e){return"WorkspaceView"===e.name}))[0];if(!p)throw Error("Unable to find workspace view plugin");var m=Object(s.useState)(!1),h=Object(i.a)(m,2),v=h[0],I=h[1],y=Object(s.useReducer)(g,Object(s.useMemo)((function(){return{recordings:[],sortings:[]}}),[])),x=Object(i.a)(y,2),w=x[0],U=x[1],S=Object(s.useCallback)((function(e){e.filter((function(e){return e.action})).forEach((function(e){return U(e.action)}))}),[]),E=u(t),R=E.feedUri,M=E.workspaceName,T=Object(s.useMemo)((function(){return{workspaceName:M}}),[M]),N=Object(o.h)({feedUri:R,subfeedName:T,onMessages:S}).appendMessages,C=Object(s.useCallback)((function(e){N([{action:e}])}),[N]),L=Object(s.useCallback)((function(){I(!0)}),[]),G=Object(s.useCallback)((function(){I(!1)}),[]);return Object(r.jsxs)("div",{style:{margin:0},children:[Object(r.jsx)(k,{onOpenSettings:L,workspaceRouteDispatch:l}),Object(r.jsx)("div",{style:{position:"absolute",top:52},children:Object(r.jsx)(p.component,{width:O,height:j,workspace:w,workspaceDispatch:C,workspaceRoute:n,workspaceRouteDispatch:l})}),Object(r.jsx)(c.a,{open:v,onClose:G,style:{zIndex:9999},children:Object(r.jsx)("span",{children:Object(r.jsx)(_,{workspace:w,workspaceUri:t,version:d})})})]})};function G(e){e.registerPlugin({type:"MainWindow",name:"MainWindow",label:"Main Window",component:L})}}}]);
//# sourceMappingURL=25.2d3d9d6b.chunk.js.map