(this["webpackJsonplabbox-ephys"]=this["webpackJsonplabbox-ephys"]||[]).push([[24],{118:function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return f})),n.d(t,"i",(function(){return p})),n.d(t,"e",(function(){return g})),n.d(t,"h",(function(){return m})),n.d(t,"g",(function(){return h})),n.d(t,"j",(function(){return v}));var r=n(17),i=n(0),c=n(23),o=(n(2),n(38),function(e,t){if(e.min<=t&&t<e.max)return e;var n=e.max-e.min,r=Math.max(0,Math.floor(t-n/2));return{min:r,max:r+n}}),s=function(e,t){if("SetRecordingSelection"===t.type)return Object(c.a)({},t.recordingSelection);if("SetSelectedElectrodeIds"===t.type)return Object(c.a)(Object(c.a)({},e),{},{selectedElectrodeIds:t.selectedElectrodeIds.filter((function(t){return!e.visibleElectrodeIds||e.visibleElectrodeIds.includes(t)}))});if("SetVisibleElectrodeIds"===t.type)return Object(c.a)(Object(c.a)({},e),{},{visibleElectrodeIds:t.visibleElectrodeIds,selectedElectrodeIds:e.selectedElectrodeIds?e.selectedElectrodeIds.filter((function(e){return t.visibleElectrodeIds.includes(e)})):void 0});if("SetCurrentTimepoint"===t.type)return Object(c.a)(Object(c.a)({},e),{},{currentTimepoint:t.currentTimepoint||void 0,timeRange:t.ensureInRange&&e.timeRange&&null!==t.currentTimepoint?o(e.timeRange,t.currentTimepoint):e.timeRange});if("SetTimeRange"===t.type)return Object(c.a)(Object(c.a)({},e),{},{timeRange:t.timeRange});if("ZoomTimeRange"===t.type){var n,r,i=e.currentTimepoint,s=e.timeRange;if(!s)return e;var u,l=null!==(n=t.direction)&&void 0!==n?n:"in",d=null!==(r=t.factor)&&void 0!==r?r:1.4,b="out"===l?1/d:d;if((s.max-s.min)/b>9e6)return e;u=void 0===i||i<s.min?s.min:i>s.max?s.max:i;var f=a(s,b,u);return Object(c.a)(Object(c.a)({},e),{},{timeRange:f})}if("SetAmpScaleFactor"===t.type)return Object(c.a)(Object(c.a)({},e),{},{ampScaleFactor:t.ampScaleFactor});if("ScaleAmpScaleFactor"===t.type){var j,O,p=null!==(j=t.direction)&&void 0!==j?j:"up",g=null!==(O=t.multiplier)&&void 0!==O?O:1.4,m="down"===p?1/g:g;return Object(c.a)(Object(c.a)({},e),{},{ampScaleFactor:(e.ampScaleFactor||1)*m})}return"SetCurrentTimepointVelocity"===t.type?Object(c.a)(Object(c.a)({},e),{},{animation:Object(c.a)(Object(c.a)({},e.animation||{}),{},{currentTimepointVelocity:t.velocity})}):"SetWaveformsMode"===t.type?Object(c.a)(Object(c.a)({},e),{},{waveformsMode:t.waveformsMode}):"Set"===t.type?t.state:e},a=function(e,t,n){var r=n+(e.min-n)/t,i=n+(e.max-n)/t;return{min:Math.floor(r),max:Math.floor(i)}},u=n(33),l=function(e,t){return((t||{}).mergeGroups||[]).filter((function(t){return t.includes(e)}))[0]||null},d=function(e,t,n){return n&&l(e,t)||e},b=function(e,t){var n=l(e,t);return!n||Math.min.apply(Math,Object(u.a)(n))===e},f=function(e,t){return"SetSelection"===t.type?t.selection:"SetSelectedUnitIds"===t.type?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:t.selectedUnitIds.filter((function(t){var n;return!e.visibleUnitIds||(null===(n=e.visibleUnitIds)||void 0===n?void 0:n.includes(t))}))}):"SetVisibleUnitIds"===t.type?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((function(e){var n;return null===(n=t.visibleUnitIds)||void 0===n?void 0:n.includes(e)})):void 0,visibleUnitIds:t.visibleUnitIds}):"UnitClicked"===t.type?function(e,t){var n=t.unitId;return t.ctrlKey?(e.selectedUnitIds||[]).includes(n)?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:(e.selectedUnitIds||[]).filter((function(e){return e!==n}))}):Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:[].concat(Object(u.a)(e.selectedUnitIds||[]),[n])}):Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:[n]})}(e,t):"Set"===t.type?t.state:"ToggleApplyMerges"===t.type?j(Object(c.a)(Object(c.a)({},e),{},{applyMerges:!e.applyMerges}),t.curation):s(e,t)},j=function(e,t){return e.applyMerges&&t?Object(c.a)(Object(c.a)({},e),{},{selectedUnitIds:e.selectedUnitIds?e.selectedUnitIds.filter((function(e){return b(e,t)})):void 0}):e},O=function(e){return e.filter((function(e){return!e.disabled&&!e.development}))},p=function(e){return O(e).filter((function(e){return"SortingView"===e.type})).map((function(e){return e}))},g=function(e){return O(e).filter((function(e){return"RecordingView"===e.type})).map((function(e){return e}))},m=function(e){return O(e).filter((function(e){return"SortingUnitView"===e.type})).map((function(e){return e}))},h=function(e){return O(e).filter((function(e){return"SortingUnitMetric"===e.type})).map((function(e){return e}))},v=function(){var e=Object(r.g)();return Object(i.useMemo)((function(){return e.filter((function(e){return"WorkspaceView"===e.type})).map((function(e){return e}))}),[e])}},243:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){if(!e)return{feedUri:void 0,workspaceName:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,workspaceName:void 0};var t=e.split("/"),n=t[2]||void 0,r=t[3]||void 0;return n&&r?{feedUri:"feed://".concat(n),workspaceName:r}:{feedUri:void 0,workspaceName:void 0}}},255:function(e,t,n){"use strict";n.d(t,"b",(function(){return o}));var r=n(42),i=n(33),c=n(23),o=function(e,t){if("SET_CURATION"===t.type)return t.curation;if("ADD_UNIT_LABEL"===t.type){var n=t.unitId+"",o=(e.labelsByUnit||{})[n]||[];return o.includes(t.label)?e:Object(c.a)(Object(c.a)({},e),{},{labelsByUnit:Object(c.a)(Object(c.a)({},e.labelsByUnit),{},Object(r.a)({},n,[].concat(Object(i.a)(o),[t.label]).sort()))})}if("REMOVE_UNIT_LABEL"===t.type){var s=t.unitId+"",a=(e.labelsByUnit||{})[s]||[];return a.includes(t.label)?Object(c.a)(Object(c.a)({},e),{},{labelsByUnit:Object(c.a)(Object(c.a)({},e.labelsByUnit),{},Object(r.a)({},s,a.filter((function(e){return e!==t.label}))))}):e}return"MERGE_UNITS"===t.type?Object(c.a)(Object(c.a)({},e),{},{mergeGroups:u([].concat(Object(i.a)(e.mergeGroups||[]),[t.unitIds]))}):"UNMERGE_UNITS"===t.type?Object(c.a)(Object(c.a)({},e),{},{mergeGroups:u((e.mergeGroups||[]).map((function(e){return e.filter((function(e){return!t.unitIds.includes(e)}))})))}):e},s=function(e,t){return e.filter((function(e){return t.includes(e)}))},a=function(e,t){return[].concat(Object(i.a)(e),Object(i.a)(t.filter((function(t){return!e.includes(t)})))).sort()},u=function(e){for(var t=e.map((function(e){return Object(i.a)(e)})),n=!0;n;){n=!1;for(var r=0;r<t.length;r++)for(var c=t[r],o=r+1;o<t.length;o++){var u=t[o];s(c,u).length>0&&(t[r]=a(c,u),t[o]=[],n=!0)}}return t.filter((function(e){return e.length>=2}))};t.a=function(e,t){switch(t.type){case"ADD_RECORDING":return Object(c.a)(Object(c.a)({},e),{},{recordings:[].concat(Object(i.a)(e.recordings.filter((function(e){return e.recordingId!==t.recording.recordingId}))),[t.recording])});case"DELETE_RECORDINGS":return Object(c.a)(Object(c.a)({},e),{},{recordings:e.recordings.filter((function(e){return!t.recordingIds.includes(e.recordingId)}))});case"ADD_SORTING":return Object(c.a)(Object(c.a)({},e),{},{sortings:[].concat(Object(i.a)(e.sortings.filter((function(e){return e.sortingId!==t.sorting.sortingId}))),[t.sorting])});case"DELETE_SORTINGS":return Object(c.a)(Object(c.a)({},e),{},{sortings:e.sortings.filter((function(e){return!t.sortingIds.includes(e.sortingId)}))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object(c.a)(Object(c.a)({},e),{},{sortings:e.sortings.filter((function(e){return!t.recordingIds.includes(e.recordingId)}))});case"SET_UNIT_METRICS_FOR_SORTING":return Object(c.a)(Object(c.a)({},e),{},{sortings:e.sortings.map((function(e){return e.sortingId===t.unitMetricsForSorting.sortingId?Object(c.a)(Object(c.a)({},e),{},{unitMetricsUri:t.unitMetricsForSorting.metricsUri}):e}))});default:return e}}},718:function(e,t,n){"use strict";n.r(t),n.d(t,"activate",(function(){return T}));var r=n(10),i=n(12),c=n(680),o=n(17),s=n(0),a=n(118),u=n(243),l=n(255),d=n(707),b=n(611),f=function(){var e=Object(s.useState)([]),t=Object(i.a)(e,2),n=t[0],c=t[1],a=Object(s.useContext)(o.a);Object(s.useEffect)((function(){var e=setInterval((function(){var e=a.getHitherJobs();c(e)}),1e3);return function(){clearInterval(e)}}),[a]);var u={pendingJobs:n.filter((function(e){return"pending"===e.status})),runningJobs:n.filter((function(e){return"running"===e.status})),finishedJobs:n.filter((function(e){return"finished"===e.status})),erroredJobs:n.filter((function(e){return"error"===e.status}))},l=u.runningJobs,d=u.finishedJobs,b=u.erroredJobs,f=u.pendingJobs.length,j=l.length,O=d.length,p=b.length,g="Jobs: ".concat(f," pending | ").concat(j," running | ").concat(O," finished | ").concat(p," errored"),m=p>0?Object(r.jsxs)("span",{children:[":",Object(r.jsx)("span",{style:{color:"pink"},children:p})]}):Object(r.jsx)("span",{});return Object(r.jsxs)("span",{title:g,style:{fontFamily:"courier"},children:[f,":",j,":",O,m]})},j=n(190),O=n(702),p=n(705),g=n(706),m=function(e){var t=e.color,n=Object(s.useContext)(o.c),i=n.websocketStatus,c=n.onReconnectWebsocket,a=Object(s.useMemo)((function(){switch(i){case"waiting":return{icon:Object(r.jsx)(O.a,{style:{color:"blue"}}),title:"Loading..."};case"connected":return{icon:Object(r.jsx)(p.a,{style:{color:t}}),title:"Connected"};case"disconnected":return{icon:Object(r.jsx)(g.a,{style:{color:"red"}}),title:"Disconnected from server. Click to attempt reconnect."};default:throw Error("Unexpected.")}}),[i,t]),u=a.icon,l=a.title,d=Object(s.useCallback)((function(){"disconnected"===i&&c()}),[i,c]);return Object(r.jsx)(j.a,{title:l,onClick:d,children:u})},h=n(634),v=function(e){var t=e.onOpenSettings,n=e.color,i=Object(s.useMemo)((function(){return{icon:Object(r.jsx)(h.a,{}),title:"Open settings"}}),[]),c=i.icon,o=i.title,a=Object(s.useCallback)((function(){t()}),[t]);return Object(r.jsx)(j.a,{style:{color:n},title:o,onClick:a,children:c})},I={paddingBottom:0,color:"white",fontFamily:"sans-serif",fontWeight:"bold",cursor:"pointer"},y=function(e){var t=e.onOpenSettings,n=e.workspaceRouteDispatch,i=e.logo,c=Object(s.useCallback)((function(){n({type:"gotoRecordingsPage"})}),[n]);return Object(r.jsx)(d.a,{position:"static",style:{height:50,color:"white"},children:Object(r.jsxs)(b.a,{children:[i&&Object(r.jsx)("img",{src:i,className:"App-logo",alt:"logo",height:30,style:{paddingBottom:5,cursor:"pointer"},onClick:c}),"\xa0\xa0\xa0",Object(r.jsx)("div",{style:I,onClick:c,children:"Labbox Ephys"}),Object(r.jsx)("span",{style:{marginLeft:"auto"}}),Object(r.jsxs)("span",{style:{paddingBottom:0,color:"white"},children:[Object(r.jsx)(v,{onOpenSettings:t,color:"white"}),Object(r.jsx)(m,{color:"white"}),Object(r.jsx)(f,{})]})]})})},x=n(194),w=n(195),S=n(196),U=n(708),k=Object(U.a)((function(e){return{paper:{left:100,top:100,right:100,bottom:100,position:"absolute",backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),overflow:"auto"}}})),E=function(e){var t=e.workspaceUri,n=e.version,i=k(),c=Object(s.useContext)(o.c).serverInfo,a=Object(u.a)(t).workspaceName;return Object(r.jsxs)("div",{className:i.paper,style:{zIndex:9999},children:[Object(r.jsxs)("h2",{children:["Labbox Ephys ",n]}),Object(r.jsxs)(x.a,{children:[Object(r.jsxs)(w.a,{children:[Object(r.jsx)(S.a,{children:"Workspace URI"}),Object(r.jsx)(S.a,{children:t||""})]}),Object(r.jsxs)(w.a,{children:[Object(r.jsx)(S.a,{children:"Workspace name"}),Object(r.jsx)(S.a,{children:a})]}),Object(r.jsxs)(w.a,{children:[Object(r.jsx)(S.a,{children:"Kachery node ID"}),Object(r.jsx)(S.a,{children:c?c.nodeId:""})]}),Object(r.jsxs)(w.a,{children:[Object(r.jsx)(S.a,{children:"Default feed ID"}),Object(r.jsx)(S.a,{children:c?c.defaultFeedId:""})]})]})]})};function R(){var e=window;return{width:e.innerWidth,height:e.innerHeight}}var M=function(e){var t=e.workspaceUri,n=e.workspaceRoute,d=e.workspaceRouteDispatch,b=e.version,f=function(){var e=Object(s.useState)(R()),t=Object(i.a)(e,2),n=t[0],r=t[1];return Object(s.useEffect)((function(){function e(){r(R())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),j=f.width,O=f.height-52-2,p=j-0-2,g=Object(a.j)().filter((function(e){return"WorkspaceView"===e.name}))[0];if(!g)throw Error("Unable to find workspace view plugin");var m=Object(s.useState)(!1),h=Object(i.a)(m,2),v=h[0],I=h[1],x=Object(s.useReducer)(l.a,Object(s.useMemo)((function(){return{recordings:[],sortings:[]}}),[])),w=Object(i.a)(x,2),S=w[0],U=w[1],k=Object(s.useCallback)((function(e){e.filter((function(e){return e.action})).forEach((function(e){return U(e.action)}))}),[]),M=Object(u.a)(t),T=M.feedUri,C=M.workspaceName,N=Object(s.useMemo)((function(){return{workspaceName:C}}),[C]),D=Object(o.h)({feedUri:T,subfeedName:N,onMessages:k}).appendMessages,_=Object(s.useCallback)((function(e){D([{action:e}])}),[D]),G=Object(s.useCallback)((function(){I(!0)}),[]),F=Object(s.useCallback)((function(){I(!1)}),[]);return Object(r.jsxs)("div",{style:{margin:0},children:[Object(r.jsx)(y,{onOpenSettings:G,workspaceRouteDispatch:d}),Object(r.jsx)("div",{style:{position:"absolute",top:52},children:Object(r.jsx)(g.component,{width:p,height:O,workspace:S,workspaceDispatch:_,workspaceRoute:n,workspaceRouteDispatch:d})}),Object(r.jsx)(c.a,{open:v,onClose:F,style:{zIndex:9999},children:Object(r.jsx)("span",{children:Object(r.jsx)(E,{workspace:S,workspaceUri:t,version:b})})})]})};function T(e){e.registerPlugin({type:"MainWindow",name:"MainWindow",label:"Main Window",component:M})}}}]);
//# sourceMappingURL=24.3398e533.chunk.js.map