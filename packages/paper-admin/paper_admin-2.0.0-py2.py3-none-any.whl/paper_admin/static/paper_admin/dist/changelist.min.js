(self.webpackChunkpaperAdmin=self.webpackChunkpaperAdmin||[]).push([[434],{7394:function(e,t,n){"use strict";n.r(t);var o=n(1474);function i(e){this._buildTree(e)}i.prototype._createNode=function(e){const t=e.dataset;return{pk:parseInt(t.id),parent:parseInt(t.parent),element:e,childs:[]}},i.prototype._addNode=function(e){return!(!e||"number"!=typeof e.pk)&&(this._nodes[e.pk]=e,isNaN(e.parent)&&this._roots.push(e),!0)},i.prototype.getNode=function(e){if(null===this._nodes)throw new Error("tree is empty");if(!(e in this._nodes))throw new Error(`node ${e} not found`);return this._nodes[e]},i.prototype._buildTree=function(e){const t=[];this._nodes={},this._roots=[],e.forEach(function(e){let n=this._createNode(e);for(this._addNode(n);t.length;){let e=t[0];if(n.parent===e.pk)return e.childs.push(n.pk),void t.unshift(n);t.shift()}t.unshift(n)}.bind(this))},i.prototype.getRoots=function(){if(null===this._roots)throw new Error("tree is empty");return this._roots.map(function(e){return e.element}.bind(this))},i.prototype.getDescendants=function(e){return this.getNode(e).childs.reduce(function(e,t){let n=this.getNode(t);return n&&(e.push(n.element),e=e.concat(this.getDescendants(t))),e}.bind(this),[])};var s=i;function r(e,t){this.opts=Object.assign({className:"highlight",staggerMin:12,staggerMax:50},t),this._elements=e,this._isReleased=!1,this._timer=this._createTimer()}r.prototype._createTimer=function(){let e=0;const t=this._elements.length,n=Math.max(this.opts.staggerMin,2*this.opts.staggerMax/t);return setInterval(function(){e<t?(this._elements[e].classList.add(this.opts.className),e++):(this._destroyTimer(),this._isReleased&&this._removeClass())}.bind(this),n)},r.prototype._destroyTimer=function(){null!==this._timer&&(clearInterval(this._timer),this._timer=null)},r.prototype._removeClass=function(){this._elements.forEach(function(e){e.classList.remove(this.opts.className)}.bind(this))},r.prototype.release=function(){this._isReleased=!0,null===this._timer&&this._removeClass()};var a=r;function c(e,t){if(this.opts=Object.assign({url:null,tree:!1,handler:".handler",disabledClass:"disabled"},t),this.table=e,this.tbody=e.querySelector("tbody"),!this.tbody)throw new Error("table body not found");this.tree=null,this._createSortable()}c.prototype._createSortable=function(){return o.ZP.create(this.tbody,{animation:0,draggable:"tr",handle:this.opts.handler,filter:"."+this.opts.disabledClass,ghostClass:"sortable-ghost",onStart:this._onStart.bind(this),onMove:this._onMove.bind(this),onEnd:this._onEnd.bind(this)})},c.prototype._onStart=function(e){const t=this.tbody.querySelectorAll("tr");this.opts.tree&&(this.tree=new s(t));const n=parseInt(e.item.dataset.parent);t.forEach(function(e){const t=parseInt(e.dataset.parent);isNaN(t)&&isNaN(n)||t===n||e.classList.add(this.opts.disabledClass)}.bind(this))},c.prototype._onMove=function(e){return!e.related.classList.contains(this.opts.disabledClass)},c.prototype._onEnd=function(e){this.tbody.querySelectorAll("tr").forEach(function(e){e.classList.remove(this.opts.disabledClass)}.bind(this));let t=this._getMovedRows(e);if(!t.length)return;this._normalizeTable(e,t);const n=this._createOrderMap(e,t),o=new a(t);this._sendRequest(n).then((function(){o.release()}))},c.prototype._getMovedRows=function(e){const t=Math.min(e.oldIndex,e.newIndex),n=Math.max(e.oldIndex,e.newIndex),o=this.tbody.querySelectorAll("tr");let i=Array.prototype.slice.call(o,t,n+1);if(this.tree){const t=parseInt(e.item.dataset.id),n=this.tree.getNode(t);i=i.filter((function(e){return parseInt(e.dataset.parent)===n.parent}))}return i},c.prototype._createOrderMap=function(e,t){const n=[],o=[];t.forEach(function(e){const t=e.querySelector(this.opts.handler);t&&(n.push(parseInt(e.dataset.id)),o.push(parseInt(t.dataset.order)))}.bind(this));return e.oldIndex<e.newIndex?o.unshift(o.pop()):o.push(o.shift()),n.reduce(function(e,t,n){e[t]=o[n];return this.tbody.querySelector("tr[data-id='"+t+"']").querySelector(this.opts.handler).setAttribute("data-order",o[n]),e}.bind(this),{})},c.prototype._normalizeTable=function(e,t){if(this.tree){const n=parseInt(e.item.dataset.id),o=this.tree.getNode(n),i=e.item.previousElementSibling,s=e.item.nextElementSibling,r=t.slice();if(i&&s){const e=parseInt(i.dataset.parent)===o.parent,t=parseInt(s.dataset.parent)===parseInt(i.dataset.id);e&&t&&r.indexOf(i)<0&&r.unshift(i)}r.forEach(function(e){const t=parseInt(e.dataset.id),n=this.tree.getDescendants(t);Element.prototype.after.apply(e,n)}.bind(this))}},c.prototype._sendRequest=function(e){return fetch(this.opts.url,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){if(!e.ok){const t=new Error(`${e.status} ${e.statusText}`);throw t.response=e,t}}))};var d=c,l=(n(4008),n(8103),n(8961),n(878));window.addEventListener("keydown",(function(e){if(!e.defaultPrevented&&e.ctrlKey){const t=document.getElementById("paper-main").querySelector(".pagination");if(!t)return;switch(e.key){case"Left":case"ArrowLeft":t.querySelector('.page-link[aria-label="Previous"]').click();break;case"Right":case"ArrowRight":t.querySelector('.page-link[aria-label="Next"]').click();break;default:return}e.preventDefault()}}));const u=document.getElementById("result_list");u&&u.classList.contains("table-sortable")&&(u.classList.contains("table-sortable-allowed")?new d(u,{url:u.dataset.orderUrl,tree:u.classList.contains("table-mptt"),handler:".sort-handler"}):l(u).find(".sort-handler").tooltip({title:gettext("Sort list by this column to enable ordering"),placement:"bottom",trigger:"hover",html:!0,delay:{show:300,hide:100}}))},8103:function(e,t,n){!function(e){"use strict";function t(e){return e=(e=e.replace(/\./g,"__dot__")).replace(/-/g,"__dash__")}function n(e){return e=(e=e.replace(/__dot__/g,".")).replace(/__dash__/g,"-")}function o(e,n,o){let i=e.id.replace(n,"");i=t(i);let s=e.href;o&&(-1===s.indexOf("?")?s+="?_popup=1":s+="&_popup=1");const r=void 0!==window.screenX?window.screenX:window.screenLeft,a=void 0!==window.screenY?window.screenY:window.screenTop,c=void 0!==window.outerWidth?window.outerWidth:document.body.clientWidth,d=void 0!==window.outerHeight?window.outerHeight:document.body.clientHeight,l=a+Math.round((d-600)/2),u=r+Math.round((c-940)/2);return window.open(s,i,"width=940,height=600,top="+l+",left="+u+",resizable=yes,scrollbars=yes").focus(),!1}function i(e){return o(e,/^lookup_/,!0)}function s(e){return o(e,/^(change|add|delete)_/,!1)}function r(t){const n=e(t),o=n.closest(".related-widget-wrapper").find(".view-related, .change-related, .delete-related");if(!o.length)return;const i=n.val();i?o.each((function(){const t=e(this);t.attr("href",t.attr("data-href-template").replace("__fk__",i))})):o.removeAttr("href")}function a(t,o,i){const s=n(t.name),r=document.getElementById(s);if(r){const t=r.nodeName.toUpperCase();"SELECT"===t?r.options[r.options.length]=new Option(i,o,!0,!0):"INPUT"===t&&(-1!==r.className.indexOf("vManyToManyRawIdAdminField")&&r.value?r.value+=","+o:r.value=o),e(r).trigger("change")}t.close()}window.id_to_windowname=t,window.windowname_to_id=n,window.showRelatedObjectLookupPopup=i,window.dismissRelatedLookupPopup=function(e,t){const o=n(e.name),i=document.getElementById(o);-1!==i.className.indexOf("vManyToManyRawIdAdminField")&&i.value?i.value+=","+t:document.getElementById(o).value=t,e.close()},window.showRelatedObjectPopup=s,window.updateRelatedObjectLinks=r,window.dismissAddRelatedObjectPopup=a,window.dismissChangeRelatedObjectPopup=function(t,o,i,s){const r=n(t.name).replace(/^edit_/,"");e("#"+r).find("option").each((function(){this.value===o&&(this.textContent=i,this.value=s)})),t.close()},window.dismissDeleteRelatedObjectPopup=function(t,o){const i=n(t.name).replace(/^delete_/,"");e("#"+i).find("option").each((function(){this.value===o&&e(this).remove()})).trigger("change"),t.close()},window.showAddAnotherPopup=s,window.dismissAddAnotherPopup=a,e(document).ready((function(){e("a[data-popup-opener]").on("click",(function(t){t.preventDefault(),opener.dismissRelatedLookupPopup(window,e(this).data("popup-opener"))})),e("body").on("click",".related-widget-wrapper-link",(function(t){if(t.preventDefault(),this.href){const t=e.Event("django:show-related",{href:this.href});e(this).trigger(t),t.isDefaultPrevented()||s(this)}})).on("change",".related-widget-wrapper select",(function(){const t=e.Event("django:update-related");e(this).trigger(t),t.isDefaultPrevented()||r(this)})).on("change",".related-widget-wrapper input",(function(){this.checked&&r(this)})).on("click",".related-lookup",(function(t){t.preventDefault();const n=e.Event("django:lookup-related");e(this).trigger(n),n.isDefaultPrevented()||i(this)})),e(".related-widget-wrapper select").trigger("change"),e(".related-widget-wrapper input:checked").trigger("change")}))}(n(878))},4008:function(){const e="action-toggle",t=".action-checkbox .vCustomCheckbox";function n(e,t){e.forEach((function(e){e&&"TR"===e.tagName&&e.dispatchEvent(new CustomEvent("select",{bubbles:!0,cancelable:!0,detail:{state:t}}))}))}function o(e){const t=e.reduce(((e,t)=>e+(t.checked?1:0)),0);document.querySelectorAll(".action-counter").forEach((function(e){e.innerHTML=interpolate(ngettext("%(sel)s of %(cnt)s selected","%(sel)s of %(cnt)s selected",t),{sel:t,cnt:e.dataset.actionsIcnt},!0)})),t===e.length?function(){const e=document.querySelector(".action-question");e&&(e.hidden=!1)}():s(e)}function i(e){document.querySelectorAll(".select-across").forEach((function(t){t.value=Number(e)}))}function s(e){i(!1);const t=document.querySelector(".action-counter");t&&(t.hidden=!1);const n=document.querySelector(".action-all");n&&(n.hidden=!0);const o=e.reduce(((e,t)=>e+(t.checked?1:0)),0),s=document.querySelector(".action-question");s&&(s.hidden=o!==e.length);const r=document.querySelector(".action-clear");r&&(r.hidden=!0)}const r=document.querySelectorAll(".action-select");r.length&&function(r){let a=null;const c=document.getElementById("result_list"),d=document.getElementById(e);d.addEventListener("change",(function(){n(r.map((e=>e.closest("tr"))),this.checked),o(r)})),c.addEventListener("select",(function(e){const t=e.target;if("TR"!==t.tagName||t.closest("table")!==c)return;const n=Boolean(e.detail.state);t.querySelector(".action-select").checked=n,t.classList.toggle("selected",n),d.checked=null==r.find((e=>!e.checked))})),c.addEventListener("click",(function(e){const i=e.target,s=i.closest("tr"),c=i.closest(t),d=s&&s.querySelector(t),l=d&&d.querySelector(".action-select");if(s){if(c&&e.preventDefault(),e.shiftKey&&a&&a!==l){const e=r.indexOf(a),t=r.indexOf(l),o=Math.min(e,t),i=Math.max(e,t);n(r.slice(o,i+1).map((e=>e.closest("tr"))),a.checked)}else(c||e.ctrlKey&&!e.shiftKey)&&(a=l,n([s],!l.checked));o(r)}})),c.addEventListener("mousedown",(function(e){const t=e.target;!e.shiftKey||"TD"!==t.tagName&&"TH"!==t.tagName||e.preventDefault()})),document.addEventListener("click",(function(e){const t=e.target;"A"===t.tagName&&t.closest(".action-question")&&(e.preventDefault(),function(){i(!0);const e=document.querySelector(".action-counter");e&&(e.hidden=!0);const t=document.querySelector(".action-all");t&&(t.hidden=!1);const n=document.querySelector(".action-question");n&&(n.hidden=!0);const o=document.querySelector(".action-clear");o&&(o.hidden=!1)}())})),document.addEventListener("click",(function(e){const t=e.target;"A"===t.tagName&&t.closest(".action-clear")&&(e.preventDefault(),d.checked=!1,n(r.map((e=>e.closest("tr"))),!1),s(r),o(r))})),function(){let t=!1;const n=document.getElementById("changelist_form");n.addEventListener("change",(function(n){const o=n.target;"INPUT"===o.tagName?o.closest(".action-select")||o.id===e||(t=!0):"SELECT"===o.tagName&&o.closest(".action-action")||(t=!0)})),n.addEventListener("click",(function(e){e.target.closest('[name="index"]')&&t&&(confirm(gettext("You have unsaved changes on individual editable fields. If you run an action, your unsaved changes will be lost."))||e.preventDefault())})),n.addEventListener("click",(function(e){const n=e.target.closest('[name="_save"]'),o=document.querySelectorAll('.actions select[name="action"]'),i=!Array.prototype.every.call(o,(function(e){return!e.value}));if(n&&i){let n;n=t?confirm(gettext("You have selected an action, but you haven't saved your changes to individual fields yet. Please click OK to save. You'll need to re-run the action.")):confirm(gettext("You have selected an action, and you haven't made any changes on individual fields. You're probably looking for the Go button rather than the Save button.")),n||e.preventDefault()}}))}()}(Array.from(r))},8961:function(){const e=document.querySelector(".paper-search-form"),t=e&&e.querySelector(".form-control");t&&t.addEventListener("focus",(function(){this.select()}))}}]);
//# sourceMappingURL=changelist.min.js.map