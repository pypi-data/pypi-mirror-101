(self.webpackChunklabbox_ephys_widgets_jp=self.webpackChunklabbox_ephys_widgets_jp||[]).push([[923],{4923:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>k,useWorkspaceRoute:()=>O});var t=r(22954),i=r(5443),n=r(69297),a=r.n(n),o=r(95849),c=r(46470),g=r(6425),d=r(85582);const u=(e,s)=>{const r=e.pathname.split("/"),t=d.parse(e.search.slice(1)).workspace||"default",i=null==s?void 0:s.defaultFeedId,n=t.startsWith("workspace://")?t:i?`workspace://${i}/${t}`:void 0,a=r[1]||"recordings";if(!["recordings","recording","sorting"].includes(a))throw Error(`Invalid page: ${a}`);switch(a){case"recordings":return{workspaceUri:n,page:a};case"recording":return{workspaceUri:n,page:a,recordingId:r[2]};case"sorting":return{workspaceUri:n,page:a,recordingId:r[2]||"",sortingId:r[3]||""};default:return{workspaceUri:n,page:"recordings"}}};var p=e=>{const s=Object.keys(e);return 0===s.length?"":"?"+s.map((s=>encodeURIComponent(s)+"="+encodeURIComponent(e[s]))).join("&")},l=r(40788),b=r(4791),f=r(52978);const h={palette:{primary:l.Z,secondary:b.Z},overrides:{MuiAccordionSummary:{root:{"&$expanded":{minHeight:0,maxHeight:30,paddingTop:10},minHeight:0}},MuiToolbar:{regular:{minHeight:48,"@media(min-width:600px)":{minHeight:48}}},MuiTabs:{root:{minHeight:30,maxHeight:30}},MuiTab:{root:{minHeight:30,maxHeight:30,padding:"6px 0px"}}}},I=(0,f.Z)(h);var m=r(19973);const O=(e,s,r)=>{const t=(0,n.useMemo)((()=>r=>{const t=(e=>{const s={};switch(e.workspaceUri&&(s.workspace=e.workspaceUri),e.page){case"recordings":return{pathname:"/",search:p(s)};case"recording":return{pathname:`/recording/${e.recordingId}`,search:p(s)};case"sorting":return{pathname:`/sorting/${e.recordingId}/${e.sortingId}`,search:p(s)}}})(((e,s)=>{let r=e;switch(s.type){case"gotoRecordingsPage":r={page:"recordings",workspaceUri:e.workspaceUri};break;case"gotoRecordingPage":r={page:"recording",recordingId:s.recordingId,workspaceUri:e.workspaceUri};break;case"gotoSortingPage":r={page:"sorting",recordingId:s.recordingId,sortingId:s.sortingId,workspaceUri:e.workspaceUri}}return r})(u(s.location,{}),r));t.pathname===e.pathname&&t.search===e.search||s.push(t)}),[e,s]);return[(0,n.useMemo)((()=>u(e,{})),[e]),t]},k=({workspaceUri:e,onWorkspaceRouteChanged:s})=>{const r=(0,i._m)(),d=(0,n.useCallback)((e=>{e.forEach((e=>{e.action&&k(e.action)}))}),[]),{feedUri:u,workspaceName:p}=(0,c.x)(e),l=(0,n.useMemo)((()=>({workspaceName:p||""})),[p]),{appendMessages:b,loadedInitialMessages:f}=(0,i.Rs)({feedUri:u,subfeedName:l,onMessages:d}),[h,k]=(0,n.useReducer)(g.Z,{recordings:[],sortings:[]}),U=(0,n.useCallback)((e=>{b([{action:e}])}),[b]),[w,E]=(0,n.useState)(null),[j,R]=(0,n.useState)(void 0),[_,N]=(0,n.useState)(void 0),[S,T]=(0,n.useState)(0),v=a().useCallback((e=>{E(e)}),[]);(0,n.useEffect)((()=>{w&&(j!==w.offsetWidth&&R(w.offsetWidth),_!==w.offsetHeight&&N(w.offsetHeight))}),[w,j,_,R,N,S]),function(e,s){const r=(0,n.useRef)();(0,n.useEffect)((()=>{r.current=e})),(0,n.useEffect)((()=>{{const e=setInterval((function(){void 0!==(null==r?void 0:r.current)&&(null==r||r.current())}),s);return()=>clearInterval(e)}}),[s])}((()=>{T(S+1)}),1e3);const[M,y]=(0,n.useState)({pathname:"",search:"?"}),[D,G]=(0,n.useState)([]),C=(0,n.useMemo)((()=>({location:M,push:e=>{G([...D,M]),y(e)}})),[M,D]),[x,H]=O(M,C,e);return(0,n.useEffect)((()=>{s&&s(x)}),[x,s]),a().createElement(t.Z,{theme:I},a().createElement("div",{ref:v,className:"WorkspaceViewWrapper",style:{position:"absolute",left:0,right:0,top:0,bottom:0}},a().createElement(m.Z,Object.assign({},{defaultFeedId:"",workspace:h,workspaceDispatch:U,plugins:(0,o.qG)(r),workspaceRoute:x,workspaceRouteDispatch:H,width:j||700,height:_||700}))))}},46470:(e,s,r)=>{"use strict";r.d(s,{x:()=>t});const t=e=>{if(!e)return{feedUri:void 0,workspaceName:void 0};if(!e.startsWith("workspace://"))return{feedUri:void 0,workspaceName:void 0};const s=e.split("/"),r=s[2]||void 0,t=s[3]||void 0;return r&&t?{feedUri:`feed://${r}`,workspaceName:t}:{feedUri:void 0,workspaceName:void 0}}},6425:(e,s,r)=>{"use strict";r.d(s,{Z:()=>o});const t=(e,s)=>{if("SET_CURATION"===s.type)return s.curation;if("ADD_UNIT_LABEL"===s.type){const r=s.unitId+"",t=(e.labelsByUnit||{})[r]||[];return t.includes(s.label)?e:Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[r]:[...t,s.label].sort()})})}if("REMOVE_UNIT_LABEL"===s.type){const r=s.unitId+"",t=(e.labelsByUnit||{})[r]||[];return t.includes(s.label)?Object.assign(Object.assign({},e),{labelsByUnit:Object.assign(Object.assign({},e.labelsByUnit),{[r]:t.filter((e=>e!==s.label))})}):e}return"MERGE_UNITS"===s.type?Object.assign(Object.assign({},e),{mergeGroups:a([...e.mergeGroups||[],s.unitIds])}):"UNMERGE_UNITS"===s.type?Object.assign(Object.assign({},e),{mergeGroups:a((e.mergeGroups||[]).map((e=>e.filter((e=>!s.unitIds.includes(e))))))}):e},i=(e,s)=>e.filter((e=>s.includes(e))),n=(e,s)=>[...e,...s.filter((s=>!e.includes(s)))].sort(),a=e=>{const s=e.map((e=>[...e]));let r=!0;for(;r;){r=!1;for(let e=0;e<s.length;e++){const t=s[e];for(let a=e+1;a<s.length;a++){const o=s[a];i(t,o).length>0&&(s[e]=n(t,o),s[a]=[],r=!0)}}}return s.filter((e=>e.length>=2))},o=(e,s)=>{switch(s.type){case"ADD_RECORDING":return Object.assign(Object.assign({},e),{recordings:[...e.recordings.filter((e=>e.recordingId!==s.recording.recordingId)),s.recording]});case"DELETE_RECORDINGS":return Object.assign(Object.assign({},e),{recordings:e.recordings.filter((e=>!s.recordingIds.includes(e.recordingId)))});case"ADD_SORTING":return Object.assign(Object.assign({},e),{sortings:[...e.sortings.filter((e=>e.sortingId!==s.sorting.sortingId)),s.sorting]});case"DELETE_SORTINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!s.sortingIds.includes(e.sortingId)))});case"DELETE_SORTINGS_FOR_RECORDINGS":return Object.assign(Object.assign({},e),{sortings:e.sortings.filter((e=>!s.recordingIds.includes(e.recordingId)))});case"ADD_UNIT_LABEL":case"REMOVE_UNIT_LABEL":case"MERGE_UNITS":case"UNMERGE_UNITS":return Object.assign(Object.assign({},e),{sortings:e.sortings.map((e=>e.sortingId===s.sortingId?Object.assign(Object.assign({},e),{curation:t(e.curation||{},s)}):e))});case"SET_UNIT_METRICS_FOR_SORTING":return Object.assign(Object.assign({},e),{sortings:e.sortings.map((e=>e.sortingId===s.unitMetricsForSorting.sortingId?Object.assign(Object.assign({},e),{unitMetricsUri:s.unitMetricsForSorting.metricsUri}):e))});default:return e}}}}]);