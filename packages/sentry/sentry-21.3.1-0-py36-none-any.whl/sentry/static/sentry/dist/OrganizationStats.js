(self.webpackChunk=self.webpackChunk||[]).push([["OrganizationStats"],{"./app/components/charts/errorPanel.tsx":(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});const r=(0,n("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js").Z)("div",{target:"esa86kh0",label:"ErrorPanel"})("display:flex;justify-content:center;align-items:center;flex:1;flex-shrink:0;overflow:hidden;height:",(function(t){return t.height||"200px"}),";position:relative;border-color:transparent;margin-bottom:0;color:",(function(t){return t.theme.gray300}),";font-size:",(function(t){return t.theme.fontSizeExtraLarge}),";")},"./app/components/charts/optionSelector.tsx":(t,e,n)=>{"use strict";n.d(e,{Z:()=>E});var r=n("../../../../node_modules/@babel/runtime/helpers/extends.js"),a=n.n(r),o=n("../../../../node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(o),i=n("../../../../node_modules/@babel/runtime/helpers/createClass.js"),l=n.n(i),c=n("../../../../node_modules/@babel/runtime/helpers/inherits.js"),u=n.n(c),d=n("../../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),p=n.n(d),h=n("../../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),f=n.n(h),g=n("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),m=n("../../../../node_modules/react/index.js"),v=n("../../../../node_modules/lodash/isEqual.js"),y=n.n(v),b=n("./app/components/charts/styles.tsx"),Z=n("./app/components/dropdownBubble.tsx"),x=n("./app/components/dropdownButton.tsx"),j=n("./app/components/dropdownControl.tsx"),C=n("./app/components/dropdownMenu.tsx"),S=n("./app/components/tooltip.tsx"),D=n("./app/styles/space.tsx"),w=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");var P=function(t){u()(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=f()(e);if(n){var a=f()(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return p()(this,t)});function o(){var t;s()(this,o);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(t=r.call.apply(r,[this].concat(n))).state={},t.menuContainerRef=m.createRef(),t}return l()(o,[{key:"componentDidMount",value:function(){this.setMenuContainerWidth()}},{key:"shouldComponentUpdate",value:function(t,e){return!y()(t,this.props)||!y()(e,this.state)}},{key:"componentDidUpdate",value:function(t){t.selected!==this.props.selected&&this.setMenuContainerWidth()}},{key:"setMenuContainerWidth",value:function(){var t,e,n=null===(t=this.menuContainerRef)||void 0===t||null===(e=t.current)||void 0===e?void 0:e.offsetWidth;n&&this.setState({menuContainerWidth:n})}},{key:"render",value:function(){var t=this.state.menuContainerWidth,e=this.props,n=e.options,r=e.onChange,o=e.selected,s=e.title,i=e.menuWidth,l=n.find((function(t){return o===t.value}))||n[0];return(0,w.tZ)(b.m2,null,(0,w.tZ)(b.OT,null,s),(0,w.tZ)(O,{ref:this.menuContainerRef},(0,w.tZ)(C.Z,{alwaysRenderMenu:!1},(function(e){var s=e.isOpen,c=e.getMenuProps,u=e.getActorProps;return(0,w.tZ)(m.Fragment,null,(0,w.tZ)(T,a()({},u(),{size:"zero",isOpen:s}),l.label),(0,w.tZ)(k,a()({},c(),{alignMenu:"right",width:i,minWidth:t,isOpen:s,blendWithActor:!1,blendCorner:!0}),n.map((function(t){return(0,w.tZ)(R,{key:t.value,onSelect:r,eventKey:t.value,disabled:t.disabled,isActive:o===t.value,"data-test-id":"option-".concat(t.value)},(0,w.tZ)(S.Z,{title:t.tooltip,containerDisplayMode:"inline"},t.label))}))))}))))}}]),o}(m.Component);P.displayName="OptionSelector",P.defaultProps={menuWidth:"auto"};var O=(0,g.Z)("div",{target:"evcxx5l0",label:"MenuContainer"})({name:"b3pn3b",styles:"display:inline-block;position:relative;"}),T=(0,g.Z)(x.Z,{target:"evcxx5l1",label:"StyledDropdownButton"})("padding:",(0,D.Z)(1)," ",(0,D.Z)(2),";font-weight:normal;z-index:",(function(t){return t.isOpen?t.theme.zIndex.dropdownAutocomplete.actor:"auto"}),";"),k=(0,g.Z)(Z.Z,{target:"evcxx5l2",label:"StyledDropdownBubble"})("display:",(function(t){return t.isOpen?"block":"none"}),";",(function(t){return t.minWidth&&"auto"===t.width&&"min-width: calc(".concat(t.minWidth,"px + ").concat((0,D.Z)(3),")")}),";"),R=(0,g.Z)(j.hP,{target:"evcxx5l3",label:"StyledDropdownItem"})("line-height:",(function(t){return t.theme.text.lineHeightBody}),";white-space:nowrap;");const E=P},"./app/components/charts/styles.tsx":(t,e,n)=>{"use strict";n.d(e,{OT:()=>o,uN:()=>s,m2:()=>i,xx:()=>l,Gh:()=>c,ws:()=>u,BO:()=>d});var r=n("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),a=n("./app/styles/space.tsx"),o=(0,r.Z)("h4",{target:"e1fmhx4f1",label:"SectionHeading"})("display:inline-grid;grid-auto-flow:column;grid-gap:",(0,a.Z)(1),";align-items:center;color:",(function(t){return t.theme.subText}),";font-size:",(function(t){return t.theme.fontSizeMedium}),";margin:",(0,a.Z)(1)," 0;line-height:1.3;"),s=(0,r.Z)("span",{target:"e1fmhx4f2",label:"SectionValue"})("color:",(function(t){return t.theme.subText}),";font-size:",(function(t){return t.theme.fontSizeMedium}),";margin-right:",(0,a.Z)(1),";"),i=(0,r.Z)("div",{target:"e1fmhx4f3",label:"InlineContainer"})("display:flex;align-items:center;margin-right:",(0,a.Z)(2),";> h4{margin-right:",(0,a.Z)(1),";}&:last-child{margin-right:0;}"),l=(0,r.Z)("div",{target:"e1fmhx4f4",label:"ChartControls"})("display:flex;justify-content:space-between;padding:",(0,a.Z)(1)," ",(0,a.Z)(3),";border-top:1px solid ",(function(t){return t.theme.border}),";@media (max-width:",(function(t){return t.theme.breakpoints[0]}),"){flex-direction:column;> ",i," + ",i,"{margin-top:",(0,a.Z)(1),";}}"),c=(0,r.Z)("div",{target:"e1fmhx4f5",label:"HeaderTitle"})("display:inline-grid;grid-auto-flow:column;grid-gap:",(0,a.Z)(1),";font-size:",(function(t){return t.theme.fontSizeLarge}),";color:",(function(t){return t.theme.textColor}),";align-items:center;"),u=(0,r.Z)(c,{target:"e1fmhx4f6",label:"HeaderTitleLegend"})("background-color:",(function(t){return t.theme.background}),";border-bottom-right-radius:",(function(t){return t.theme.borderRadius}),";position:absolute;z-index:1;"),d=(0,r.Z)("div",{target:"e1fmhx4f7",label:"ChartContainer"})("padding:",(0,a.Z)(2)," ",(0,a.Z)(3),";")},"./app/views/organizationStats/index.tsx":(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>se});var r=n("../../../../node_modules/react/index.js"),a=n("./app/utils/withOrganization.tsx"),o=n("../../../../node_modules/@babel/runtime/helpers/classCallCheck.js"),s=n.n(o),i=n("../../../../node_modules/@babel/runtime/helpers/createClass.js"),l=n.n(i),c=n("../../../../node_modules/@babel/runtime/helpers/inherits.js"),u=n.n(c),d=n("../../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),p=n.n(d),h=n("../../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),f=n.n(h),g=n("../../../../node_modules/lodash/capitalize.js"),m=n.n(g),v=n("../../../../node_modules/moment/moment.js"),y=n.n(v),b=n("./app/components/pageHeading.tsx"),Z=n("./app/locale.tsx"),x=n("./app/styles/organization.tsx"),j=n("./app/types/index.tsx"),C=n("../../../../node_modules/@babel/runtime/helpers/defineProperty.js"),S=n.n(C),D=n("../../../../node_modules/@babel/runtime/helpers/get.js"),w=n.n(D),P=n("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),O=n("./app/components/asyncComponent.tsx"),T=n("./app/components/card.tsx"),k=n("./app/components/charts/errorPanel.tsx"),R=n("./app/components/charts/optionSelector.tsx"),E=n("./app/components/charts/styles.tsx"),A=n("./app/components/loadingIndicator.tsx"),M=n("./app/components/panels/index.tsx"),z=n("./app/components/questionTooltip.tsx"),N=n("./app/components/textOverflow.tsx"),L=n("./app/icons/index.tsx"),_=n("./app/styles/space.tsx"),q=n("../../../../node_modules/@babel/runtime/helpers/slicedToArray.js"),B=n.n(q),F=n("../../../../node_modules/color/index.js"),U=n.n(F),I=n("../../../../node_modules/emotion-theming/dist/emotion-theming.browser.esm.js"),H=n("./app/components/charts/baseChart.tsx"),W=n("./app/components/charts/components/legend.tsx"),Y=n("./app/components/charts/components/tooltip.tsx"),V=n("./app/components/charts/components/xAxis.tsx"),G=n("./app/components/charts/series/barSeries.tsx"),J=n("./app/components/panels/panel.tsx"),K=n("./app/constants/chartPalette.tsx"),Q=n("./app/utils/formatters.tsx"),X=n("./app/utils/theme.tsx"),$=n("./app/utils.tsx"),tt=Math.pow(10,6),et=Math.pow(10,9),nt=Math.pow(10,9);function rt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isAbbreviated:!1,useUnitScaling:!1};if(e!==j.cn.ATTACHMENTS)return n.isAbbreviated?at(t):t.toLocaleString();if(n.useUnitScaling)return(0,$.E9)(t);var r=t/nt;return n.isAbbreviated?"".concat(at(r)," GB"):"".concat(r.toLocaleString(void 0,{maximumFractionDigits:2})," GB")}function at(t){return t>=et?(t/et).toLocaleString(void 0,{maximumFractionDigits:2})+"B":t>=tt?(t/tt).toLocaleString(void 0,{maximumFractionDigits:1})+"M":t>=1e3?(t/1e3).toFixed().toLocaleString()+"K":t.toFixed().toLocaleString()}function ot(t){return t===j.cn.ATTACHMENTS?function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return rt(t,j.cn.ATTACHMENTS,{useUnitScaling:!0})}:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.toLocaleString()}}var st=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");function it(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function lt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?it(Object(n),!0).forEach((function(e){S()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ct,ut=K.Z[4][3],dt=U()(ut).lighten(.25).string(),pt=K.Z[4][2],ht=U()(pt).lighten(.25).string(),ft=K.Z[4][1],gt=U()(ft).lighten(.5).string(),mt=X.ZP.gray200,vt=[{label:"Errors",value:j.cn.ERRORS,disabled:!1},{label:"Transactions",value:j.cn.TRANSACTIONS,disabled:!1},{label:"Attachments",value:j.cn.ATTACHMENTS,disabled:!1}];!function(t){t.CUMULATIVE="cumulative",t.DAILY="daily"}(ct||(ct={}));var yt,bt=[{label:(0,Z.t)("Cumulative"),value:ct.CUMULATIVE,disabled:!1},{label:(0,Z.t)("Day-to-Day"),value:ct.DAILY,disabled:!1}];!function(t){t.ACCEPTED="Accepted",t.DROPPED="Dropped",t.PROJECTED="Projected"}(yt||(yt={}));var Zt=function(t){u()(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=f()(e);if(n){var a=f()(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return p()(this,t)});function a(){var t;s()(this,a);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=r.call.apply(r,[this].concat(n))).state={xAxisDates:[]},t}return l()(a,[{key:"chartColors",get:function(){var t=this.props.dataCategory;return t===j.cn.ERRORS?[ut,dt,mt]:t===j.cn.ATTACHMENTS?[ft,gt,mt]:[pt,ht,mt]}},{key:"chartMetadata",get:function(){var t=this.props,e=t.usageStats,n=t.dataCategory,r=t.dataTransform,a=t.handleDataTransformation,o=this.state.xAxisDates,s=vt.find((function(t){return t.value===n}));if(!s)throw new Error("Selected item is not supported");var i=lt({},a(e,r));Object.keys(i).forEach((function(t){var e=t===yt.PROJECTED;i[t]=i[t].map((function(t){return lt(lt({},t),{},{tooltip:{show:!1},itemStyle:{opacity:e?.6:1}})}))}));var l=s.label,c=s.value;return c===j.cn.ERRORS||c===j.cn.TRANSACTIONS?{chartLabel:l,chartData:i,xAxisData:o,yAxisMinInterval:1e3,yAxisFormatter:Q.Du,tooltipValueFormatter:ot(n)}:{chartLabel:l,chartData:i,xAxisData:o,yAxisMinInterval:1*nt,yAxisFormatter:function(t){return rt(t,j.cn.ATTACHMENTS,{isAbbreviated:!0,useUnitScaling:!0})},tooltipValueFormatter:ot(n)}}},{key:"chartSeries",get:function(){var t=this.props.chartSeries,e=this.chartMetadata.chartData,n=[(0,G.Z)({name:yt.ACCEPTED,data:e.accepted,barMinHeight:1,stack:"usage",legendHoverLink:!1}),(0,G.Z)({name:yt.DROPPED,data:e.dropped,stack:"usage",legendHoverLink:!1}),(0,G.Z)({name:yt.PROJECTED,data:e.projected,barMinHeight:1,stack:"usage",legendHoverLink:!1})];return t&&n.concat(t),n}},{key:"chartLegend",get:function(){var t=this.chartMetadata.chartData,e=[{name:yt.ACCEPTED}];return t.dropped.length>0&&e.push({name:yt.DROPPED}),t.projected.length>0&&e.push({name:yt.PROJECTED}),e}},{key:"chartTooltip",get:function(){var t=this.props.chartTooltip;if(t)return t;var e=this.chartMetadata.tooltipValueFormatter;return(0,Y.Z)({trigger:"axis",valueFormatter:e})}},{key:"render",value:function(){var t=this.props,e=t.theme,n=t.title,r=t.footer,a=this.chartMetadata,o=a.xAxisData,s=a.yAxisMinInterval,i=a.yAxisFormatter;return(0,st.tZ)(J.Z,{id:"usage-chart"},(0,st.tZ)(E.BO,null,(0,st.tZ)(E.ws,null,n||(0,Z.t)("Current Usage Period")),(0,st.tZ)(H.Z,{colors:this.chartColors,grid:{bottom:"3px",left:"0px",right:"10px",top:"40px"},xAxis:(0,V.Z)({show:!0,type:"category",name:"Date",boundaryGap:!0,data:o,truncate:6,axisTick:{interval:6,alignWithLabel:!0},axisLabel:{interval:6},theme:e}),yAxis:{min:0,minInterval:s,axisLabel:{formatter:i,color:e.chartLabel}},series:this.chartSeries,tooltip:this.chartTooltip,onLegendSelectChanged:function(){},legend:(0,W.Z)({right:10,top:5,data:this.chartLegend,theme:e})})),r)}}],[{key:"getDerivedStateFromProps",value:function(t,e){var n=function(t,e){for(var n=[],r=y()(t),a=y()(e);!r.isAfter(a,"d");)n.push(r.format("MMM D")),r.add(1,"d");return n}(t.usageDateStart,t.usageDateEnd);return lt(lt({},e),{},{xAxisDates:n})}}]),a}(r.Component);Zt.displayName="UsageChart",Zt.defaultProps={handleDataTransformation:function(t,e){var n={accepted:[],dropped:[],projected:[]},r=e===ct.CUMULATIVE;return Object.keys(t).forEach((function(e){var a=0;n[e]=t[e].map((function(t){var e=B()(t.value,2),n=e[0],o=e[1];return a=r?a+o:o,lt(lt({},t),{},{value:[n,a]})}))})),n}};const xt=(0,I.Zz)(Zt);function jt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ct(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?jt(Object(n),!0).forEach((function(e){S()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const St=function(t){u()(o,t);var e,n,a=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=f()(e);if(n){var a=f()(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return p()(this,t)});function o(){var t;s()(this,o);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.call.apply(a,[this].concat(n))).renderChartFooter=function(){var e=t.props,n=e.dataCategory,r=e.onChangeDataCategory,a=t.state.chartDataTransform;return(0,st.tZ)(E.xx,null,(0,st.tZ)(E.m2,null,(0,st.tZ)(E.uN,null,(0,st.tZ)(L.jt,null)),(0,st.tZ)(E.uN,null)),(0,st.tZ)(E.m2,null,(0,st.tZ)(R.Z,{title:(0,Z.t)("Display"),menuWidth:"135px",selected:n,options:vt,onChange:function(t){return r(t)}}),(0,st.tZ)(R.Z,{title:(0,Z.t)("Type"),selected:a,options:bt,onChange:function(e){return t.handleSelectDataTransform(e)}})))},t}return l()(o,[{key:"getDefaultState",value:function(){return Ct(Ct({},w()(f()(o.prototype),"getDefaultState",this).call(this)),{},{chartDataTransform:ct.CUMULATIVE})}},{key:"getEndpoints",value:function(){var t=this.props.organization;return[["orgStats","/organizations/".concat(t.slug,"/stats_v2/"),{query:{interval:"1d"}}]]}},{key:"chartMetadata",get:function(){var t=this.state.orgStats;return Ct({},this.mapStatsToChart(t))}},{key:"handleSelectDataTransform",value:function(t){this.setState({chartDataTransform:t})}},{key:"mapStatsToChart",value:function(t){for(var e=this.state.dataCategory,n=0,r=0,a=0,o=0,s={accepted:[],dropped:[],projected:[]},i=1;i<=31;i++){var l="Mar ".concat(i);s.accepted.push({value:[l,2e3]}),s.dropped.push({value:[l,1e3]}),n+=5e3,r+=2e3,a+=1e3,o+=2e3}var c={isAbbreviated:e!==j.cn.ATTACHMENTS,useUnitScaling:e===j.cn.ATTACHMENTS};return{cardData:{total:rt(n,e,c),accepted:rt(r,e,c),dropped:rt(a,e,c),filtered:rt(o,e,c)},chartData:s}}},{key:"renderCards",value:function(){var t=this.props,e=t.dataCategory,n=t.dataCategoryName,r=this.chartMetadata.cardData,a=r.total,o=r.accepted,s=r.dropped,i=r.filtered,l=[{title:(0,Z._N)("Total [dataCategory]",{dataCategory:n}),value:a},{title:(0,Z.t)("Accepted"),value:o},{title:(0,Z.t)("Filtered"),description:(0,Z._N)("Filtered [dataCategory] were blocked due to your inbound data filter rules",{dataCategory:e}),value:i},{title:(0,Z.t)("Dropped"),description:(0,Z._N)("Dropped [dataCategory] were discarded due to rate-limits, quota limits, or spike protection",{dataCategory:e}),value:s}];return(0,st.tZ)(Dt,null,l.map((function(t,e){return(0,st.tZ)(wt,{key:e},(0,st.tZ)(E.Gh,null,(0,st.tZ)(N.Z,null,t.title),t.description&&(0,st.tZ)(z.Z,{size:"sm",position:"top",title:t.description})),(0,st.tZ)(Pt,null,(0,st.tZ)(N.Z,null,t.value)))})))}},{key:"renderChart",value:function(){var t=this.props,e=t.dateStart,n=t.dateEnd,r=t.dataCategory,a=this.state,o=a.chartDataTransform,s=a.error,i=a.loading,l=a.orgStats;if(i)return(0,st.tZ)(M.s_,null,(0,st.tZ)(M.N,null,(0,st.tZ)(A.Z,null)));if(s||!l)return(0,st.tZ)(M.s_,null,(0,st.tZ)(M.N,null,(0,st.tZ)(k.Z,{height:"256px"},(0,st.tZ)(L.FC,{color:"gray300",size:"lg"}))));var c=this.chartMetadata.chartData,u=e.format("YYYY-MM-DD"),d=n.format("YYYY-MM-DD");return(0,st.tZ)(xt,{footer:this.renderChartFooter(),dataCategory:r,dataTransform:o,usageDateStart:u,usageDateEnd:d,usageStats:c})}},{key:"renderComponent",value:function(){return(0,st.tZ)(r.Fragment,null,this.renderCards(),this.renderChart())}}]),o}(O.Z);var Dt=(0,P.Z)("div",{target:"e1uglcux0",label:"CardWrapper"})("display:grid;grid-auto-flow:column;grid-auto-columns:1fr;grid-auto-rows:1fr;grid-gap:",(0,_.Z)(2),";margin-bottom:",(0,_.Z)(3),";@media (max-width:",(function(t){return t.theme.breakpoints[0]}),"){grid-auto-flow:row;}"),wt=(0,P.Z)(T.Z,{target:"e1uglcux1",label:"StyledCard"})("align-items:flex-start;min-height:95px;padding:",(0,_.Z)(2)," ",(0,_.Z)(3),";color:",(function(t){return t.theme.textColor}),";"),Pt=(0,P.Z)("div",{target:"e1uglcux2",label:"CardContent"})("margin-top:",(0,_.Z)(1),";font-size:32px;");const Ot=function(t){u()(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=f()(e);if(n){var a=f()(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return p()(this,t)});function a(){return s()(this,a),r.apply(this,arguments)}return l()(a,[{key:"getEndpoints",value:function(){var t=this.props.organization;return[["orgStats","/organizations/".concat(t.slug,"/stats_v2/projects/"),{query:{interval:"1d"}}]]}},{key:"renderError",value:function(t){return(0,st.tZ)(M.s_,null,(0,st.tZ)(M.N,null,"UsageStatsProjects has an error: ",t.message))}},{key:"renderLoading",value:function(){return(0,st.tZ)(M.s_,null,(0,st.tZ)(M.N,null,(0,st.tZ)(A.Z,null)))}},{key:"renderBody",value:function(){return(0,st.tZ)(M.s_,null,(0,st.tZ)(M.N,null,"UsageStatsProjects is okay"))}}]),a}(O.Z);var Tt=function(t){u()(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=f()(e);if(n){var a=f()(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return p()(this,t)});function a(){var t;s()(this,a);for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=r.call.apply(r,[this].concat(n))).state={dataCategory:j.cn.ERRORS,dateStart:y()().subtract(14,"days"),dateEnd:y()()},t.setDataCategory=function(e){t.setState({dataCategory:e})},t.setDateRange=function(e,n){t.setState({dateStart:e,dateEnd:n})},t}return l()(a,[{key:"dataCategoryName",get:function(){return m()(this.state.dataCategory)}},{key:"render",value:function(){var t=this.props.organization,e=this.state,n=e.dataCategory,r=e.dateStart,a=e.dateEnd;return(0,st.tZ)(x.JH,null,(0,st.tZ)(x.mr,null,(0,st.tZ)(b.Z,null,(0,Z._N)("Organization Usage Stats for [dataCategory]",{dataCategory:this.dataCategoryName}))),(0,st.tZ)(St,{organization:t,dataCategory:n,dataCategoryName:this.dataCategoryName,dateStart:r,dateEnd:a,onChangeDataCategory:this.setDataCategory,onChangeDateRange:this.setDateRange}),(0,st.tZ)(Ot,{organization:t,dataCategory:n,dataCategoryName:this.dataCategoryName,dateStart:r,dateEnd:a}))}}]),a}(r.Component);Tt.displayName="OrganizationStats";const kt=Tt;var Rt=n("../../../../node_modules/@babel/runtime/helpers/extends.js"),Et=n.n(Rt),At=n("../../../../node_modules/react-document-title/index.js"),Mt=n.n(At),zt=n("./app/utils/withApi.tsx"),Nt=n("./app/components/charts/miniBarChart.tsx"),Lt=n("./app/components/loadingError.tsx"),_t=n("./app/components/pagination.tsx"),qt=n("./app/components/acl/feature.tsx"),Bt=n("./app/components/alert.tsx"),Ft=function(t){var e=t.message;return(0,st.tZ)(qt.Z,{features:["performance-view"]},(0,st.tZ)(Bt.Z,{type:"info",icon:(0,st.tZ)(L.aU,null),"data-test-id":"performance-usage"},e||(0,Z.t)("Transactions, sessions, and attachments are not yet included in the chart.")))};Ft.displayName="PerformanceAlert";const Ut=Ft;var It=n("../../../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),Ht=n.n(It),Wt=n("../../../../node_modules/react-router/es/index.js"),Yt=n("./app/components/count.tsx"),Vt=n("./app/styles/overflowEllipsis.tsx"),Gt=(0,P.Z)("div",{target:"ezq28wl0",label:"ProjectTableLayout"})({name:"1bpd1bq",styles:"display:grid;grid-template-columns:auto 110px 120px 100px 100px;width:100%;"}),Jt=(0,P.Z)("div",{target:"ezq28wl1",label:"ProjectTableDataElement"})("text-align:right;padding:0 ",(0,_.Z)(.5),";",Vt.Z,";"),Kt=function(t){var e=t.projectMap,n=t.projectTotals,a=t.orgTotal,o=t.organization,s=function(t,e){return 0===e?"":(0,Q.rl)(t/e,0)};if(!n)return null;var i=n.sort((function(t,e){return e.received-t.received})).map((function(t,n){var r=e[t.id];if(!r)return null;var i=o.features.includes("project-detail")?"/organizations/".concat(o.slug,"/projects/").concat(r.slug,"/?project=").concat(r.id):"/organizations/".concat(o.slug,"/issues/?project=").concat(r.id);return(0,st.tZ)(Xt,{key:n},(0,st.tZ)(Qt,null,(0,st.tZ)(Wt.Link,{to:i},r.slug)),(0,st.tZ)(Jt,null,(0,st.tZ)(Yt.Z,{value:t.accepted}),(0,st.tZ)($t,null,s(t.accepted,a.accepted))),(0,st.tZ)(Jt,null,(0,st.tZ)(Yt.Z,{value:t.rejected}),(0,st.tZ)($t,null,s(t.rejected,a.rejected))),(0,st.tZ)(Jt,null,(0,st.tZ)(Yt.Z,{value:t.blacklisted}),(0,st.tZ)($t,null,s(t.blacklisted,a.blacklisted))),(0,st.tZ)(Jt,null,(0,st.tZ)(Yt.Z,{value:t.received}),(0,st.tZ)($t,null,s(t.received,a.received))))}));return(0,st.tZ)(r.Fragment,null,i)};Kt.displayName="ProjectTable";var Qt=(0,P.Z)(Jt,{target:"e138erfd0",label:"StyledProjectTitle"})({name:"vpdd6b",styles:"display:flex;align-items:center;text-align:left;"}),Xt=(0,P.Z)(Gt,{target:"e138erfd1",label:"StyledProjectTableLayout"})("padding:",(0,_.Z)(2),";&:not(:last-child){border-bottom:1px solid ",(function(t){return t.theme.innerBorder}),";}"),$t=(0,P.Z)((function(t){var e=t.children,n=Ht()(t,["children"]);return""===e?null:(0,st.tZ)("div",n,e)}),{target:"e138erfd2",label:"Percentage"})("margin-top:",(0,_.Z)(.25),";color:",(function(t){return t.theme.gray300}),";font-size:12px;line-height:1.2;");const te=Kt;var ee=n("./app/views/settings/components/text/textBlock.tsx");var ne=function(t){u()(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=f()(e);if(n){var a=f()(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return p()(this,t)});function a(){return s()(this,a),r.apply(this,arguments)}return l()(a,[{key:"renderContent",value:function(){var t=this.props,e=t.statsLoading,n=t.orgTotal,r=t.statsError,a=t.orgSeries,o=t.projectsLoading,s=t.projectTotals,i=t.projectMap,l=t.projectsError,c=t.organization,u=null==a?void 0:a.map((function(t){return t.color||""}));return(0,st.tZ)("div",null,(0,st.tZ)(b.Z,{withMargins:!0},(0,Z.t)("Organization Stats")),(0,st.tZ)("div",{className:"row"},(0,st.tZ)("div",{className:"col-md-9"},(0,st.tZ)(ee.Z,null,(0,Z.t)("The chart below reflects events the system has received\n                across your entire organization. Events are broken down into\n                three categories: Accepted, Rate Limited, and Filtered. Rate\n                Limited events are entries that the system threw away due to quotas\n                being hit, and Filtered events are events that were blocked\n                due to your inbound data filter rules."))),n&&(0,st.tZ)("div",{className:"col-md-3 stats-column"},(0,st.tZ)("h6",{className:"nav-header"},(0,Z.t)("Events per minute")),(0,st.tZ)("p",{className:"count"},n.avgRate))),(0,st.tZ)("div",null,(0,st.tZ)(Ut,null),e?(0,st.tZ)(A.Z,null):r?(0,st.tZ)(Lt.Z,null):(0,st.tZ)(M.s_,null,(0,st.tZ)(M.N,{withPadding:!0},(0,st.tZ)(Nt.Z,{isGroupedByDate:!0,showTimeInTooltip:!0,labelYAxisExtents:!0,stacked:!0,height:150,colors:u,series:null!=a?a:void 0})))),(0,st.tZ)(M.s_,null,(0,st.tZ)(M.V9,null,(0,st.tZ)(Gt,null,(0,st.tZ)("div",null,(0,Z.t)("Project")),(0,st.tZ)(Jt,null,(0,Z.t)("Accepted")),(0,st.tZ)(Jt,null,(0,Z.t)("Rate Limited")),(0,st.tZ)(Jt,null,(0,Z.t)("Filtered")),(0,st.tZ)(Jt,null,(0,Z.t)("Total")))),(0,st.tZ)(M.N,null,!n||!s||e||o?(0,st.tZ)(A.Z,null):l?(0,st.tZ)(Lt.Z,null):(0,st.tZ)(te,{projectTotals:s,orgTotal:n,organization:c,projectMap:i}))),this.props.pageLinks&&(0,st.tZ)(_t.Z,this.props))}},{key:"render",value:function(){return(0,st.tZ)(x.JH,null,this.renderContent())}}]),a}(r.Component);ne.displayName="OrganizationStats";const re=ne;var ae=function(t){u()(a,t);var e,n,r=(e=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=f()(e);if(n){var a=f()(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return p()(this,t)});function a(t){var e;s()(this,a),e=r.call(this,t);var n=Math.floor((new Date).getTime()/1e3),o=n-604800;return e.state={projectsError:!1,projectsLoading:!1,projectsRequestsPending:0,statsError:!1,statsLoading:!1,statsRequestsPending:0,projectMap:{},rawProjectData:{received:{},rejected:{},blacklisted:{}},rawOrgData:{received:[],rejected:[],blacklisted:[]},orgSeries:null,orgTotal:null,projectTotals:null,querySince:o,queryUntil:n,pageLinks:null},e}return l()(a,[{key:"UNSAFE_componentWillMount",value:function(){this.fetchData()}},{key:"UNSAFE_componentWillReceiveProps",value:function(t){t.location.search!==this.props.location.search&&this.setState({projectsError:!1,projectsRequestsPending:1,projectsLoading:!0})}},{key:"componentDidUpdate",value:function(t){var e=t.params,n=this.props.params;e.orgId!==n.orgId&&this.fetchData(),t.location.search!==this.props.location.search&&(window.scrollTo&&window.scrollTo(0,0),this.fetchProjectData());var r=this.state;r.statsLoading&&!r.statsRequestsPending&&this.processOrgData(),r.projectsLoading&&!r.projectsRequestsPending&&this.processProjectData()}},{key:"fetchProjectData",value:function(){var t=this;this.props.api.request(this.getOrganizationProjectsEndpoint(),{query:this.props.location.query,success:function(e,n,r){var a={};e.forEach((function(t){a[t.id]=t})),t.setState((function(t){return{pageLinks:r?r.getResponseHeader("Link"):null,projectMap:a,projectsRequestsPending:t.projectsRequestsPending-1}}))},error:function(){t.setState({projectsError:!0})}})}},{key:"fetchData",value:function(){var t=this;this.setState({statsError:!1,statsLoading:!0,statsRequestsPending:3,projectsError:!1,projectsLoading:!0,projectsRequestsPending:4});var e=this.getOrganizationStatsEndpoint();Object.keys(this.state.rawOrgData).forEach((function(n){t.props.api.request(e,{query:{since:t.state.querySince,until:t.state.queryUntil,resolution:"1h",stat:n},success:function(e){t.setState((function(t){var r=t.rawOrgData;return r[n]=e,{rawOrgData:r,statsRequestsPending:t.statsRequestsPending-1}}))},error:function(){t.setState({statsError:!0})}})})),Object.keys(this.state.rawProjectData).forEach((function(n){t.props.api.request(e,{query:{since:t.state.querySince,until:t.state.queryUntil,stat:n,group:"project"},success:function(e){t.setState((function(t){var r=t.rawProjectData;return r[n]=e,{rawProjectData:r,projectsRequestsPending:t.projectsRequestsPending-1}}))},error:function(){t.setState({projectsError:!0})}})})),this.fetchProjectData()}},{key:"getOrganizationStatsEndpoint",value:function(){return"/organizations/"+this.props.params.orgId+"/stats/"}},{key:"getOrganizationProjectsEndpoint",value:function(){return"/organizations/"+this.props.params.orgId+"/projects/"}},{key:"processOrgData",value:function(){var t=0,e=0,n=0,r=[0,0],a=this.state.rawOrgData,o={seriesName:(0,Z.t)("Accepted"),color:X.ZP.gray200,data:[]},s={seriesName:(0,Z.t)("Rate limited"),color:X.ZP.red300,data:[]},i={seriesName:(0,Z.t)("Filtered"),color:X.ZP.orange400,data:[]};a.received.forEach((function(l,c){var u=l[1],d=a.rejected[c][1],p=a.blacklisted[c][1],h=Math.max(0,u-d-p),f=1e3*l[0];o.data.push({name:f,value:h}),s.data.push({name:f,value:d}),i.data.push({name:f,value:p}),t+=u,e+=d,n+=p,u>0&&(r[0]+=u,r[1]+=1)})),this.setState({orgSeries:[o,s,i],orgTotal:{id:"",received:t,rejected:e,blacklisted:n,accepted:Math.max(0,t-e-n),avgRate:r[1]?Math.round(r[0]/r[1]/60):0},statsLoading:!1})}},{key:"processProjectData",value:function(){var t=this.state.rawProjectData,e=[];Object.keys(t.received).forEach((function(n){var r=t.received[n],a=0,o=0,s=0;r.forEach((function(e,r){a+=e[1],o+=t.rejected[n][r][1],s+=t.blacklisted[n][r][1]})),e.push({id:n,received:a,rejected:o,blacklisted:s,accepted:Math.max(0,a-o-s)})})),this.setState({projectTotals:e,projectsLoading:!1})}},{key:"render",value:function(){var t=this.props.organization;return(0,st.tZ)(Mt(),{title:"Stats - ".concat(t.slug," - Sentry")},(0,st.tZ)(re,Et()({organization:t},this.state)))}}]),a}(r.Component);ae.displayName="OrganizationStatsContainer";const oe=(0,zt.Z)(ae),se=(0,a.Z)((function(t){return t.organization.features.includes("usage-stats-graph")||window.localStorage.getItem("ORG_STATS_REDESIGN")?(0,st.tZ)(kt,t):(0,st.tZ)(oe,t)}))}}]);
//# sourceMappingURL=OrganizationStats.js.map