(self.webpackChunk=self.webpackChunk||[]).push([["AddDashboardWidgetModal"],{"./app/actionCreators/dashboards.tsx":(e,t,n)=>{"use strict";n.d(t,{JR:()=>o,Y:()=>i,iM:()=>s,QL:()=>l});var r=n("./app/actionCreators/indicator.tsx"),a=n("./app/locale.tsx");function o(e,t,n){var o=n.title,i=n.widgets,s=e.requestPromise("/organizations/".concat(t,"/dashboards/"),{method:"POST",data:{title:o,widgets:i}});return s.catch((function(e){var t,n=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;n?(0,r.Iw)(n):(0,r.Iw)((0,a.t)("Unable to create dashboard"))})),s}function i(e,t,n){var o={title:n.title,widgets:n.widgets},i=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(n.id,"/"),{method:"PUT",data:o});return i.catch((function(e){var t,n=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;n?(0,r.Iw)(n):(0,r.Iw)((0,a.t)("Unable to update dashboard"))})),i}function s(e,t,n){var o=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(n,"/"),{method:"DELETE"});return o.catch((function(e){var t,n=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;n?(0,r.Iw)(n):(0,r.Iw)((0,a.t)("Unable to delete dashboard"))})),o}function l(e,t,n){return e.requestPromise("/organizations/".concat(t,"/dashboards/widgets/"),{method:"POST",data:n})}},"./app/components/modals/addDashboardWidgetModal.tsx":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>we,modalCss:()=>ve});var r=n("../../../../node_modules/@babel/runtime/regenerator/index.js"),a=n.n(r),o=n("../../../../node_modules/@babel/runtime/helpers/asyncToGenerator.js"),i=n.n(o),s=n("../../../../node_modules/@babel/runtime/helpers/classCallCheck.js"),l=n.n(s),d=n("../../../../node_modules/@babel/runtime/helpers/createClass.js"),u=n.n(d),c=n("../../../../node_modules/@babel/runtime/helpers/inherits.js"),p=n.n(c),f=n("../../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),h=n.n(f),y=n("../../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),b=n.n(y),m=n("../../../../node_modules/@babel/runtime/helpers/toConsumableArray.js"),g=n.n(m),v=n("../../../../node_modules/@babel/runtime/helpers/defineProperty.js"),w=n.n(v),C=n("../../../../node_modules/@babel/runtime/helpers/typeof.js"),Z=n.n(C),x=n("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),O=n("../../../../node_modules/react/index.js"),S=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js"),j=n("../../../../node_modules/lodash/cloneDeep.js"),P=n.n(j),A=n("../../../../node_modules/lodash/isEqual.js"),k=n.n(A),_=n("../../../../node_modules/lodash/pick.js"),q=n.n(_),D=n("../../../../node_modules/lodash/set.js"),T=n.n(D),z=n("./app/actionCreators/dashboards.tsx"),R=n("./app/actionCreators/indicator.tsx"),E=n("./app/components/button.tsx"),F=n("./app/components/buttonBar.tsx"),W=n("./app/components/events/searchBar.tsx"),B=n("./app/components/forms/selectControl.tsx"),Q=n("./app/icons/index.tsx"),I=n("./app/locale.tsx"),M=n("./app/styles/space.tsx"),L=n("./app/utils/discover/fields.tsx"),U=n("./app/views/settings/components/forms/controls/input.tsx"),N=n("./app/views/settings/components/forms/field/index.tsx"),V=n("./app/components/dashboards/widgetQueryFields.tsx");function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G=function(e){p()(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=b()(t);if(n){var a=b()(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return h()(this,e)});function a(){var e;l()(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=r.call.apply(r,[this].concat(n))).handleFieldChange=function(t,n){var r=e.props,a=r.queries,o=r.onChange,i=a[t];return function(e){var r=H(H({},i),{},w()({},n,e));o(t,r)}},e}return u()(a,[{key:"getFirstQueryError",value:function(e){var t=this.props.errors;if(t)return t.find((function(t){return t&&t[e]}))}},{key:"render",value:function(){var e,t,n,r=this,a=this.props,o=a.organization,i=a.selection,s=a.errors,l=a.queries,d=a.canAddSearchConditions,u=a.handleAddSearchConditions,c=a.handleDeleteQuery,p=a.displayType,f=a.fieldOptions,h=a.onChange,y=["table","world_map","big_number"].includes(p);return(0,S.tZ)(Y,null,l.map((function(e,t){return(0,S.tZ)(N.Z,{key:t,label:0===t?(0,I.t)("Query"):null,inline:!1,style:{paddingBottom:"8px"},flexibleControlStateSize:!0,stacked:!0,error:null==s?void 0:s[t].conditions},(0,S.tZ)(K,null,(0,S.tZ)($,{organization:o,projectIds:i.projects,query:e.conditions,fields:[],onSearch:r.handleFieldChange(t,"conditions"),onBlur:r.handleFieldChange(t,"conditions"),useFormWrapper:!1}),!y&&(0,S.tZ)(X,{type:"text",name:"name",required:!0,value:e.name,placeholder:(0,I.t)("Legend Alias"),onChange:function(e){return r.handleFieldChange(t,"name")(e.target.value)}}),l.length>1&&(0,S.tZ)(E.ZP,{size:"zero",borderless:!0,onClick:function(e){e.preventDefault(),c(t)},icon:(0,S.tZ)(Q.Fz,null),title:(0,I.t)("Remove query"),label:(0,I.t)("Remove query")})))})),d&&(0,S.tZ)(E.ZP,{size:"small",icon:(0,S.tZ)(Q.N_,{isCircled:!0}),onClick:function(e){e.preventDefault(),u()}},(0,I.t)("Add Query")),(0,S.tZ)(V.Z,{displayType:p,fieldOptions:f,errors:this.getFirstQueryError("fields"),fields:l[0].fields,onChange:function(e){l.forEach((function(t,n){var r=P()(t);r.fields=e,h(n,r)}))}}),"table"===p&&(0,S.tZ)(N.Z,{label:(0,I.t)("Sort by"),inline:!1,flexibleControlStateSize:!0,stacked:!0,error:null===(e=this.getFirstQueryError("orderby"))||void 0===e?void 0:e.orderby,style:{marginBottom:(0,M.Z)(1)}},(0,S.tZ)(B.Z,{value:l[0].orderby,name:"orderby",options:(t=l[0].fields,n=[],t.forEach((function(e){var t=(0,L.LY)(e);n.push({label:(0,I.t)("%s asc",e),value:t}),n.push({label:(0,I.t)("%s desc",e),value:"-".concat(t)})})),n),onChange:function(e){return r.handleFieldChange(0,"orderby")(e.value)},onSelectResetsInput:!1,onCloseResetsInput:!1,onBlurResetsInput:!1})))}}]),a}(O.Component);G.displayName="WidgetQueriesForm";var Y=(0,x.Z)("div",{target:"e15gdnm00",label:"QueryWrapper"})({name:"79elbk",styles:"position:relative;"}),K=(0,x.Z)("div",{target:"e15gdnm01",label:"SearchConditionsWrapper"})("display:flex;align-items:center;> * + *{margin-left:",(0,M.Z)(1),";}"),$=(0,x.Z)(W.Z,{target:"e15gdnm02",label:"StyledSearchBar"})({name:"i9gxme",styles:"flex-grow:1;"}),X=(0,x.Z)(U.Z,{target:"e15gdnm03",label:"LegendAliasInput"})({name:"1e2wulm",styles:"width:33%;"});const ee=G;var te=n("./app/components/panels/index.tsx"),ne=n("./app/utils/measurements/measurements.tsx"),re=n("./app/utils/withApi.tsx"),ae=n("./app/utils/withGlobalSelection.tsx"),oe=n("./app/utils/withTags.tsx"),ie=n("./app/views/dashboardsV2/data.tsx"),se=n("./app/views/dashboardsV2/types.tsx"),le=n("./app/views/dashboardsV2/widgetCard.tsx"),de=n("./app/views/eventsV2/utils.tsx");function ue(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var he={name:"",fields:["count()"],conditions:"",orderby:""};function ye(e,t){return Object.keys(e).forEach((function(n){var r=e[n];Array.isArray(r)&&"string"==typeof r[0]?t[n]=r[0]:Array.isArray(r)&&"object"===Z()(r[0])?t[n]=r.map((function(e){return ye(e,{})})):t[n]=ye(r,{})})),t}function be(e,t){var n=["line","area","stacked_area","bar"].includes(e);if(["table","world_map","big_number"].includes(e)?t=t.slice(0,1):n&&(t=t.slice(0,3)),"table"===e)return t;if(t=t.map((function(t){var r=t.fields.filter(L.h1);return(n||"world_map"===e)&&(r=r.filter((function(e){return(0,L.HW)((0,L.Px)(e))}))),n&&r.length&&r.length>3&&(r=r.slice(0,3)),fe(fe({},t),{},{fields:r.length?r:["count()"]})})),n){var r,a=g()(t[0].fields),o=ue(t);try{e:for(o.s();!(r=o.n()).done;){var i=r.value;if(a.length>=3)break;if(!k()(a,i.fields)){var s,l=ue(i.fields);try{for(l.s();!(s=l.n()).done;){var d=s.value;if(a.length>=3)break e;a.includes(d)||a.push(d)}}catch(e){l.e(e)}finally{l.f()}}}}catch(e){o.e(e)}finally{o.f()}t=t.map((function(e){return fe(fe({},e),{},{fields:a})}))}return["world_map","big_number"].includes(e)&&(t=t.map((function(e){return fe(fe({},e),{},{fields:e.fields.slice(0,1)})}))),t}var me=function(e){p()(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=b()(t);if(n){var a=b()(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return h()(this,e)});function o(e){var t;l()(this,o),(t=r.call(this,e)).handleSubmit=function(){var e=i()(a().mark((function e(n){var r,o,i,s,l,d,u,c,p,f;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),r=t.props,o=r.api,i=r.closeModal,s=r.organization,l=r.onAddWidget,d=r.onUpdateWidget,u=r.widget,t.setState({loading:!0}),e.prev=3,c=q()(t.state,["title","displayType","interval","queries"]),e.next=7,(0,z.QL)(o,s.slug,c);case 7:"function"==typeof d&&u?(d(fe({id:null==u?void 0:u.id},c)),(0,R.S9)((0,I.t)("Updated widget."))):(l(c),(0,R.S9)((0,I.t)("Added widget."))),i(),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),f=ye(null!==(p=null===e.t0||void 0===e.t0?void 0:e.t0.responseJSON)&&void 0!==p?p:{},{}),t.setState({errors:f});case 15:return e.prev=15,t.setState({loading:!1}),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[3,11,15,18]])})));return function(t){return e.apply(this,arguments)}}(),t.handleFieldChange=function(e){return function(n){t.setState((function(t){var r=P()(t);if(T()(r,e,n),"displayType"===e){var a=n;T()(r,"queries",be(a,t.queries))}return fe(fe({},r),{},{errors:void 0})}))}},t.handleQueryChange=function(e,n){t.setState((function(t){var r=P()(t);return T()(r,"queries.".concat(n),e),fe(fe({},r),{},{errors:void 0})}))},t.handleQueryRemove=function(e){t.setState((function(t){var n=P()(t);return n.queries.splice(e,e+1),fe(fe({},n),{},{errors:void 0})}))},t.handleAddSearchConditions=function(){t.setState((function(e){var t=P()(e);return t.queries.push(P()(he)),t}))};var n=e.widget;return n?(t.state={title:n.title,displayType:n.displayType,interval:n.interval,queries:be(n.displayType,n.queries),errors:void 0,loading:!1},t):(t.state={title:"",displayType:se.F.LINE,interval:"5m",queries:[fe({},he)],errors:void 0,loading:!1},h()(t))}return u()(o,[{key:"canAddSearchConditions",value:function(){var e=["line","area","stacked_area","bar"].includes(this.state.displayType),t=this.state.queries.length<3;return e&&t}},{key:"render",value:function(){var e=this,t=this.props,n=t.Footer,r=t.Body,a=t.Header,o=t.api,i=t.closeModal,s=t.organization,l=t.selection,d=t.tags,u=t.onUpdateWidget,c=t.widget,p=this.state,f=p.errors,h="function"==typeof u&&!!c;return(0,S.tZ)(O.Fragment,null,(0,S.tZ)(a,{closeButton:!0,onHide:i},(0,S.tZ)("h4",null,h?(0,I.t)("Edit Widget"):(0,I.t)("Add Widget"))),(0,S.tZ)(r,null,(0,S.tZ)(ge,null,(0,S.tZ)(N.Z,{"data-test-id":"widget-name",label:(0,I.t)("Widget Name"),inline:!1,flexibleControlStateSize:!0,stacked:!0,error:null==f?void 0:f.title,required:!0},(0,S.tZ)(U.Z,{type:"text",name:"title",maxLength:255,required:!0,value:p.title,onChange:function(t){e.handleFieldChange("title")(t.target.value)}})),(0,S.tZ)(N.Z,{"data-test-id":"chart-type",label:(0,I.t)("Visualization Display"),inline:!1,flexibleControlStateSize:!0,stacked:!0,error:null==f?void 0:f.displayType,required:!0},(0,S.tZ)(B.Z,{required:!0,options:ie.L3.slice(),name:"displayType",label:(0,I.t)("Visualization Display"),value:p.displayType,onChange:function(t){e.handleFieldChange("displayType")(t.value)}}))),(0,S.tZ)(ne.Z,null,(function(t){var n,r=t.measurements,a=(n=Object.values(r).map((function(e){return e.key})),(0,de.R0)({organization:s,tagKeys:Object.values(d).map((function(e){return e.key})),measurementKeys:n}));return(0,S.tZ)(ee,{organization:s,selection:l,fieldOptions:a,displayType:p.displayType,queries:p.queries,errors:null==f?void 0:f.queries,onChange:function(t,n){return e.handleQueryChange(n,t)},canAddSearchConditions:e.canAddSearchConditions(),handleAddSearchConditions:e.handleAddSearchConditions,handleDeleteQuery:e.handleQueryRemove})})),(0,S.tZ)(le.Z,{api:o,organization:s,selection:l,widget:this.state,isEditing:!1,onDelete:function(){},onEdit:function(){},renderErrorMessage:function(e){return"string"==typeof e&&(0,S.tZ)(te.aU,{type:"error"},e)},isSorting:!1,currentWidgetDragging:!1})),(0,S.tZ)(n,null,(0,S.tZ)(F.Z,{gap:1},(0,S.tZ)(E.ZP,{external:!0,href:"https://docs.sentry.io/product/dashboards/custom-dashboards/#widget-builder"},(0,I.t)("Read the docs")),(0,S.tZ)(E.ZP,{"data-test-id":"add-widget",priority:"primary",type:"button",onClick:this.handleSubmit,disabled:p.loading,busy:p.loading},h?(0,I.t)("Update Widget"):(0,I.t)("Add Widget")))))}}]),o}(O.Component);me.displayName="AddDashboardWidgetModal";var ge=(0,x.Z)("div",{target:"e1mshziv0",label:"DoubleFieldWrapper"})("display:inline-grid;grid-template-columns:repeat(2,1fr);grid-column-gap:",(0,M.Z)(1),";width:100%;"),ve={name:"1luw0r8-modalCss",styles:".modal-dialog{position:unset;width:100%;max-width:700px;margin:70px auto;};label:modalCss;"};const we=(0,re.Z)((0,ae.Z)((0,oe.Z)(me)))},"./app/views/dashboardsV2/data.tsx":(e,t,n)=>{"use strict";n.d(t,{R7:()=>a,L3:()=>o,GY:()=>i});var r=n("./app/locale.tsx"),a={id:"",dateCreated:"",createdBy:"",title:(0,r.t)("Untitled dashboard"),widgets:[]},o=[{label:(0,r.t)("Area Chart"),value:"area"},{label:(0,r.t)("Bar Chart"),value:"bar"},{label:(0,r.t)("Line Chart"),value:"line"},{label:(0,r.t)("Table"),value:"table"},{label:(0,r.t)("World Map"),value:"world_map"},{label:(0,r.t)("Big Number"),value:"big_number"}],i=((0,r.t)("1 Minute"),(0,r.t)("5 Minutes"),(0,r.t)("15 Minutes"),(0,r.t)("30 Minutes"),(0,r.t)("1 Hour"),(0,r.t)("1 Day"),"24h")}}]);
//# sourceMappingURL=AddDashboardWidgetModal.js.map