/*! For license information please see DataDownloadView.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([["DataDownloadView"],{"./app/components/dataExport.tsx":(e,t,n)=>{"use strict";n.d(t,{tD:()=>r,ZP:()=>P});var r,o=n("../../../../node_modules/@babel/runtime/helpers/extends.js"),a=n.n(o),s=n("../../../../node_modules/@babel/runtime/helpers/slicedToArray.js"),l=n.n(s),i=n("../../../../node_modules/@babel/runtime/helpers/classCallCheck.js"),u=n.n(i),d=n("../../../../node_modules/@babel/runtime/helpers/createClass.js"),c=n.n(d),p=n("../../../../node_modules/@babel/runtime/helpers/inherits.js"),h=n.n(p),y=n("../../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),f=n.n(y),m=n("../../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),v=n.n(m),b=n("../../../../node_modules/react/index.js"),w=n("../../../../node_modules/lodash/debounce.js"),Z=n.n(w),g=n("../../../../node_modules/lodash/isEqual.js"),x=n.n(g),k=n("./app/actionCreators/indicator.tsx"),D=n("./app/components/acl/feature.tsx"),_=n("./app/components/button.tsx"),j=n("./app/locale.tsx"),C=n("./app/utils/withApi.tsx"),E=n("./app/utils/withOrganization.tsx"),S=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");!function(e){e.IssuesByTag="Issues-by-Tag",e.Discover="Discover"}(r||(r={}));var I=function(e){h()(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=v()(t);if(n){var o=v()(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return f()(this,e)});function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=r.call.apply(r,[this].concat(n))).state=e.initialState,e.resetState=function(){e.setState(e.initialState)},e.startDataExport=function(){var t=e.props,n=t.api,r=t.organization.slug,o=t.payload,a=o.queryType,s=o.queryInfo;e.setState({inProgress:!0}),n.requestPromise("/organizations/".concat(r,"/data-export/"),{includeAllArgs:!0,method:"POST",data:{query_type:a,query_info:s}}).then((function(e){var t=l()(e,3),n=(t[0],t[1],t[2]);(0,k.S9)(201===(null==n?void 0:n.status)?(0,j.t)("Sit tight. We'll shoot you an email when your data is ready for download."):(0,j.t)("It looks like we're already working on it. Sit tight, we'll email you."))})).catch((function(t){var n,r,o=null!==(n=null==t||null===(r=t.responseJSON)||void 0===r?void 0:r.detail)&&void 0!==n?n:"We tried our hardest, but we couldn't export your data. Give it another go.";(0,k.Iw)((0,j.t)(o)),e.setState({inProgress:!1})}))},e}return c()(o,[{key:"componentDidUpdate",value:function(e){var t=e.payload,n=this.props.payload;x()(t,n)||this.resetState()}},{key:"initialState",get:function(){return{inProgress:!1}}},{key:"render",value:function(){var e=this.state.inProgress,t=this.props,n=t.children,r=t.disabled,o=t.icon;return(0,S.tZ)(D.Z,{features:["organizations:discover-query"]},e?(0,S.tZ)(_.ZP,a()({size:"small",priority:"default",title:"You can get on with your life. We'll email you when your data's ready."},this.props,{disabled:!0,icon:o}),(0,j.t)("We're working on it...")):(0,S.tZ)(_.ZP,a()({onClick:Z()(this.startDataExport,500),disabled:r||!1,size:"small",priority:"default",title:"Put your data to work. Start your export and we'll email you when it's finished.",icon:o},this.props),n||(0,j.t)("Export All to CSV")))}}]),o}(b.Component);I.displayName="DataExport";const P=(0,C.Z)((0,E.Z)(I))},"./app/views/asyncView.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var r=n("../../../../node_modules/@babel/runtime/helpers/classCallCheck.js"),o=n.n(r),a=n("../../../../node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(a),l=n("../../../../node_modules/@babel/runtime/helpers/inherits.js"),i=n.n(l),u=n("../../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),d=n.n(u),c=n("../../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),p=n.n(c),h=(n("../../../../node_modules/react/index.js"),n("../../../../node_modules/react-document-title/index.js")),y=n.n(h),f=n("./app/components/asyncComponent.tsx"),m=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");var v=function(e){i()(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=p()(t);if(n){var o=p()(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return d()(this,e)});function a(){return o()(this,a),r.apply(this,arguments)}return s()(a,[{key:"getTitle",value:function(){return""}},{key:"render",value:function(){var e=this.getTitle();return(0,m.tZ)(y(),{title:"".concat(e?"".concat(e," - "):"","Sentry")},this.renderComponent())}}]),a}(f.Z);v.displayName="AsyncView"},"./app/views/dataExport/dataDownload.tsx":(e,t,n)=>{"use strict";n.r(t),n.d(t,{DownloadStatus:()=>r,default:()=>I});var r,o=n("../../../../node_modules/@babel/runtime/helpers/classCallCheck.js"),a=n.n(o),s=n("../../../../node_modules/@babel/runtime/helpers/createClass.js"),l=n.n(s),i=n("../../../../node_modules/@babel/runtime/helpers/inherits.js"),u=n.n(i),d=n("../../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),c=n.n(d),p=n("../../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),h=n.n(p),y=n("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),f=n("../../../../node_modules/react/index.js"),m=n("../../../../node_modules/react-router/es/index.js"),v=n("./app/components/button.tsx"),b=n("./app/components/dataExport.tsx"),w=n("./app/components/dateTime.tsx"),Z=n("./app/icons/index.tsx"),g=n("./app/locale.tsx"),x=n("./app/styles/space.tsx"),k=n("./app/views/asyncView.tsx"),D=n("./app/views/auth/layout.tsx"),_=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");!function(e){e.Early="EARLY",e.Valid="VALID",e.Expired="EXPIRED"}(r||(r={}));var j=function(e){u()(s,e);var t,n,o=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=h()(t);if(n){var o=h()(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return c()(this,e)});function s(){return a()(this,s),o.apply(this,arguments)}return l()(s,[{key:"getTitle",value:function(){return(0,g.t)("Download Center")}},{key:"getEndpoints",value:function(){var e=this.props.params,t=e.orgId,n=e.dataExportId;return[["download","/organizations/".concat(t,"/data-export/").concat(n,"/")]]}},{key:"getActionLink",value:function(e){var t=this.props.params.orgId;switch(e){case b.tD.IssuesByTag:return"/organizations/".concat(t,"/issues/");case b.tD.Discover:return"/organizations/".concat(t,"/discover/queries/");default:return"/"}}},{key:"renderDate",value:function(e){if(!e)return null;var t=new Date(e);return(0,_.tZ)("strong",null,(0,_.tZ)(w.Z,{date:t}))}},{key:"renderEarly",value:function(){return(0,_.tZ)(f.Fragment,null,(0,_.tZ)(C,null,(0,_.tZ)("h3",null,(0,g.t)("What are"),(0,_.tZ)("i",null,(0,g.t)(" you ")),(0,g.t)("doing here?"))),(0,_.tZ)(E,null,(0,_.tZ)("p",null,(0,g.t)("Not that its any of our business, but were you invited to this page? It's just that we don't exactly remember emailing you about it.")),(0,_.tZ)("p",null,(0,g.t)("Close this window and we'll email you when your download is ready."))))}},{key:"renderExpired",value:function(){var e=this.state.download.query,t=this.getActionLink(e.type);return(0,_.tZ)(f.Fragment,null,(0,_.tZ)(C,null,(0,_.tZ)("h3",null,(0,g.t)("This is awkward."))),(0,_.tZ)(E,null,(0,_.tZ)("p",null,(0,g.t)("That link expired, so your download doesn't live here anymore. Just picked up one day and left town.")),(0,_.tZ)("p",null,(0,g.t)("Make a new one with your latest data. Your old download will never see it coming.")),(0,_.tZ)(S,{href:t,priority:"primary"},(0,g.t)("Start a New Download"))))}},{key:"openInDiscover",value:function(){var e=this.state.download.query.info,t=this.props.params.orgId,n={pathname:"/organizations/".concat(t,"/discover/results/"),query:e};m.browserHistory.push(n)}},{key:"renderOpenInDiscover",value:function(){var e=this,t=this.state.download.query,n=(void 0===t?{type:b.tD.IssuesByTag,info:{}}:t).type;return"Discover"===(void 0===n?b.tD.IssuesByTag:n)?(0,_.tZ)(f.Fragment,null,(0,_.tZ)("p",null,(0,g.t)("Need to make changes?")),(0,_.tZ)(v.ZP,{priority:"primary",onClick:function(){return e.openInDiscover()}},(0,g.t)("Open in Discover")),(0,_.tZ)("br",null)):null}},{key:"renderValid",value:function(){var e=this.state.download,t=e.dateExpired,n=e.checksum,r=this.props.params,o=r.orgId,a=r.dataExportId;return(0,_.tZ)(f.Fragment,null,(0,_.tZ)(C,null,(0,_.tZ)("h3",null,(0,g.t)("All done."))),(0,_.tZ)(E,null,(0,_.tZ)("p",null,(0,g.t)("See, that wasn't so bad. Your data is all ready for download.")),(0,_.tZ)(v.ZP,{priority:"primary",icon:(0,_.tZ)(Z.Dj,null),href:"/api/0/organizations/".concat(o,"/data-export/").concat(a,"/?download=true")},(0,g.t)("Download CSV")),(0,_.tZ)("p",null,(0,g.t)("That link won't last forever â€” it expires:"),(0,_.tZ)("br",null),this.renderDate(t)),this.renderOpenInDiscover(),(0,_.tZ)("p",null,(0,_.tZ)("small",null,(0,_.tZ)("strong",null,"SHA1:",n)),(0,_.tZ)("br",null),(0,g._N)("Need help verifying? [link].",{link:(0,_.tZ)("a",{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns",target:"_blank",rel:"noopener noreferrer"},(0,g.t)("Check out our docs"))}))))}},{key:"renderError",value:function(){var e,t=this.state.errors.download,n=null==t||null===(e=t.responseJSON)||void 0===e?void 0:e.detail;return(0,_.tZ)(D.Z,null,(0,_.tZ)("main",null,(0,_.tZ)(C,null,(0,_.tZ)("h3",null,t.status," - ",t.statusText)),n&&(0,_.tZ)(E,null,(0,_.tZ)("p",null,n))))}},{key:"renderContent",value:function(){switch(this.state.download.status){case r.Early:return this.renderEarly();case r.Expired:return this.renderExpired();default:return this.renderValid()}}},{key:"renderBody",value:function(){return(0,_.tZ)(D.Z,null,(0,_.tZ)("main",null,this.renderContent()))}}]),s}(k.Z),C=(0,y.Z)("header",{target:"e1os4l6w0",label:"Header"})("border-bottom:1px solid ",(function(e){return e.theme.border}),";padding:",(0,x.Z)(3)," 40px 0;h3{font-size:24px;margin:0 0 ",(0,x.Z)(3)," 0;}"),E=(0,y.Z)("div",{target:"e1os4l6w1",label:"Body"})("padding:",(0,x.Z)(2)," 40px;max-width:500px;p{margin:",(0,x.Z)(1.5)," 0;}"),S=(0,y.Z)(v.ZP,{target:"e1os4l6w2",label:"DownloadButton"})("margin-bottom:",(0,x.Z)(1.5),";");const I=j}}]);
//# sourceMappingURL=DataDownloadView.js.map