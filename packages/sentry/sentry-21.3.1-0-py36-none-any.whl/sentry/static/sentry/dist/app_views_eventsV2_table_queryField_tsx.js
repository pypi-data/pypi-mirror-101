(self.webpackChunk=self.webpackChunk||[]).push([["app_views_eventsV2_table_queryField_tsx"],{"./app/views/eventsV2/table/queryField.tsx":(e,n,t)=>{"use strict";t.d(n,{q:()=>I});var a=t("../../../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),r=t.n(a),i=t("../../../../node_modules/@babel/runtime/helpers/defineProperty.js"),l=t.n(i),u=t("../../../../node_modules/@babel/runtime/helpers/extends.js"),o=t.n(u),s=t("../../../../node_modules/@babel/runtime/helpers/classCallCheck.js"),d=t.n(s),c=t("../../../../node_modules/@babel/runtime/helpers/createClass.js"),p=t.n(c),f=t("../../../../node_modules/@babel/runtime/helpers/inherits.js"),m=t.n(f),h=t("../../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),v=t.n(h),g=t("../../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),b=t.n(g),y=t("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),k=t("../../../../node_modules/react/index.js"),O=t("../../../../node_modules/react-select/dist/chunk-80640036.browser.esm.js"),C=t("../../../../node_modules/lodash/cloneDeep.js"),w=t.n(C),j=t("./app/components/forms/selectControl.tsx"),F=t("./app/components/tag.tsx"),T=t("./app/locale.tsx"),L=t("./app/styles/space.tsx"),x=t("./app/views/settings/components/forms/controls/input.tsx"),V=t("./app/views/eventsV2/table/types.tsx"),E=t("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");function P(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function Z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?P(Object(t),!0).forEach((function(n){l()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function N(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,a=b()(e);if(n){var r=b()(this).constructor;t=Reflect.construct(a,arguments,r)}else t=a.apply(this,arguments);return v()(this,t)}}var I=function(e){m()(t,e);var n=N(t);function t(){var e;d()(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).handleFieldChange=function(n){if(n){var t=n.value,a=e.props.fieldValue,r=w()(e.props.fieldValue);switch(t.kind){case V.L.TAG:case V.L.MEASUREMENT:case V.L.FIELD:r={kind:"field",field:t.meta.name};break;case V.L.FUNCTION:"field"===a.kind?r={kind:"function",function:[t.meta.name,"",void 0]}:"function"===a.kind&&(r={kind:"function",function:[t.meta.name,a.function[1],a.function[2]]});break;default:throw new Error("Invalid field type found in column picker")}t.kind===V.L.FUNCTION&&(t.meta.parameters.forEach((function(n,t){if("function"===r.kind)if("column"===n.kind){var a=e.getFieldOrTagOrMeasurementValue(r.function[t+1]);null===a?r.function[t+1]=n.defaultValue||"":a.kind!==V.L.FIELD&&a.kind!==V.L.TAG&&a.kind!==V.L.MEASUREMENT||!_(n.columnTypes,a)?(r.function[t+1]=n.defaultValue||"",r.function[t+2]=void 0):r.function[t+1]=a.meta.name}else"value"===n.kind&&(r.function[t+1]=n.defaultValue||"")})),"function"===r.kind&&(0===t.meta.parameters.length?r.function=[r.function[0],"",void 0]:1===t.meta.parameters.length&&(r.function[2]=void 0))),e.triggerChange(r)}},e.handleFieldParameterChange=function(n){var t=n.value,a=w()(e.props.fieldValue);"function"===a.kind&&(a.function[1]=t.meta.name),e.triggerChange(a)},e.handleScalarParameterChange=function(n){var t=w()(e.props.fieldValue);"function"===t.kind&&(t.function[1]=n),e.triggerChange(t)},e.handleRefinementChange=function(n){var t=w()(e.props.fieldValue);"function"===t.kind&&(t.function[2]=n),e.triggerChange(t)},e}return p()(t,[{key:"triggerChange",value:function(e){this.props.onChange(e)}},{key:"getFieldOrTagOrMeasurementValue",value:function(e){var n=this.props.fieldOptions;if(void 0===e)return null;var t="field:".concat(e);if(n[t])return n[t].value;var a="measurement:".concat(e);if(n[a])return n[a].value;var r=0===e.indexOf("tags[")?"tag:".concat(e.replace(/tags\[(.*?)\]/,"$1")):"tag:".concat(e);return n[r]?n[r].value:e.length>0?{kind:V.L.TAG,meta:{name:e,dataType:"string",unknown:!0}}:null}},{key:"getFieldData",value:function(){var e=this,n=null,t=this.props.fieldValue,a=this.props.fieldOptions;if("function"===t.kind){var r="function:".concat(t.function[0]);void 0!==a[r]&&(n=a[r].value)}"field"===t.kind&&(n=this.getFieldOrTagOrMeasurementValue(t.field),a=this.appendFieldIfUnknown(a,n));var i=[];return n&&n.kind===V.L.FUNCTION&&n.meta.parameters.length>0&&t.kind===V.L.FUNCTION&&(i=n.meta.parameters.map((function(n,r){if("column"===n.kind){var i=e.getFieldOrTagOrMeasurementValue(t.function[1]);return a=e.appendFieldIfUnknown(a,i),{kind:"column",value:i,required:n.required,options:Object.values(a).filter((function(e){var t=e.value;return(t.kind===V.L.FIELD||t.kind===V.L.TAG||t.kind===V.L.MEASUREMENT)&&_(n.columnTypes,t)}))}}return{kind:"value",value:"function"===t.kind&&t.function[r+1]||n.defaultValue||"",dataType:n.dataType,required:n.required}}))),{field:n,fieldOptions:a,parameterDescriptions:i}}},{key:"appendFieldIfUnknown",value:function(e,n){return n?(n&&n.kind===V.L.TAG&&n.meta.unknown&&((e=Object.assign({},e))[n.meta.name]={label:n.meta.name,value:n}),e):e}},{key:"renderParameterInputs",value:function(e){var n=this,t=this.props,a=t.disabled,r=t.inFieldLabels,i=t.filterAggregateParameters,l=e.map((function(e,t){if("column"===e.kind&&e.options.length>0){var l=i?e.options.filter(i):e.options;return(0,E.tZ)(j.Z,{key:"select",name:"parameter",placeholder:(0,T.t)("Select value"),options:l,value:e.value,required:e.required,onChange:n.handleFieldParameterChange,inFieldLabel:r?(0,T.t)("Parameter: "):void 0,disabled:a})}if("value"===e.kind){var u=0===t?n.handleScalarParameterChange:n.handleRefinementChange,s={required:e.required,value:e.value,onUpdate:u,disabled:a};switch(e.dataType){case"number":return(0,E.tZ)(U,o()({name:"refinement",key:"parameter:number",type:"text",inputMode:"numeric",pattern:"[0-9]*(\\.[0-9]*)?"},s));case"integer":return(0,E.tZ)(U,o()({name:"refinement",key:"parameter:integer",type:"text",inputMode:"numeric",pattern:"[0-9]*"},s));default:return(0,E.tZ)(U,o()({name:"refinement",key:"parameter:text",type:"text"},s))}}throw new Error("Unknown parameter type encountered for ".concat(n.props.fieldValue))})),u=this.props.gridColumns,s=(null!=u?u:l.length+1)-l.length-1;if(void 0!==u&&s>0)for(var d=0;d<s;d++)l.push((0,E.tZ)(M,{key:d}));return l}},{key:"renderTag",value:function(e){var n,t;if(!1===this.props.shouldRenderTag)return null;switch(e){case V.L.FUNCTION:n="f(x)",t="success";break;case V.L.MEASUREMENT:n="measure",t="info";break;case V.L.TAG:n=e,t="warning";break;case V.L.FIELD:n=e,t="highlight";break;default:n=e}return(0,E.tZ)(F.Z,{type:t},n)}},{key:"render",value:function(){var e=this,n=this.props,t=n.className,a=n.takeFocus,i=n.filterPrimaryOptions,l=n.inFieldLabels,u=n.disabled,s=this.getFieldData(),d=s.field,c=s.fieldOptions,p=s.parameterDescriptions,f=i?Object.values(c).filter(i):Object.values(c),m={name:"field",options:Object.values(f),placeholder:(0,T.t)("(Required)"),value:d,onChange:this.handleFieldChange,inFieldLabel:l?(0,T.t)("Function: "):void 0,disabled:u};a&&null===d&&(m.autoFocus=!0);var h={singleValue:function(e){return Z(Z({},e),{display:"flex",justifyContent:"space-between",alignItems:"center",width:"calc(100% - 10px)"})},option:function(e){return Z(Z({},e),{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"})}},v=this.renderParameterInputs(p);return(0,E.tZ)(S,{className:t,gridColumns:v.length+1},(0,E.tZ)(j.Z,o()({},m,{styles:l?void 0:h,components:{Option:function(n){var t=n.label,a=n.data,i=r()(n,["label","data"]);return(0,E.tZ)(O.y.Option,o()({label:t,data:a},i),(0,E.tZ)("span",{"data-test-id":"label"},t),e.renderTag(a.value.kind))},SingleValue:function(n){var t=n.data,a=r()(n,["data"]);return(0,E.tZ)(O.y.SingleValue,o()({data:t},a),(0,E.tZ)("span",{"data-test-id":"label"},t.label),e.renderTag(t.value.kind))}}})),v)}}]),t}(k.Component);function _(e,n){return"function"==typeof e?e({name:n.meta.name,dataType:n.meta.dataType}):e.includes(n.meta.dataType)}I.displayName="QueryField";var S=(0,y.Z)("div",{target:"e12adzhr0",label:"Container"})("display:grid;grid-template-columns:repeat(",(function(e){return e.gridColumns}),",1fr);grid-column-gap:",(0,L.Z)(1),";align-items:center;flex-grow:1;"),U=function(e){m()(t,e);var n=N(t);function t(e){var a;return d()(this,t),(a=n.call(this,e)).state={value:a.props.value},a.input=void 0,a.handleBlur=function(){a.isValid?a.props.onUpdate(a.state.value):a.setState({value:a.props.value})},a.handleChange=function(e){a.isValid&&a.setState({value:e.target.value})},a.input=k.createRef(),a}return p()(t,[{key:"isValid",get:function(){return!this.input.current||this.input.current.validity.valid}},{key:"render",value:function(){var e=this.props,n=(e.onUpdate,r()(e,["onUpdate"]));return(0,E.tZ)(R,o()({},n,{ref:this.input,className:"form-control",value:this.state.value,onChange:this.handleChange,onBlur:this.handleBlur}))}}]),t}(k.Component);U.displayName="BufferedInput";var R=(0,y.Z)(x.Z,{target:"e12adzhr1",label:"StyledInput"})({name:"141chpg",styles:"height:41px;min-width:50px;"}),M=(0,y.Z)("div",{target:"e12adzhr2",label:"BlankSpace"})("height:41px;min-width:50px;background:",(function(e){return e.theme.backgroundSecondary}),";border-radius:",(function(e){return e.theme.borderRadius}),";display:flex;align-items:center;justify-content:center;&:after{font-size:",(function(e){return e.theme.fontSizeMedium}),";content:'",(0,T.t)("No parameter"),"';color:",(function(e){return e.theme.gray300}),";}")}}]);
//# sourceMappingURL=app_views_eventsV2_table_queryField_tsx.js.map