{"version":3,"sources":["webpack:///./app/components/internalStatChart.tsx","webpack:///./app/views/admin/adminQuotas.tsx","webpack:///./app/views/asyncView.tsx"],"names":["InternalStatChart","state","error","loading","data","fetchData","setState","props","api","request","method","since","resolution","key","stat","success","this","_nextProps","nextState","prevProps","label","height","onRetry","series","seriesName","map","name","value","isGroupedByDate","showTimeInTooltip","labelYAxisExtents","React","withApi","AdminQuotas","Date","getTime","config","className","backend","disabled","options","AsyncView","title","getTitle","renderComponent","AsyncComponent"],"mappings":"k6BAuBMA,E,2kBACJC,MAAe,CACbC,OAAO,EACPC,SAAS,EACTC,KAAM,M,EAqBRC,UAAY,WACV,EAAKC,SAAS,CAACH,SAAS,IACxB,EAAKI,MAAMC,IAAIC,QAAQ,mBAAoB,CACzCC,OAAQ,MACRN,KAAM,CACJO,MAAO,EAAKJ,MAAMI,MAClBC,WAAY,EAAKL,MAAMK,WACvBC,IAAK,EAAKN,MAAMO,MAElBC,QAAS,SAAAX,GAAI,OACX,EAAKE,SAAS,CACZF,OACAD,SAAS,EACTD,OAAO,KAEXA,MAAO,kBAAM,EAAKI,SAAS,CAACJ,OAAO,EAAMC,SAAS,Q,+CAjCtD,WACEa,KAAKX,c,mCAGP,SAAsBY,EAAmBC,GACvC,OAAOF,KAAKf,MAAME,UAAYe,EAAUf,U,gCAG1C,SAAmBgB,GAEfA,EAAUR,QAAUK,KAAKT,MAAMI,OAC/BQ,EAAUL,OAASE,KAAKT,MAAMO,MAC9BK,EAAUP,aAAeI,KAAKT,MAAMK,YAEpCI,KAAKX,c,oBAuBT,WAAS,QACwBW,KAAKf,MAA7BE,EADA,EACAA,QAASD,EADT,EACSA,MAAOE,EADhB,EACgBA,KADhB,EAEiBY,KAAKT,MAAtBa,EAFA,EAEAA,MAAOC,EAFP,EAEOA,OACd,GAAIlB,EACF,OAAO,QAAC,IAAD,MACF,GAAID,EACT,OAAO,QAAC,IAAD,CAAcoB,QAASN,KAAKX,YAGrC,IAAMkB,EAAS,CACbC,WAAYJ,EACZhB,KAAI,UACFA,aADE,EACFA,EAAMqB,KAAI,iCAAyB,CACjCC,KAAkB,IADV,KAERC,MAFQ,gBADR,QAIK,IAEX,OACE,QAAC,IAAD,CACEN,OAAQA,UAAU,IAClBE,OAAQ,CAACA,GACTK,iBAAe,EACfC,mBAAiB,EACjBC,mBAAiB,Q,GAnEOC,aAA1B/B,E,gCAyEN,SAAegC,OAAQhC,I,o8CC/EFiC,E,4hBACnB,WACE,2EAEEtB,OAAO,IAAIuB,MAAOC,UAAY,IAAO,OACrCvB,WAAY,S,0BAIhB,WACE,MAAO,CAAC,CAAC,SAAU,wB,wBAGrB,WAAa,IACJwB,EAAUpB,KAAKf,MAAfmC,OACP,OACE,oBACE,6BAEA,eAAKC,UAAU,QACb,eAAKA,UAAU,eACb,8BAGF,eAAKA,UAAU,6BACb,QAAC,KAAD,CAAWX,KAAK,UAAUC,MAAOS,EAAOE,QAASlB,MAAM,UAAUmB,UAAQ,KACzE,QAAC,KAAD,CACEb,KAAK,YACLC,MAAOS,EAAOI,QAAQ,qBACtBpB,MAAM,aACNmB,UAAQ,OAKd,eAAKF,UAAU,QACb,eAAKA,UAAU,eACb,oCAEF,QAAC,IAAD,CACE1B,MAAOK,KAAKf,MAAMU,MAClBC,WAAYI,KAAKf,MAAMW,WACvBE,KAAK,eACLM,MAAM,aAIV,eAAKiB,UAAU,QACb,eAAKA,UAAU,eACb,sCAEF,QAAC,IAAD,CACE1B,MAAOK,KAAKf,MAAMU,MAClBC,WAAYI,KAAKf,MAAMW,WACvBE,KAAK,iBACLM,MAAM,iB,GAvDuBqB,M,gtBCTpBA,E,qhBAInB,WACE,MAAO,K,oBAGT,WACE,IAAMC,EAAQ1B,KAAK2B,WACnB,OACE,QAAC,IAAD,CAAeD,MAAK,UAAKA,EAAQ,GAAH,OAAMA,EAAN,OAAmB,GAA7B,WACjB1B,KAAK4B,uB,GATJC,KAHWJ,E","file":"AdminQuotas.js","sourcesContent":["import React from 'react';\n\nimport {Client} from 'app/api';\nimport MiniBarChart from 'app/components/charts/miniBarChart';\nimport LoadingError from 'app/components/loadingError';\nimport LoadingIndicator from 'app/components/loadingIndicator';\nimport withApi from 'app/utils/withApi';\n\ntype Props = {\n  api: Client;\n  since: number;\n  resolution: string;\n  stat: string;\n  label: string;\n  height?: number;\n};\n\ntype State = {\n  error: boolean;\n  loading: boolean;\n  data: [number, number][] | null;\n};\n\nclass InternalStatChart extends React.Component<Props, State> {\n  state: State = {\n    error: false,\n    loading: true,\n    data: null,\n  };\n\n  componentDidMount() {\n    this.fetchData();\n  }\n\n  shouldComponentUpdate(_nextProps: Props, nextState: State) {\n    return this.state.loading !== nextState.loading;\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (\n      prevProps.since !== this.props.since ||\n      prevProps.stat !== this.props.stat ||\n      prevProps.resolution !== this.props.resolution\n    ) {\n      this.fetchData();\n    }\n  }\n\n  fetchData = () => {\n    this.setState({loading: true});\n    this.props.api.request('/internal/stats/', {\n      method: 'GET',\n      data: {\n        since: this.props.since,\n        resolution: this.props.resolution,\n        key: this.props.stat,\n      },\n      success: data =>\n        this.setState({\n          data,\n          loading: false,\n          error: false,\n        }),\n      error: () => this.setState({error: true, loading: false}),\n    });\n  };\n\n  render() {\n    const {loading, error, data} = this.state;\n    const {label, height} = this.props;\n    if (loading) {\n      return <LoadingIndicator />;\n    } else if (error) {\n      return <LoadingError onRetry={this.fetchData} />;\n    }\n\n    const series = {\n      seriesName: label,\n      data:\n        data?.map(([timestamp, value]) => ({\n          name: timestamp * 1000,\n          value,\n        })) ?? [],\n    };\n    return (\n      <MiniBarChart\n        height={height ?? 150}\n        series={[series]}\n        isGroupedByDate\n        showTimeInTooltip\n        labelYAxisExtents\n      />\n    );\n  }\n}\n\nexport default withApi(InternalStatChart);\n","import React from 'react';\n\nimport {TextField} from 'app/components/forms';\nimport InternalStatChart from 'app/components/internalStatChart';\nimport AsyncView from 'app/views/asyncView';\n\ntype Config = {\n  backend: string;\n  options: Record<string, string>;\n};\n\ntype State = AsyncView['state'] & {\n  since: number;\n  resolution: string;\n  config: Config;\n};\n\nexport default class AdminQuotas extends AsyncView<{}, State> {\n  getDefaultState() {\n    return {\n      ...super.getDefaultState(),\n      since: new Date().getTime() / 1000 - 3600 * 24 * 7,\n      resolution: '1h',\n    };\n  }\n\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    return [['config', '/internal/quotas/']];\n  }\n\n  renderBody() {\n    const {config} = this.state;\n    return (\n      <div>\n        <h3>Quotas</h3>\n\n        <div className=\"box\">\n          <div className=\"box-header\">\n            <h4>Config</h4>\n          </div>\n\n          <div className=\"box-content with-padding\">\n            <TextField name=\"backend\" value={config.backend} label=\"Backend\" disabled />\n            <TextField\n              name=\"rateLimit\"\n              value={config.options['system.rate-limit']}\n              label=\"Rate Limit\"\n              disabled\n            />\n          </div>\n        </div>\n\n        <div className=\"box\">\n          <div className=\"box-header\">\n            <h4>Total Events</h4>\n          </div>\n          <InternalStatChart\n            since={this.state.since}\n            resolution={this.state.resolution}\n            stat=\"events.total\"\n            label=\"Events\"\n          />\n        </div>\n\n        <div className=\"box\">\n          <div className=\"box-header\">\n            <h4>Dropped Events</h4>\n          </div>\n          <InternalStatChart\n            since={this.state.since}\n            resolution={this.state.resolution}\n            stat=\"events.dropped\"\n            label=\"Events\"\n          />\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport DocumentTitle from 'react-document-title';\n\nimport AsyncComponent from 'app/components/asyncComponent';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    const title = this.getTitle();\n    return (\n      <DocumentTitle title={`${title ? `${title} - ` : ''}Sentry`}>\n        {this.renderComponent()}\n      </DocumentTitle>\n    );\n  }\n}\n"],"sourceRoot":""}