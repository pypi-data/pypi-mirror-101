(self.webpackChunk=self.webpackChunk||[]).push([["app_views_settings_project_projectOwnership_ownerInput_tsx"],{"./app/components/forms/multiSelectControl.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n("../../../../node_modules/@babel/runtime/helpers/extends.js"),a=n.n(r),o=n("../../../../node_modules/react/index.js"),s=n("./app/components/forms/selectControl.tsx"),l=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");const i=o.forwardRef((function(e,t){return(0,l.tZ)(s.Z,a()({forwardedRef:t},e,{multiple:!0}))}))},"./app/views/settings/project/projectOwnership/ownerInput.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>Ue});var r=n("../../../../node_modules/@babel/runtime/helpers/classCallCheck.js"),a=n.n(r),o=n("../../../../node_modules/@babel/runtime/helpers/createClass.js"),s=n.n(o),l=n("../../../../node_modules/@babel/runtime/helpers/inherits.js"),i=n.n(l),u=n("../../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),c=n.n(u),p=n("../../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),d=n.n(p),h=n("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),m=n("../../../../node_modules/react/index.js"),f=n("../../../../node_modules/react-autosize-textarea/lib/index.js"),g=n("../../../../node_modules/emotion-theming/dist/emotion-theming.browser.esm.js"),b=n("./app/actionCreators/indicator.tsx"),v=n("./app/api.tsx"),y=n("./app/components/button.tsx"),Z=n("./app/locale.tsx"),x=n("./app/stores/memberListStore.tsx"),w=n("./app/stores/projectsStore.tsx"),C=n("./app/styles/input.tsx"),j=n("./app/utils.tsx"),k=n("./app/components/forms/selectField.tsx"),O=n("./app/components/textOverflow.tsx"),S=n("./app/icons/index.tsx"),R=n("./app/styles/space.tsx"),T=n("./app/views/settings/components/forms/controls/input.tsx"),_=n("../../../../node_modules/@babel/runtime/regenerator/index.js"),P=n.n(_),I=n("../../../../node_modules/@babel/runtime/helpers/asyncToGenerator.js"),U=n.n(I),A=n("../../../../node_modules/@babel/runtime/helpers/toConsumableArray.js"),B=n.n(A),z=n("../../../../node_modules/@babel/runtime/helpers/defineProperty.js"),N=n.n(z),M=n("../../../../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),V=n.n(M),q=n("../../../../node_modules/react-dom/index.js"),D=n("../../../../node_modules/lodash/debounce.js"),L=n.n(D),E=n("../../../../node_modules/lodash/isEqual.js"),K=n.n(E),J=n("./app/actionCreators/projects.tsx"),W=n("./app/components/avatar/actorAvatar.tsx"),F=n("./app/components/forms/multiSelectControl.tsx"),H=n("./app/components/idBadge/index.tsx"),Y=n("./app/components/tooltip.tsx"),G=n("./app/stores/teamStore.tsx"),Q=n("./app/utils/withApi.tsx"),X=n("./app/utils/withProjects.tsx"),$=n("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){N()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ne(e){var t=e.data,n=e.removeProps;return(0,$.tZ)(ce,{onClick:n.onClick},(0,$.tZ)(W.Z,{actor:t.actor,size:28}))}ne.displayName="ValueComponent";var re=function(e){return"".concat(e.email&&e.email.toLowerCase()," ").concat(e.name&&e.name.toLowerCase())},ae={name:"fs1hps-SelectOwners",styles:"width:200px;;label:SelectOwners;"},oe=function(e){i()(l,e);var t,n,r,o=(n=l,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d()(n);if(r){var a=d()(this).constructor;e=Reflect.construct(t,arguments,a)}else e=t.apply(this,arguments);return c()(this,e)});function l(){var e;a()(this,l);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))).state={loading:!1,inputValue:""},e.selectRef=m.createRef(),e.renderUserBadge=function(e){return(0,$.tZ)(H.Z,{avatarSize:24,user:e,hideEmail:!0,useLink:!1})},e.createMentionableUser=function(t){return{value:(0,j.Zh)(t.id),label:e.renderUserBadge(t),searchKey:re(t),actor:{type:"user",id:t.id,name:t.name}}},e.createUnmentionableUser=function(t){var n=t.user;return te(te({},e.createMentionableUser(n)),{},{disabled:!0,label:(0,$.tZ)(ie,null,(0,$.tZ)(Y.Z,{position:"left",title:(0,Z.t)("%s is not a member of project",n.name||n.email)},e.renderUserBadge(n)))})},e.createMentionableTeam=function(e){return{value:(0,j.dZ)(e.id),label:(0,$.tZ)(H.Z,{team:e}),searchKey:"#".concat(e.slug),actor:{type:"team",id:e.id,name:e.slug}}},e.createUnmentionableTeam=function(t){var n=e.props.organization.access.includes("project:write");return te(te({},e.createMentionableTeam(t)),{},{disabled:!0,label:(0,$.tZ)(le,null,(0,$.tZ)(ie,null,(0,$.tZ)(Y.Z,{position:"left",title:(0,Z.t)("%s is not a member of project","#".concat(t.slug))},(0,$.tZ)(H.Z,{team:t}))),(0,$.tZ)(Y.Z,{title:n?(0,Z.t)("Add %s to project","#".concat(t.slug)):(0,Z.t)("You do not have permission to add team to project.")},(0,$.tZ)(ue,{size:"zero",borderless:!0,disabled:!n,onClick:e.handleAddTeamToProject.bind(V()(e),t),icon:(0,$.tZ)(S.N_,{isCircled:!0})})))})},e.handleChange=function(t){e.props.onChange(t)},e.handleInputChange=function(t){e.setState({inputValue:t}),e.props.onInputChange&&e.props.onInputChange(t)},e.queryMembers=L()((function(t,n){var r=e.props,a=r.api,o=r.organization;return a?a.requestPromise("/organizations/".concat(o.slug,"/members/"),{query:{query:t}}).then((function(e){return n(null,e)}),(function(e){return n(e)})):null}),250),e.handleLoadOptions=function(){var t=e.getMentionableUsers(),n=e.getMentionableTeams(),r=e.getTeamsNotInProject(n),a=t.map((function(e){return e.actor.id}));return new Promise((function(t,n){e.queryMembers(e.state.inputValue,(function(e,r){e?n(e):t(r)}))})).then((function(t){return t?t.filter((function(e){var t=e.user;return t&&-1===a.indexOf(t.id)})).map(e.createUnmentionableUser):[]})).then((function(e){return[].concat(B()(t),B()(n),B()(r),B()(e))}))},e}return s()(l,[{key:"componentDidUpdate",value:function(e){K()(this.props.projects,e.projects)||this.closeSelectMenu()}},{key:"getMentionableUsers",value:function(){return x.Z.getAll().map(this.createMentionableUser)}},{key:"getMentionableTeams",value:function(){var e=this.props.project,t=w.Z.getBySlug(e.slug);return t?t.teams.map(this.createMentionableTeam):[]}},{key:"getTeamsNotInProject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=G.Z.getAll()||[],n=e.map((function(e){return e.actor.id}));return t.filter((function(e){return-1===n.indexOf(e.id)})).map(this.createUnmentionableTeam)}},{key:"closeSelectMenu",value:function(){if(this.selectRef.current){var e=q.findDOMNode(this.selectRef.current),t=null==e?void 0:e.querySelector(".Select-input input");t&&t.blur()}}},{key:"handleAddTeamToProject",value:(t=U()(P().mark((function e(t){var n,r,a,o,s,l;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,r=n.api,a=n.organization,o=n.project,s=n.value,l=B()(s),this.props.onChange([].concat(B()(this.props.value),[this.createMentionableTeam(t)])),e.prev=3,e.next=6,(0,J.Oe)(r,a.slug,o.slug,t);case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(3),this.props.onChange(l),this.closeSelectMenu();case 12:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){return(0,$.tZ)(F.Z,{name:"owners",filterOption:function(e,t){return e.data.searchKey.indexOf(t)>-1},ref:this.selectRef,loadOptions:this.handleLoadOptions,defaultOptions:!0,async:!0,clearable:!0,disabled:this.props.disabled,cache:!1,placeholder:(0,Z.t)("owners"),components:{MultiValue:ne},onInputChange:this.handleInputChange,onChange:this.handleChange,value:this.props.value,css:ae})}}]),l}(m.Component);oe.displayName="SelectOwners";const se=(0,Q.Z)((0,X.Z)(oe));var le=(0,h.Z)("div",{target:"ewupek00",label:"Container"})({name:"gg4vpm",styles:"display:flex;justify-content:space-between;"}),ie=(0,h.Z)("div",{target:"ewupek01",label:"DisabledLabel"})({name:"1bjwb34",styles:"opacity:0.5;overflow:hidden;"}),ue=(0,h.Z)(y.ZP,{target:"ewupek02",label:"AddToProjectButton"})({name:"6su6fj",styles:"flex-shrink:0;"}),ce=(0,h.Z)("a",{target:"ewupek03",label:"ValueWrapper"})("margin-right:",(0,R.Z)(.5),";");var pe={text:"",tagName:"",type:"path",owners:[],isValid:!1};function de(e){switch(e){case"path":return"src/example/*";case"url":return"https://example.com/settings/*";case"tag":return"tag-value";default:return""}}var he=function(e){i()(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=d()(t);if(n){var a=d()(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return c()(this,e)});function o(){var e;a()(this,o);for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return(e=r.call.apply(r,[this].concat(n))).state=pe,e.checkIsValid=function(){e.setState((function(e){return{isValid:!!e.text&&e.owners&&!!e.owners.length}}))},e.handleTypeChange=function(t){e.setState({type:t}),e.checkIsValid()},e.handleTagNameChangeValue=function(t){e.setState({tagName:t.target.value},e.checkIsValid)},e.handleChangeValue=function(t){e.setState({text:t.target.value}),e.checkIsValid()},e.handleChangeOwners=function(t){e.setState({owners:t}),e.checkIsValid()},e.handleAddRule=function(){var t=e.state,n=t.type,r=t.text,a=t.tagName,o=t.owners;if(t.isValid){var s=o.map((function(e){var t;return"team"===e.actor.type?"#".concat(e.actor.name):null===(t=x.Z.getById(e.actor.id))||void 0===t?void 0:t.email})).join(" "),l=r.match(/\s/)?'"'.concat(r,'"'):r,i="".concat("tag"===n?"tags.".concat(a):n,":").concat(l," ").concat(s);e.props.onAddRule(i),e.setState(pe)}else(0,b.Iw)("A rule needs a type, a value, and one or more issue owners.")},e.handleSelectCandidate=function(t,n){e.setState({text:t,type:n}),e.checkIsValid()},e}return s()(o,[{key:"render",value:function(){var e=this,t=this.props,n=t.urls,r=t.paths,a=t.disabled,o=t.project,s=t.organization,l=this.state,i=l.type,u=l.text,c=l.tagName,p=l.owners,d=l.isValid;return(0,$.tZ)(m.Fragment,null,(r||n)&&(0,$.tZ)(me,null,r&&r.map((function(t){return(0,$.tZ)(be,{key:t,onClick:function(){return e.handleSelectCandidate(t,"path")}},(0,$.tZ)(ve,{isCircled:!0}),(0,$.tZ)(ge,null,t),(0,$.tZ)(fe,null,"[PATH]"))})),n&&n.map((function(t){return(0,$.tZ)(be,{key:t,onClick:function(){return e.handleSelectCandidate(t,"url")}},(0,$.tZ)(ve,{isCircled:!0}),(0,$.tZ)(ge,null,t),(0,$.tZ)(fe,null,"[URL]"))}))),(0,$.tZ)(ye,null,(0,$.tZ)(Ze,{name:"select-type",value:i,onChange:this.handleTypeChange,options:[{value:"path",label:(0,Z.t)("Path")},{value:"tag",label:(0,Z.t)("Tag")},{value:"url",label:(0,Z.t)("URL")}],style:{width:140},clearable:!1,disabled:a}),"tag"===i&&(0,$.tZ)(we,{value:c,onChange:this.handleTagNameChangeValue,disabled:a,placeholder:"tag-name"}),(0,$.tZ)(xe,{value:u,onChange:this.handleChangeValue,disabled:a,placeholder:de(i)}),(0,$.tZ)(Ce,{direction:"right"}),(0,$.tZ)(je,null,(0,$.tZ)(se,{organization:s,project:o,value:p,onChange:this.handleChangeOwners,disabled:a})),(0,$.tZ)(ke,{priority:"primary",disabled:!d,onClick:this.handleAddRule,icon:(0,$.tZ)(S.N_,{isCircled:!0}),size:"small"})))}}]),o}(m.Component);he.displayName="RuleBuilder";var me=(0,h.Z)("div",{target:"en2gln10",label:"Candidates"})({name:"1r2f04i",styles:"margin-bottom:10px;"}),fe=(0,h.Z)("div",{target:"en2gln11",label:"TypeHint"})("color:",(function(e){return e.theme.border}),";"),ge=(0,h.Z)(O.Z,{target:"en2gln12",label:"StyledTextOverflow"})({name:"1rr4qq7",styles:"flex:1;"}),be=(0,h.Z)("div",{target:"en2gln13",label:"RuleCandidate"})("font-family:",(function(e){return e.theme.text.familyMono}),";border:1px solid ",(function(e){return e.theme.border}),";background-color:#f8fafd;padding-left:5px;margin-bottom:3px;cursor:pointer;overflow:hidden;display:flex;align-items:center;"),ve=(0,h.Z)(S.N_,{target:"en2gln14",label:"StyledIconAdd"})("color:",(function(e){return e.theme.border}),";margin-right:5px;flex-shrink:0;"),ye=(0,h.Z)("div",{target:"en2gln15",label:"BuilderBar"})("display:flex;height:40px;align-items:center;margin-bottom:",(0,R.Z)(2),";"),Ze=(0,h.Z)(k.Z,{target:"en2gln16",label:"BuilderSelect"})("margin-right:",(0,R.Z)(1.5),";width:50px;flex-shrink:0;"),xe=(0,h.Z)(T.Z,{target:"en2gln17",label:"BuilderInput"})("padding:",(0,R.Z)(1),";line-height:19px;margin-right:",(0,R.Z)(.5),";"),we=(0,h.Z)(T.Z,{target:"en2gln18",label:"BuilderTagNameInput"})("padding:",(0,R.Z)(1),";line-height:19px;margin-right:",(0,R.Z)(.5),";width:200px;"),Ce=(0,h.Z)(S.g6,{target:"en2gln19",label:"Divider"})("color:",(function(e){return e.theme.border}),";flex-shrink:0;margin-right:5px;"),je=(0,h.Z)("div",{target:"en2gln110",label:"SelectOwnersWrapper"})("display:flex;align-items:center;margin-right:",(0,R.Z)(1),";"),ke=(0,h.Z)(y.ZP,{target:"en2gln111",label:"AddButton"})("padding:",(0,R.Z)(.5),";");const Oe=he;var Se=function(e){i()(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=d()(t);if(n){var a=d()(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return c()(this,e)});function o(){var e;a()(this,o);for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return(e=r.call.apply(r,[this].concat(n))).state={hasChanges:!1,text:null,error:null},e.handleUpdateOwnership=function(){var t=e.props,n=t.organization,r=t.project,a=e.state.text;e.setState({error:null});var o=(new v.KU).requestPromise("/projects/".concat(n.slug,"/").concat(r.slug,"/ownership/"),{method:"PUT",data:{raw:a||""}});return o.then((function(){(0,b.S9)((0,Z.t)("Updated issue ownership rules")),e.setState({hasChanges:!1,text:a})})).catch((function(t){e.setState({error:t.responseJSON}),403===t.status?(0,b.Iw)((0,Z.t)("You don't have permission to modify issue ownership rules for this project")):400===t.status&&t.responseJSON.raw&&t.responseJSON.raw[0].startsWith("Invalid rule owners:")?(0,b.Iw)((0,Z.t)("Unable to save issue ownership rule changes: "+t.responseJSON.raw[0])):(0,b.Iw)((0,Z.t)("Unable to save issue ownership rule changes"))})),o},e.handleChange=function(t){e.setState({hasChanges:!0,text:t.target.value})},e.handleAddRule=function(t){var n=e.props.initialText;e.setState((function(e){return{text:(e.text||n)+"\n"+t}}),e.handleUpdateOwnership)},e}return s()(o,[{key:"parseError",value:function(e){var t,n,r,a=null==e||null===(t=e.raw)||void 0===t?void 0:t[0];return a?a.startsWith("Invalid rule owners:")?(0,$.tZ)(Ie,null,a):(0,$.tZ)(Te,{line:parseInt(null!==(n=null===(r=a.match(/line (\d*),/))||void 0===r?void 0:r[1])&&void 0!==n?n:"",10)-1}):null}},{key:"mentionableUsers",value:function(){return x.Z.getAll().map((function(e){return{id:e.id,display:e.email,email:e.email}}))}},{key:"mentionableTeams",value:function(){var e=this.props.project,t=w.Z.getBySlug(e.slug);return t?t.teams.map((function(e){return{id:e.id,display:"#".concat(e.slug),email:e.id}})):[]}},{key:"render",value:function(){var e=this,t=this.props,n=t.theme,r=t.project,a=t.organization,o=t.disabled,s=t.urls,l=t.paths,i=t.initialText,u=this.state,c=u.hasChanges,p=u.text,d=u.error;return(0,$.tZ)(m.Fragment,null,(0,$.tZ)(Oe,{urls:s,paths:l,organization:a,project:r,onAddRule:this.handleAddRule.bind(this),disabled:o}),(0,$.tZ)("div",{style:{position:"relative"},onKeyDown:function(t){t.metaKey&&"Enter"===t.key&&e.handleUpdateOwnership()}},(0,$.tZ)(Pe,{placeholder:"#example usage\npath:src/example/pipeline/* person@sentry.io #infra\nurl:http://example.com/settings/* #product\ntags.sku_class:enterprise #enterprise",onChange:this.handleChange,disabled:o,value:(0,j.ri)(p)?p:i,spellCheck:"false",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",theme:n}),(0,$.tZ)(Re,null,(0,$.tZ)("div",null,this.parseError(d)),(0,$.tZ)(_e,null,(0,$.tZ)(y.ZP,{size:"small",priority:"primary",onClick:this.handleUpdateOwnership,disabled:o||!c},(0,Z.t)("Save Changes"))))))}}]),o}(m.Component);Se.displayName="OwnerInput",Se.defaultProps={urls:[],paths:[],disabled:!1};var Re=(0,h.Z)("div",{target:"e1v4gca20",label:"ActionBar"})({name:"1lekzkb",styles:"display:flex;align-items:center;justify-content:space-between;"}),Te=(0,h.Z)("div",{target:"e1v4gca21",label:"SyntaxOverlay"})(C.T,";width:100%;height:",24,"px;background-color:red;opacity:0.1;pointer-events:none;position:absolute;top:",(function(e){return 4+24*e.line}),"px;"),_e=(0,h.Z)("div",{target:"e1v4gca22",label:"SaveButton"})({name:"1lifesv",styles:"text-align:end;padding-top:10px;"}),Pe=(0,h.Z)(f.Z,{target:"e1v4gca23",label:"StyledTextArea"})(C.T,";min-height:140px;overflow:auto;outline:0;width:100%;resize:none;margin:0;font-family:",(function(e){return e.theme.text.familyMono}),";word-break:break-all;white-space:pre-wrap;padding-top:",4,"px;line-height:",24,"px;"),Ie=(0,h.Z)("div",{target:"e1v4gca24",label:"InvalidOwners"})("color:",(function(e){return e.theme.error}),";font-weight:bold;margin-top:12px;");const Ue=(0,g.Zz)(Se)}}]);
//# sourceMappingURL=app_views_settings_project_projectOwnership_ownerInput_tsx.js.map