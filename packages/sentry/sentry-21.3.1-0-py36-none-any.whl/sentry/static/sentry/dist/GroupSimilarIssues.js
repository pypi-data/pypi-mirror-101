(self.webpackChunk=self.webpackChunk||[]).push([["GroupSimilarIssues"],{"./app/actions/groupingActions.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r("../../../../node_modules/reflux/src/index.js");const i=r.n(n)().createActions(["fetch","showAllSimilarItems","toggleUnmerge","toggleMerge","unmerge","merge","toggleCollapseFingerprint","toggleCollapseFingerprints"])},"./app/stores/groupingStore.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>S});var n=r("../../../../node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=r.n(n),s=r("../../../../node_modules/@babel/runtime/helpers/defineProperty.js"),a=r.n(s),o=r("../../../../node_modules/@babel/runtime/helpers/slicedToArray.js"),l=r.n(o),c=r("../../../../node_modules/lodash/pick.js"),u=r.n(c),p=r("../../../../node_modules/reflux/src/index.js"),m=r.n(p),g=r("./app/actionCreators/group.tsx"),d=r("./app/actionCreators/indicator.tsx"),h=r("./app/actions/groupingActions.tsx"),f=r("./app/api.tsx");function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var b={listenables:[h.Z],api:new f.KU,init:function(){var e=this,t=this.getInitialState();Object.entries(t).forEach((function(t){var r=l()(t,2),n=r[0],i=r[1];e[n]=i}))},getInitialState:function(){return{mergedItems:[],unmergeList:new Map,unmergeState:new Map,unmergeDisabled:!0,unmergeLastCollapsed:!1,enableFingerprintCompare:!1,similarItems:[],filteredSimilarItems:[],similarLinks:"",mergeState:new Map,mergeList:[],mergedLinks:"",mergeDisabled:!1,loading:!0,error:!1}},setStateForId:function(e,t,r){return(Array.isArray(t)?t:[t]).map((function(t){var n=v(v({},e.has(t)&&e.get(t)||{}),r);return e.set(t,n),n}))},isAllUnmergedSelected:function(){var e=Array.from(this.unmergeState.values()).filter((function(e){return e.busy}))||[];return this.unmergeList.size===this.mergedItems.filter((function(e){return!!e.latestEvent})).length-e.length},onFetch:function(e){var t=this,r=e||this.toFetchArray;this.init(),this.triggerFetchState();var n=r.map((function(e){var r=e.endpoint,n=e.queryParams,i=e.dataKey;return new Promise((function(e,s){t.api.request(r,{method:"GET",data:n,success:function(t,r,n){e({dataKey:i,data:t,links:n?n.getResponseHeader("Link"):null})},error:function(e){var t,r=(null===(t=e.responseJSON)||void 0===t?void 0:t.detail)||!0;s(r)}})}))})),i={merged:function(e){return t.setStateForId(t.unmergeState,e.id,{busy:"locked"===e.state}),e},similar:function(e){var t=l()(e,2),r=t[0],n=t[1],i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!Object.keys(e).map((function(t){return e[t]})).find((function(e){return e>=.6}))}(n),s=Object.keys(n).map((function(e){return[e,n[e]]})).reduce((function(e,t){var r=l()(t,2),n=r[0],i=r[1],s=String(n).split(":"),a=l()(s,1)[0];return e[a]||(e[a]=[]),e[a].push([n,i]),e}),{}),a=Object.keys(s).map((function(e){return[e,s[e]]})).reduce((function(e,t){var r=l()(t,2),n=r[0],i=r[1].filter((function(e){return null!==l()(e,2)[1]})),s=i.reduce((function(e,t){return e+l()(t,2)[1]}),0)/i.length;return e[n]=s,e}),{});return{issue:r,score:n,scoresByInterface:s,aggregate:a,isBelowThreshold:i}}};return e&&(this.toFetchArray=e),Promise.all(n).then((function(e){e.forEach((function(e){var r=e.dataKey,n=e.data,s=e.links,a=n.map(i[r]);t["".concat(r,"Items")]=a,t["".concat(r,"Links")]=s})),t.loading=!1,t.error=!1,t.triggerFetchState()}),(function(){t.loading=!1,t.error=!0,t.triggerFetchState()}))},onToggleMerge:function(e){var t=!1,r=this.mergeState.has(e)?this.mergeState.get(e):void 0;!0!==(null==r?void 0:r.busy)&&(this.mergeList.includes(e)?this.mergeList=this.mergeList.filter((function(t){return t!==e})):(this.mergeList=[].concat(i()(this.mergeList),[e]),t=!0),this.setStateForId(this.mergeState,e,{checked:t}),this.triggerMergeState())},onToggleUnmerge:function(e){var t=l()(e,2),r=t[0],n=t[1],i=!1,s=this.unmergeState.get(r);!0!==(null==s?void 0:s.busy)&&(this.unmergeList.has(r)?this.unmergeList.delete(r):(this.unmergeList.set(r,n),i=!0),this.setStateForId(this.unmergeState,r,{checked:i}),this.unmergeDisabled=0===this.unmergeList.size||this.isAllUnmergedSelected(),this.enableFingerprintCompare=2===this.unmergeList.size,this.triggerUnmergeState())},onUnmerge:function(e){var t=this,r=e.groupId,n=e.loadingMessage,i=e.successMessage,s=e.errorMessage,a=Array.from(this.unmergeList.keys());return new Promise((function(e,o){t.isAllUnmergedSelected()?o(new Error("Not allowed to unmerge ALL events")):(t.unmergeDisabled=!0,t.setStateForId(t.unmergeState,a,{checked:!1,busy:!0}),t.triggerUnmergeState(),(0,d.E3)(n),t.api.request("/issues/".concat(r,"/hashes/"),{method:"DELETE",query:{id:a},success:function(){(0,d.S9)(i),t.setStateForId(t.unmergeState,a,{checked:!1,busy:!0}),t.unmergeList.clear()},error:function(){(0,d.Iw)(s),t.setStateForId(t.unmergeState,a,{checked:!0,busy:!1})},complete:function(){t.unmergeDisabled=!1,e(t.triggerUnmergeState())}}))}))},onMerge:function(e){var t=this,r=e.params,n=e.query,s=e.projectId;if(r){var a=this.mergeList;return this.mergeDisabled=!0,this.setStateForId(this.mergeState,a,{busy:!0}),this.triggerMergeState(),new Promise((function(e){var o=r.orgId,l=r.groupId;(0,g.fr)(t.api,{orgId:o,projectId:s||r.projectId,itemIds:[].concat(i()(a),[l]),query:n},{success:function(e){var r;null!=e&&null!==(r=e.merge)&&void 0!==r&&r.parent&&t.trigger({mergedParent:e.merge.parent}),t.setStateForId(t.mergeState,a,{checked:!1,busy:!0}),t.mergeList=[]},error:function(){t.setStateForId(t.mergeState,a,{checked:!0,busy:!1})},complete:function(){t.mergeDisabled=!1,e(t.triggerMergeState())}})}))}},onToggleCollapseFingerprints:function(){this.setStateForId(this.unmergeState,this.mergedItems.map((function(e){return e.id})),{collapsed:!this.unmergeLastCollapsed}),this.unmergeLastCollapsed=!this.unmergeLastCollapsed,this.trigger({unmergeLastCollapsed:this.unmergeLastCollapsed,unmergeState:this.unmergeState})},onToggleCollapseFingerprint:function(e){var t=this.unmergeState.has(e)&&this.unmergeState.get(e).collapsed;this.setStateForId(this.unmergeState,e,{collapsed:!t}),this.trigger({unmergeState:this.unmergeState})},triggerFetchState:function(){var e=v({similarItems:this.similarItems.filter((function(e){return!e.isBelowThreshold})),filteredSimilarItems:this.similarItems.filter((function(e){return e.isBelowThreshold}))},u()(this,["mergedItems","mergedLinks","similarLinks","mergeState","unmergeState","loading","error"]));return this.trigger(e),e},triggerUnmergeState:function(){var e=u()(this,["unmergeDisabled","unmergeState","unmergeList","enableFingerprintCompare","unmergeLastCollapsed"]);return this.trigger(e),e},triggerMergeState:function(){var e=u()(this,["mergeDisabled","mergeState","mergeList"]);return this.trigger(e),e}};const S=m().createStore(b)},"./app/views/organizationGroupDetails/groupSimilarIssues/index.tsx":(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Re});var n=r("../../../../node_modules/@babel/runtime/helpers/extends.js"),i=r.n(n),s=r("../../../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=r.n(s),o=r("../../../../node_modules/react/index.js"),l=r("./app/components/acl/feature.tsx"),c=r("../../../../node_modules/@babel/runtime/helpers/defineProperty.js"),u=r.n(c),p=r("../../../../node_modules/@babel/runtime/helpers/slicedToArray.js"),m=r.n(p),g=r("../../../../node_modules/@babel/runtime/helpers/classCallCheck.js"),d=r.n(g),h=r("../../../../node_modules/@babel/runtime/helpers/createClass.js"),f=r.n(h),y=r("../../../../node_modules/@babel/runtime/helpers/inherits.js"),v=r.n(y),b=r("../../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),S=r.n(b),Z=r("../../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),x=r.n(Z),I=r("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),k=r("../../../../node_modules/react-router/es/index.js"),j=r("../../../../node_modules/query-string/index.js"),w=r("./app/actions/groupingActions.tsx"),O=r("./app/components/alert.tsx"),C=r("./app/components/button.tsx"),L=r("./app/components/buttonBar.tsx"),P=r("./app/components/loadingError.tsx"),F=r("./app/components/loadingIndicator.tsx"),D=r("./app/locale.tsx"),A=r("./app/stores/groupingStore.tsx"),M=r("./app/styles/space.tsx"),E=r("./app/utils/callIfFunction.tsx"),R=r("./app/components/emptyStateWarning.tsx"),_=r("./app/components/pagination.tsx"),T=r("./app/components/panels/index.tsx"),N=r("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");function q(e){var t=e.className;return(0,N.tZ)("div",{className:t},(0,N.tZ)("span",null,(0,D.t)("Similar")),(0,N.tZ)(U,{colorIndex:4}),(0,N.tZ)(U,{colorIndex:3}),(0,N.tZ)(U,{colorIndex:2}),(0,N.tZ)(U,{colorIndex:1}),(0,N.tZ)(U,{colorIndex:0}),(0,N.tZ)("span",null,(0,D.t)("Not Similar")))}q.displayName="SimilarSpectrum";var B=(0,I.Z)(q,{target:"enx6bph0",label:"StyledSimilarSpectrum"})("display:flex;font-size:",(function(e){return e.theme.fontSizeSmall}),";"),U=(0,I.Z)("span",{target:"enx6bph1",label:"SpectrumItem"})("border-radius:2px;margin:5px;width:14px;",(function(e){return"background-color: ".concat(e.theme.similarity.colors[e.colorIndex],";")}),";");const z=B;var G=r("../../../../node_modules/classnames/index.js"),W=r.n(G),H=r("./app/actionCreators/modal.tsx"),V=r("./app/components/checkbox.tsx"),K=r("./app/components/count.tsx"),J=r("./app/components/eventOrGroupExtraDetails.tsx"),Q=r("./app/components/eventOrGroupHeader.tsx"),X=r("./app/components/hovercard.tsx"),Y=r("./app/components/scoreBar.tsx"),$={"exception:message:character-shingles":(0,D.t)("Exception Message"),"exception:stacktrace:pairs":(0,D.t)("Stack Trace Frames"),"exception:stacktrace:application-chunks":(0,D.t)("In-App Frames"),"message:message:character-shingles":(0,D.t)("Log Message"),"similarity:*:type:character-5-shingle":(0,D.t)("Exception Type"),"similarity:*:value:character-5-shingle":(0,D.t)("Exception Message"),"similarity:*:stacktrace:frames-pairs":(0,D.t)("Stack Trace Frames"),"similarity:*:message:character-5-shingle":(0,D.t)("Log Message")},ee=function(e){var t=e.scoreList,r=void 0===t?[]:t;if(0===r.length)return null;var n=0,i=0;return(0,N.tZ)(o.Fragment,null,r.map((function(e){var t=m()(e,2),r=t[0],s=t[1],a=$[r.replace(/similarity:\d\d\d\d-\d\d-\d\d/,"similarity:*")];return a?(0,N.tZ)(te,{key:r},(0,N.tZ)("div",null,a),(0,N.tZ)(re,{score:null===s?s:Math.round(4*s)})):(null!==s&&(n+=s,i+=1),null)})),i>0&&n>0&&(0,N.tZ)(te,null,(0,N.tZ)("div",null,(0,D.t)("Other")),(0,N.tZ)(re,{score:Math.round(4*n/i)})))};ee.displayName="SimilarScoreCard";var te=(0,I.Z)("div",{target:"e1vycly80",label:"Wrapper"})("display:flex;justify-content:space-between;margin:",(0,M.Z)(.25)," 0;"),re=(0,I.Z)("div",{target:"e1vycly81",label:"Score"})("height:16px;width:48px;border-radius:2px;background-color:",(function(e){return null===e.score?e.theme.similarity.empty:e.theme.similarity.colors[e.score]}),";");const ne=ee;var ie=r("./app/styles/overflowEllipsis.tsx");function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach((function(t){u()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var oe={visible:!0,checked:!1,busy:!1},le=function(e){v()(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=x()(t);if(r){var i=x()(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return S()(this,e)});function i(){var e;d()(this,i);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=n.call.apply(n,[this].concat(r))).state=oe,e.listener=A.Z.listen((function(t){return e.onGroupChange(t)}),void 0),e.handleToggle=function(){var t=e.props.issue;e.state.busy||w.Z.toggleMerge(t.id)},e.handleShowDiff=function(t){var r=e.props,n=r.orgId,i=r.groupId,s=r.issue,a=r.project,o=s.id;(0,H.openDiffModal)({baseIssueId:i,targetIssueId:o,project:a,orgId:n}),t.stopPropagation()},e.handleCheckClick=function(){},e.onGroupChange=function(t){var r=t.mergeState;if(r){var n=e.props.issue,i=r.has(n.id)&&r.get(n.id);i&&Object.keys(i).forEach((function(t){i[t]!==e.state[t]&&e.setState((function(e){return ae(ae({},e),{},u()({},t,i[t]))}))}))}},e}return f()(i,[{key:"componentWillUnmount",value:function(){(0,E.g)(this.listener)}},{key:"render",value:function(){var e=this.props,t=e.aggregate,r=e.scoresByInterface,n=e.issue,i=e.v2,s=this.state,a=s.visible,o=s.busy,l=i?["similarity"]:["exception","message"];if(!a)return null;var c=W()("group",{isResolved:"resolved"===n.status,busy:o});return(0,N.tZ)(ue,{"data-test-id":"similar-item-row",className:c,onClick:this.handleToggle},(0,N.tZ)(ce,null,(0,N.tZ)(V.Z,{id:n.id,value:n.id,checked:this.state.checked,onChange:this.handleCheckClick}),(0,N.tZ)(fe,null,(0,N.tZ)(Q.Z,{data:n,includeLink:!0,size:"normal"}),(0,N.tZ)(J.Z,{data:ae(ae({},n),{},{lastSeen:""}),showAssignee:!0})),(0,N.tZ)(he,null,(0,N.tZ)(C.ZP,{onClick:this.handleShowDiff,size:"small"},(0,D.t)("Diff")))),(0,N.tZ)(pe,null,(0,N.tZ)(de,{value:n.count}),l.map((function(e){var n=null==t?void 0:t[e],i=(null==r?void 0:r[e])||[],s="number"!=typeof n||Number.isNaN(n)?0:n;return(0,N.tZ)(ge,{key:e},(0,N.tZ)(X.ZP,{body:i.length&&(0,N.tZ)(ne,{scoreList:i})},(0,N.tZ)(Y.Z,{vertical:!0,score:Math.round(5*s)})))}))))}}]),i}(o.Component);le.displayName="Item";var ce=(0,I.Z)("div",{target:"egki5oq0",label:"Details"})(ie.Z,";display:grid;gap:",(0,M.Z)(1),";grid-template-columns:max-content auto max-content;margin-left:",(0,M.Z)(2),";input[type='checkbox']{margin:0;}"),ue=(0,I.Z)(T.Lv,{target:"egki5oq1",label:"StyledPanelItem"})("padding:",(0,M.Z)(1)," 0;"),pe=(0,I.Z)("div",{target:"egki5oq2",label:"Columns"})({name:"wsif3o",styles:"display:flex;align-items:center;flex-shrink:0;min-width:300px;width:300px;"}),me=(0,N.iv)("flex:1;flex-shrink:0;display:flex;justify-content:center;padding:",(0,M.Z)(.5)," 0;;label:columnStyle;"),ge=(0,I.Z)("div",{target:"egki5oq3",label:"Column"})(me),de=(0,I.Z)(K.Z,{target:"egki5oq4",label:"StyledCount"})(me),he=(0,I.Z)("div",{target:"egki5oq5",label:"Diff"})("display:flex;align-items:center;margin-right:",(0,M.Z)(.25),";"),fe=(0,I.Z)("div",{target:"egki5oq6",label:"EventDetails"})("flex:1;",ie.Z,";");const ye=le;var ve=r("./app/components/confirm.tsx"),be=r("./app/components/toolbarHeader.tsx");var Se={mergeCount:0},Ze=function(e){v()(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=x()(t);if(r){var i=x()(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return S()(this,e)});function i(){var e;d()(this,i);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=n.call.apply(n,[this].concat(r))).state=Se,e.onGroupChange=function(t){var r=t.mergeList;null!=r&&r.length&&r.length!==e.state.mergeCount&&e.setState({mergeCount:r.length})},e.listener=A.Z.listen(e.onGroupChange,void 0),e}return f()(i,[{key:"componentWillUnmount",value:function(){(0,E.g)(this.listener)}},{key:"render",value:function(){var e=this.props,t=e.onMerge,r=e.v2,n=this.state.mergeCount;return(0,N.tZ)(T.V9,{hasButtons:!0},(0,N.tZ)(ve.Z,{"data-test-id":"merge",disabled:0===n,message:(0,D.t)("Are you sure you want to merge these issues?"),onConfirm:t},(0,N.tZ)(C.ZP,{size:"small",title:(0,D.t)("Merging %s issues",n)},(0,D.t)("Merge %s","(".concat(n||0,")")))),(0,N.tZ)(Ie,null,(0,N.tZ)(ke,null,(0,D.t)("Events")),r?(0,N.tZ)(ke,null,(0,D.t)("Score")):(0,N.tZ)(o.Fragment,null,(0,N.tZ)(ke,null,(0,D.t)("Exception")),(0,N.tZ)(ke,null,(0,D.t)("Message")))))}}]),i}(o.Component);Ze.displayName="SimilarToolbar";const xe=Ze;var Ie=(0,I.Z)("div",{target:"e1axhvm50",label:"Columns"})({name:"wsif3o",styles:"display:flex;align-items:center;flex-shrink:0;min-width:300px;width:300px;"}),ke=(0,I.Z)(be.Z,{target:"e1axhvm51",label:"StyledToolbarHeader"})("flex:1;flex-shrink:0;display:flex;justify-content:center;padding:",(0,M.Z)(.5)," 0;");var je=function(e){v()(s,e);var t,r,n=(t=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=x()(t);if(r){var i=x()(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return S()(this,e)});function s(){var e;d()(this,s);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).state={showAllItems:!1},e.renderEmpty=function(){return(0,N.tZ)(T.s_,null,(0,N.tZ)(T.N,null,(0,N.tZ)(R.Z,{small:!0,withIcon:!1},(0,D.t)("No issues with a similar stack trace have been found."))))},e.handleShowAll=function(){e.setState({showAllItems:!0})},e}return f()(s,[{key:"render",value:function(){var e=this.props,t=e.orgId,r=e.groupId,n=e.project,s=e.items,a=e.filteredItems,l=e.pageLinks,c=e.onMerge,u=e.v2,p=this.state.showAllItems,m=!!a.length,g=s.length>0||m,d=s.concat(p&&a||[]);return g?(0,N.tZ)(o.Fragment,null,(0,N.tZ)(Oe,null,(0,N.tZ)(z,null)),(0,N.tZ)(T.s_,null,(0,N.tZ)(xe,{v2:u,onMerge:c}),(0,N.tZ)(T.N,null,d.map((function(e){return(0,N.tZ)(ye,i()({key:e.issue.id,orgId:t,v2:u,groupId:r,project:n},e))})),m&&!p&&(0,N.tZ)(Ce,null,(0,N.tZ)(C.ZP,{onClick:this.handleShowAll},(0,D.t)("Show %s issues below threshold",a.length))))),(0,N.tZ)(_.Z,{pageLinks:l})):this.renderEmpty()}}]),s}(o.Component);je.displayName="List",je.defaultProps={filteredItems:[]};const we=je;var Oe=(0,I.Z)("div",{target:"e191i7fr0",label:"Header"})("display:flex;justify-content:flex-end;margin-bottom:",(0,M.Z)(1),";"),Ce=(0,I.Z)("div",{target:"e191i7fr1",label:"Footer"})("display:flex;justify-content:center;padding:",(0,M.Z)(1.5),";");function Le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(r),!0).forEach((function(t){u()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Fe=function(e){v()(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=x()(t);if(r){var i=x()(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return S()(this,e)});function i(){var e;d()(this,i);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=n.call.apply(n,[this].concat(r))).state={similarItems:[],filteredSimilarItems:[],similarLinks:null,loading:!0,error:!1,v2:!1},e.onGroupingChange=function(t){var r=t.mergedParent,n=t.similarItems,i=t.similarLinks,s=t.filteredSimilarItems,a=t.loading,o=t.error;if(n)e.setState({similarItems:n,similarLinks:i,filteredSimilarItems:s,loading:null!=a&&a,error:null!=o&&o});else if(r)if(r===e.props.params.groupId);else{var l=e.props.params;k.browserHistory.push("/organizations/".concat(l.orgId,"/issues/").concat(r,"/similar/"))}},e.listener=A.Z.listen(e.onGroupingChange,void 0),e.handleMerge=function(){var t=e.props,r=t.params,n=t.location.query;if(r){var i=e.state.similarItems.length?e.state.similarItems:e.state.filteredSimilarItems,s=m()(i,1)[0];w.Z.merge({params:r,query:n,projectId:s.issue.project.slug})}},e.toggleSimilarityVersion=function(){e.setState((function(e){return{v2:!e.v2}}),e.fetchData)},e}return f()(i,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentWillReceiveProps",value:function(e){e.params.groupId===this.props.params.groupId&&e.location.search===this.props.location.search||this.fetchData()}},{key:"componentWillUnmount",value:function(){(0,E.g)(this.listener)}},{key:"fetchData",value:function(){var e=this.props,t=e.params,r=e.location;this.setState({loading:!0,error:!1});var n=[];if(this.hasSimilarityFeature()){var i=this.state.v2?"2":"1";n.push({endpoint:"/issues/".concat(t.groupId,"/similar/?").concat(j.Pz(Pe(Pe({},r.query),{},{limit:50,version:i}))),dataKey:"similar"})}w.Z.fetch(n)}},{key:"hasSimilarityV2Feature",value:function(){return this.props.project.features.includes("similarity-view-v2")}},{key:"hasSimilarityFeature",value:function(){return this.props.project.features.includes("similarity-view")}},{key:"render",value:function(){var e=this.props,t=e.params,r=e.project,n=t.orgId,i=t.groupId,s=this.state,a=s.similarItems,l=s.filteredSimilarItems,c=s.loading,u=s.error,p=s.v2,m=s.similarLinks,g=this.hasSimilarityV2Feature(),d=c,h=u&&!d,f=!h&&!d,y=this.hasSimilarityFeature()&&(a.length>=0||l.length>=0)&&f;return(0,N.tZ)(o.Fragment,null,(0,N.tZ)(O.Z,{type:"warning"},(0,D.t)("This is an experimental feature. Data may not be immediately available while we process merges.")),(0,N.tZ)(Me,null,(0,N.tZ)(Ae,null,(0,D.t)("Issues with a similar stack trace")),g&&(0,N.tZ)(L.Z,{merged:!0,active:p?"new":"old"},(0,N.tZ)(C.ZP,{barId:"old",size:"small",onClick:this.toggleSimilarityVersion},(0,D.t)("Old Algorithm")),(0,N.tZ)(C.ZP,{barId:"new",size:"small",onClick:this.toggleSimilarityVersion},(0,D.t)("New Algorithm")))),d&&(0,N.tZ)(F.Z,null),h&&(0,N.tZ)(P.Z,{message:(0,D.t)("Unable to load similar issues, please try again later"),onRetry:this.fetchData}),y&&(0,N.tZ)(we,{items:a,filteredItems:l,onMerge:this.handleMerge,orgId:n,project:r,groupId:i,pageLinks:m,v2:p}))}}]),i}(o.Component);Fe.displayName="SimilarStackTrace";const De=Fe;var Ae=(0,I.Z)("h4",{target:"e1xsq7ua0",label:"Title"})({name:"gx0lhm",styles:"margin-bottom:0;"}),Me=(0,I.Z)("div",{target:"e1xsq7ua1",label:"HeaderWrapper"})("display:flex;align-items:center;justify-content:space-between;margin-bottom:",(0,M.Z)(2),";"),Ee=function(e){var t=e.project,r=a()(e,["project"]);return(0,N.tZ)(l.Z,{features:["similarity-view"],project:t},(0,N.tZ)(De,i()({project:t},r)))};Ee.displayName="GroupSimilarIssues";const Re=Ee}}]);
//# sourceMappingURL=GroupSimilarIssues.js.map