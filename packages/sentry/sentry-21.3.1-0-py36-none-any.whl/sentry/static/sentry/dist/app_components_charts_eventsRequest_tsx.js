(self.webpackChunk=self.webpackChunk||[]).push([["app_components_charts_eventsRequest_tsx"],{"./app/actionCreators/events.tsx":(e,t,r)=>{"use strict";r.d(t,{lI:()=>g,eV:()=>y,JE:()=>P});var n=r("../../../../node_modules/@babel/runtime/regenerator/index.js"),o=r.n(n),a=r("../../../../node_modules/@babel/runtime/helpers/asyncToGenerator.js"),s=r.n(a),i=r("../../../../node_modules/@babel/runtime/helpers/defineProperty.js"),u=r.n(i),l=r("../../../../node_modules/@babel/runtime/helpers/slicedToArray.js"),c=r.n(l),d=r("../../../../node_modules/lodash/pick.js"),p=r.n(d),m=r("./app/components/charts/utils.tsx"),f=r("./app/constants/globalSelectionHeader.tsx"),h=r("./app/utils/getPeriod.tsx");function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){u()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=function(e,t){var r=t.organization,n=t.project,o=t.environment,a=t.period,s=t.start,i=t.end,u=t.interval,l=t.includePrevious,d=t.query,p=t.yAxis,f=t.field,v=t.topEvents,g=t.orderby,y=t.partial,j=(0,m.Sw)(l,a),P=Object.fromEntries(Object.entries({interval:u,project:n,environment:o,query:d,yAxis:p,field:f,topEvents:v,orderby:g,partial:y?"1":void 0}).filter((function(e){return void 0!==c()(e,2)[1]}))),D=(0,h.X)({period:a,start:s,end:i},{shouldDoublePeriod:j});return e.requestPromise("/organizations/".concat(r.slug,"/events-stats/"),{query:b(b({},P),D)})};function y(e,t,r){return j.apply(this,arguments)}function j(){return(j=s()(o().mark((function e(t,r,n){var a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p()(n,Object.values(f.nF)),s=b(b({},a),{},{query:n.query}),e.abrupt("return",t.requestPromise("/organizations/".concat(r,"/events-facets/"),{query:s}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t,r){return D.apply(this,arguments)}function D(){return(D=s()(o().mark((function e(t,r,n){var a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p()(n,Object.values(f.nF)),s=b(b({},a),{},{query:n.query}),e.abrupt("return",t.requestPromise("/organizations/".concat(r,"/events-meta/"),{query:s}).then((function(e){return e.count})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},"./app/components/charts/eventsRequest.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>z});var n=r("../../../../node_modules/@babel/runtime/helpers/defineProperty.js"),o=r.n(n),a=r("../../../../node_modules/@babel/runtime/helpers/slicedToArray.js"),s=r.n(a),i=r("../../../../node_modules/@babel/runtime/regenerator/index.js"),u=r.n(i),l=r("../../../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),c=r.n(l),d=r("../../../../node_modules/@babel/runtime/helpers/asyncToGenerator.js"),p=r.n(d),m=r("../../../../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=r.n(m),h=r("../../../../node_modules/@babel/runtime/helpers/createClass.js"),v=r.n(h),b=r("../../../../node_modules/@babel/runtime/helpers/inherits.js"),g=r.n(b),y=r("../../../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),j=r.n(y),P=r("../../../../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),D=r.n(P),O=r("../../../../node_modules/react/index.js"),x=r("../../../../node_modules/lodash/isEqual.js"),w=r.n(x),_=r("../../../../node_modules/lodash/omitBy.js"),k=r.n(_),T=r("./app/actionCreators/events.tsx"),q=r("./app/actionCreators/indicator.tsx"),S=r("./app/components/charts/loadingPanel.tsx"),E=r("./app/components/charts/utils.tsx"),A=r("./app/locale.tsx"),C=r("../../../../node_modules/@emotion/core/dist/core.browser.esm.js");function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Z=["api","children","organization","loading"],I=function(e){return k()(e,(function(e,t){return Z.includes(t)}))},W=function(e){g()(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=D()(t);if(r){var o=D()(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return j()(this,e)});function o(){var e;f()(this,o);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=n.call.apply(n,[this].concat(r))).state={reloading:!!e.props.loading,errored:!1,timeseriesData:null,fetchedWithPrevious:!1},e.unmounting=!1,e.fetchData=p()(u().mark((function t(){var r,n,o,a,s,i,l,d;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.props,n=r.api,o=r.confirmedQuery,a=r.expired,s=r.name,i=r.hideError,l=c()(r,["api","confirmedQuery","expired","name","hideError"]),d=null,!1!==o){t.next=4;break}return t.abrupt("return");case 4:if(e.setState((function(e){return{reloading:null!==e.timeseriesData,errored:!1}})),!a){t.next=10;break}(0,q.Iw)((0,A.t)("%s has an invalid date range. Please try a more recent date range.",s),{append:!0}),e.setState({errored:!0}),t.next=21;break;case 10:return t.prev=10,n.clear(),t.next=14,(0,T.lI)(n,l);case 14:d=t.sent,t.next=21;break;case 17:t.prev=17,t.t0=t.catch(10),i||(t.t0&&t.t0.responseJSON&&t.t0.responseJSON.detail?(0,q.Iw)(t.t0.responseJSON.detail):(0,q.Iw)((0,A.t)("Error loading chart data"))),e.setState({errored:!0});case 21:if(!e.unmounting){t.next=23;break}return t.abrupt("return");case 23:e.setState({reloading:!1,timeseriesData:d,fetchedWithPrevious:l.includePrevious});case 24:case"end":return t.stop()}}),t,null,[[10,17]])}))),e.getData=function(t){var r=e.state.fetchedWithPrevious,n=e.props,o=n.period,a=n.includePrevious,s=r||(0,E.Sw)(a,o),i=Math.floor(t.length/2);return{current:s?t.slice(i):t,previous:s?t.slice(0,i):null}},e}return v()(o,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentDidUpdate",value:function(e){w()(I(e),I(this.props))||this.fetchData()}},{key:"componentWillUnmount",value:function(){this.unmounting=!0}},{key:"calculateTotalsPerTimestamp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 1e3*e};return e.map((function(e,r){var n=s()(e,2),o=n[0],a=n[1];return{name:t(o,a,r),value:a.reduce((function(e,t){return e+t.count}),0)}}))}},{key:"transformPreviousPeriodData",value:function(e,t){var r;return t?{seriesName:null!==(r=this.props.previousSeriesName)&&void 0!==r?r:"Previous",data:this.calculateTotalsPerTimestamp(t,(function(t,r,n){return 1e3*e[n][0]}))}:null}},{key:"transformAggregatedTimeseries",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{seriesName:t,data:this.calculateTotalsPerTimestamp(e)}}},{key:"transformTimeseriesData",value:function(e,t){return[{seriesName:t||"Current",data:e.map((function(e){var t=s()(e,2);return{name:1e3*t[0],value:t[1].reduce((function(e,t){return e+t.count}),0)}}))}]}},{key:"processData",value:function(e){if(!e)return{};var t=e.data,r=e.totals,n=this.props,o=n.includeTransformedData,a=n.includeTimeAggregation,s=n.timeAggregationSeriesName,i=this.getData(t),u=i.current,l=i.previous;return{data:o?this.transformTimeseriesData(u,this.props.currentSeriesName):[],allData:t,originalData:u,totals:r,originalPreviousData:l,previousData:o?this.transformPreviousPeriodData(u,l):null,timeAggregatedData:a?this.transformAggregatedTimeseries(u,s||""):{}}}},{key:"render",value:function(){var e=this,t=this.props,r=t.children,n=t.showLoading,o=c()(t,["children","showLoading"]),a=this.state,s=a.timeseriesData,i=a.reloading,u=a.errored,l=this.props.loading||null===s;if(n&&l)return(0,C.tZ)(S.Z,{"data-test-id":"events-request-loading"});if((0,E.Xe)(s))return r(R({loading:l,reloading:i,errored:u,results:Object.keys(s).map((function(t){var r=s[t],n=e.transformTimeseriesData(r.data,t)[0];return[r.order||0,n]})).sort((function(e,t){return e[0]-t[0]})).map((function(e){return e[1]}))},o));var d=this.processData(s);return r(R({loading:l,reloading:i,errored:u,timeseriesData:d.data,allTimeseriesData:d.allData,originalTimeseriesData:d.originalData,timeseriesTotals:d.totals,originalPreviousTimeseriesData:d.originalPreviousData,previousTimeseriesData:d.previousData,timeAggregatedData:d.timeAggregatedData},o))}}]),o}(O.PureComponent);W.displayName="EventsRequest",W.defaultProps={period:void 0,start:null,end:null,interval:"1d",limit:15,query:"",includePrevious:!0,includeTransformedData:!0};const z=W},"./app/components/charts/loadingPanel.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var n=r("../../../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),o=r.n(n),a=r("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js"),s=(r("../../../../node_modules/react/index.js"),r("./app/components/loadingMask.tsx")),i=r("../../../../node_modules/@emotion/core/dist/core.browser.esm.js"),u=(0,a.Z)((function(e){e.height;var t=o()(e,["height"]);return(0,i.tZ)("div",t,(0,i.tZ)(s.Z,null))}),{target:"e1ply9d40",label:"LoadingPanel"})("flex:1;flex-shrink:0;overflow:hidden;height:",(function(e){return e.height}),";position:relative;border-color:transparent;margin-bottom:0;");u.defaultProps={height:"200px"};const l=u},"./app/components/loadingMask.tsx":(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});const n=(0,r("../../../../node_modules/@emotion/styled-base/dist/styled-base.browser.esm.js").Z)("div",{target:"e4k24ed0",label:"LoadingMask"})("background-color:",(function(e){return e.theme.backgroundSecondary}),";border-radius:",(function(e){return e.theme.borderRadius}),";position:absolute;top:0;bottom:0;left:0;right:0;")},"./app/utils/getPeriod.tsx":(e,t,r)=>{"use strict";r.d(t,{X:()=>l});var n=r("../../../../node_modules/@babel/runtime/helpers/slicedToArray.js"),o=r.n(n),a=r("../../../../node_modules/moment/moment.js"),s=r.n(a),i=r("./app/constants/index.tsx"),u=r("./app/utils/dates.tsx"),l=function(e){var t=e.period,r=e.start,n=e.end,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=a.shouldDoublePeriod;if(t||r||n||(t=i.GY),t){if(!l)return{statsPeriod:t};var c=t.match(/([0-9]+)([mhdw])/),d=o()(c,3),p=d[1],m=d[2];return{statsPeriod:"".concat(2*parseInt(p,10)).concat(m)}}if(!r||!n)throw new Error("start and end required");var f=(0,u.v5)(r),h=(0,u.v5)(n);if(l){var v=s()(n).diff(s()(r)),b=s()(r).subtract(v);return{start:(0,u.v5)(b),end:h}}return{start:f,end:h}}},"../../../../node_modules/lodash/negate.js":e=>{e.exports=function(e){if("function"!=typeof e)throw new TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}},"../../../../node_modules/lodash/omitBy.js":(e,t,r)=>{var n=r("../../../../node_modules/lodash/_baseIteratee.js"),o=r("../../../../node_modules/lodash/negate.js"),a=r("../../../../node_modules/lodash/pickBy.js");e.exports=function(e,t){return a(e,o(n(t)))}}}]);
//# sourceMappingURL=app_components_charts_eventsRequest_tsx.js.map